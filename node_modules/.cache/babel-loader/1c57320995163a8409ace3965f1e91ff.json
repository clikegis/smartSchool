{"remainingRequest":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\src\\utils\\spatialAnalysis.js","dependencies":[{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\src\\utils\\spatialAnalysis.js","mtime":1656476541880},{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\babel.config.js","mtime":1656398191838},{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICogYXMgdHVyZiBmcm9tICd0dXJmJzsKaW1wb3J0IGdsc2wgZnJvbSAnLi9nbHNsJzsKCmNvbnN0IENlc2l1bSA9IHJlcXVpcmUoIi4uLy4uL25vZGVfbW9kdWxlcy9jZXNpdW0vU291cmNlL0Nlc2l1bS5qcyIpOwoKY2xhc3MgTGltaXRIZWlnaHRBbmFseXNpcyB7CiAgY29uc3RydWN0b3Iodmlld2VyLCBkZWdyZWVzQXJyYXksIGhlaWdodCwgc3R5bGUpIHsKICAgIHRoaXMudmlld2VyID0gdmlld2VyOwogICAgdGhpcy5kZWdyZWVzQXJyYXkgPSBkZWdyZWVzQXJyYXk7CiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICAgIHRoaXMuc3R5bGUgPSBzdHlsZSB8fCB7fTsKICAgIHRoaXMuaW5pdCgpOwogIH0KCiAgaW5pdCgpIHsKICAgIHRoaXMudmlld2VyLnNjZW5lLmludmVydENsYXNzaWZpY2F0aW9uID0gdHJ1ZTsKICAgIHRoaXMudmlld2VyLnNjZW5lLmludmVydENsYXNzaWZpY2F0aW9uQ29sb3IgPSB0aGlzLnN0eWxlLmNvbG9yIHx8IG5ldyBDZXNpdW0uQ29sb3IoMSwgMSwgMSwgMSk7CiAgICB0aGlzLmFkZEJvdHRvbVBvbHlnb24oKTsKICAgIHRoaXMuYWRkUHJpbWl0aXZlKCk7CiAgfQoKICBhZGRCb3R0b21Qb2x5Z29uKCkgewogICAgdGhpcy5ib3R0b21Qb2x5Z29uID0gdGhpcy52aWV3ZXIuZW50aXRpZXMuYWRkKHsKICAgICAgcG9seWdvbjogewogICAgICAgIGhpZXJhcmNoeTogbmV3IENlc2l1bS5Qb2x5Z29uSGllcmFyY2h5KENlc2l1bS5DYXJ0ZXNpYW4zLmZyb21EZWdyZWVzQXJyYXkodGhpcy5kZWdyZWVzQXJyYXkpKSwKICAgICAgICBoZWlnaHQ6IG5ldyBDZXNpdW0uQ2FsbGJhY2tQcm9wZXJ0eShlID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKICAgICAgICB9LCBmYWxzZSksCiAgICAgICAgbWF0ZXJpYWw6IENlc2l1bS5Db2xvci5ZRUxMT1cud2l0aEFscGhhKDAuMiksCiAgICAgICAgb3V0bGluZTogdHJ1ZSwKICAgICAgICBvdXRsaW5lQ29sb3I6IENlc2l1bS5Db2xvci5SRUQKICAgICAgfQogICAgfSk7CiAgfQoKICBhZGRQcmltaXRpdmUoKSB7CiAgICBsZXQgZ2VvbWV0cnkgPSB0aGlzLmNyZWF0ZUdlb21ldHJ5KCk7CiAgICB0aGlzLmFkZENsYXNzaWZpY2F0aW9uUHJpbWl0aXZlKGdlb21ldHJ5KTsKICB9CgogIHNldEhlaWdodChoZWlnaHQpIHsKICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0IHx8IDEwMDsKICAgIHRoaXMucmVtb3ZlUHJpbWl0aXZlKCk7CiAgICB0aGlzLmFkZFByaW1pdGl2ZSgpOwogIH0KCiAgY3JlYXRlR2VvbWV0cnkoKSB7CiAgICByZXR1cm4gbmV3IENlc2l1bS5Qb2x5Z29uR2VvbWV0cnkoewogICAgICBwb2x5Z29uSGllcmFyY2h5OiBuZXcgQ2VzaXVtLlBvbHlnb25IaWVyYXJjaHkoQ2VzaXVtLkNhcnRlc2lhbjMuZnJvbURlZ3JlZXNBcnJheSh0aGlzLmRlZ3JlZXNBcnJheSkpLAogICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0LAogICAgICBleHRydWRlZEhlaWdodDogMjAwMDAwCiAgICB9KTsKICB9CgogIGFkZENsYXNzaWZpY2F0aW9uUHJpbWl0aXZlKHBvbHlnb25HZW9tZXRyeSkgewogICAgdGhpcy5QcmltaXRpdmUgPSB0aGlzLnZpZXdlci5zY2VuZS5wcmltaXRpdmVzLmFkZChuZXcgQ2VzaXVtLkNsYXNzaWZpY2F0aW9uUHJpbWl0aXZlKHsKICAgICAgZ2VvbWV0cnlJbnN0YW5jZXM6IG5ldyBDZXNpdW0uR2VvbWV0cnlJbnN0YW5jZSh7CiAgICAgICAgZ2VvbWV0cnk6IENlc2l1bS5Qb2x5Z29uR2VvbWV0cnkuY3JlYXRlR2VvbWV0cnkocG9seWdvbkdlb21ldHJ5KSwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBjb2xvcjogQ2VzaXVtLkNvbG9yR2VvbWV0cnlJbnN0YW5jZUF0dHJpYnV0ZS5mcm9tQ29sb3IoQ2VzaXVtLkNvbG9yLlJFRC53aXRoQWxwaGEoMC42KSAvL+minOiJsuWAvAogICAgICAgICAgKSwKICAgICAgICAgIHNob3c6IG5ldyBDZXNpdW0uU2hvd0dlb21ldHJ5SW5zdGFuY2VBdHRyaWJ1dGUodHJ1ZSkKICAgICAgICB9CiAgICAgIH0pLAogICAgICBjbGFzc2lmaWNhdGlvblR5cGU6IENlc2l1bS5DbGFzc2lmaWNhdGlvblR5cGUuQ0VTSVVNXzNEX1RJTEUsCiAgICAgIGFzeW5jaHJvbm91czogITEKICAgIH0pKTsKICB9CgogIHJlbW92ZVByaW1pdGl2ZSgpIHsKICAgIHRoaXMudmlld2VyLnNjZW5lLnByaW1pdGl2ZXMucmVtb3ZlKHRoaXMuUHJpbWl0aXZlKTsKICB9CgogIHJlbW92ZSgpIHsKICAgIHRoaXMucmVtb3ZlUHJpbWl0aXZlKCk7CiAgICB0aGlzLnZpZXdlci5zY2VuZS5pbnZlcnRDbGFzc2lmaWNhdGlvbiA9IGZhbHNlOwogICAgdGhpcy52aWV3ZXIuZW50aXRpZXMucmVtb3ZlKHRoaXMuYm90dG9tUG9seWdvbik7CiAgfQoKfQoKZnVuY3Rpb24gZ2V0SGVhZGluZyhmcm9tUG9zaXRpb24sIHRvUG9zaXRpb24pIHsKICBsZXQgZmluYWxQb3NpdGlvbiA9IG5ldyBDZXNpdW0uQ2FydGVzaWFuMygpOwogIGxldCBtYXRyaXg0ID0gQ2VzaXVtLlRyYW5zZm9ybXMuZWFzdE5vcnRoVXBUb0ZpeGVkRnJhbWUoZnJvbVBvc2l0aW9uKTsKICBDZXNpdW0uTWF0cml4NC5pbnZlcnNlKG1hdHJpeDQsIG1hdHJpeDQpOwogIENlc2l1bS5NYXRyaXg0Lm11bHRpcGx5QnlQb2ludChtYXRyaXg0LCB0b1Bvc2l0aW9uLCBmaW5hbFBvc2l0aW9uKTsKICBDZXNpdW0uQ2FydGVzaWFuMy5ub3JtYWxpemUoZmluYWxQb3NpdGlvbiwgZmluYWxQb3NpdGlvbik7CiAgcmV0dXJuIENlc2l1bS5NYXRoLnRvRGVncmVlcyhNYXRoLmF0YW4yKGZpbmFsUG9zaXRpb24ueCwgZmluYWxQb3NpdGlvbi55KSk7Cn0KCmZ1bmN0aW9uIGdldFBpdGNoKGZyb21Qb3NpdGlvbiwgdG9Qb3NpdGlvbikgewogIGxldCBmaW5hbFBvc2l0aW9uID0gbmV3IENlc2l1bS5DYXJ0ZXNpYW4zKCk7CiAgbGV0IG1hdHJpeDQgPSBDZXNpdW0uVHJhbnNmb3Jtcy5lYXN0Tm9ydGhVcFRvRml4ZWRGcmFtZShmcm9tUG9zaXRpb24pOwogIENlc2l1bS5NYXRyaXg0LmludmVyc2UobWF0cml4NCwgbWF0cml4NCk7CiAgQ2VzaXVtLk1hdHJpeDQubXVsdGlwbHlCeVBvaW50KG1hdHJpeDQsIHRvUG9zaXRpb24sIGZpbmFsUG9zaXRpb24pOwogIENlc2l1bS5DYXJ0ZXNpYW4zLm5vcm1hbGl6ZShmaW5hbFBvc2l0aW9uLCBmaW5hbFBvc2l0aW9uKTsKICByZXR1cm4gQ2VzaXVtLk1hdGgudG9EZWdyZWVzKE1hdGguYXNpbihmaW5hbFBvc2l0aW9uLnopKTsKfQoKY2xhc3MgQ2FtZXJhTGluZSB7CiAgY29uc3RydWN0b3Iodmlld2VyLCBvcHRpb25zKSB7CiAgICB0aGlzLnZpZXdlciA9IHZpZXdlcjsKICAgIHRoaXMudmlld1Bvc2l0aW9uID0gb3B0aW9ucy52aWV3UG9zaXRpb247IC8v6KeC5a+f54K5CgogICAgdGhpcy52aWV3UG9zaXRpb25FbmQgPSBvcHRpb25zLnZpZXdQb3NpdGlvbkVuZDsgLy/nu5PmnZ/ngrkKCiAgICB0aGlzLnZpZXdEaXN0YW5jZSA9IHRoaXMuZ2V0RGlzdGFuY2UoKTsKICAgIHRoaXMudmlld0hlYWRpbmcgPSB0aGlzLmdldFZpZXdIZWFkaW5nKCk7CiAgICB0aGlzLnZpZXdQaXRjaCA9IHRoaXMuZ2V0Vmlld1BpdGNoKCk7CiAgICB0aGlzLmhvcml6b250YWxWaWV3QW5nbGUgPSBvcHRpb25zLmhvcml6b250YWxWaWV3QW5nbGUgfHwgOTAuMDsKICAgIHRoaXMudmVydGljYWxWaWV3QW5nbGUgPSBvcHRpb25zLnZlcnRpY2FsVmlld0FuZ2xlIHx8IDYwLjA7CiAgICB0aGlzLmRyYXdTa2V0Y2goKTsKICAgIHRoaXMuZHJhd0ZydXN0dW1PdXRsaW5lKCk7CiAgfQoKICB1cGRhdGVFbmRQb3NpdGlvbihlbmRQb3NpdGlvbikgewogICAgdGhpcy52aWV3UG9zaXRpb25FbmQgPSBlbmRQb3NpdGlvbjsKICB9CgogIGdldFZpZXdIZWFkaW5nKCkgewogICAgdGhpcy52aWV3SGVhZGluZyA9IGdldEhlYWRpbmcodGhpcy52aWV3UG9zaXRpb24sIHRoaXMudmlld1Bvc2l0aW9uRW5kKTsKICAgIHJldHVybiB0aGlzLnZpZXdIZWFkaW5nOwogIH0KCiAgZ2V0Vmlld1BpdGNoKCkgewogICAgdGhpcy52aWV3UGl0Y2ggPSBnZXRQaXRjaCh0aGlzLnZpZXdQb3NpdGlvbiwgdGhpcy52aWV3UG9zaXRpb25FbmQpOwogICAgcmV0dXJuIHRoaXMudmlld1BpdGNoOwogIH0KCiAgZ2V0RGlzdGFuY2UoKSB7CiAgICB0aGlzLnZpZXdEaXN0YW5jZSA9IENlc2l1bS5DYXJ0ZXNpYW4zLmRpc3RhbmNlKHRoaXMudmlld1Bvc2l0aW9uLCB0aGlzLnZpZXdQb3NpdGlvbkVuZCk7CiAgICByZXR1cm4gdGhpcy52aWV3RGlzdGFuY2U7CiAgfQoKICBnZXRPcHRpb25zKCkgewogICAgcmV0dXJuIHsKICAgICAgdmlld1Bvc2l0aW9uOiB0aGlzLnZpZXdQb3NpdGlvbiwKICAgICAgdmlld1Bvc2l0aW9uRW5kOiB0aGlzLnZpZXdQb3NpdGlvbkVuZCwKICAgICAgdmlld0Rpc3RhbmNlOiB0aGlzLnZpZXdEaXN0YW5jZSwKICAgICAgdmlld0hlYWRpbmc6IHRoaXMudmlld0hlYWRpbmcsCiAgICAgIHZpZXdQaXRjaDogdGhpcy52aWV3UGl0Y2gsCiAgICAgIGhvcml6b250YWxWaWV3QW5nbGU6IHRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSwKICAgICAgdmVydGljYWxWaWV3QW5nbGU6IHRoaXMudmVydGljYWxWaWV3QW5nbGUKICAgIH07CiAgfQoKICBkcmF3RnJ1c3R1bU91dGxpbmUoKSB7CiAgICB0aGlzLmZydXN0dW1PdXRsaW5lID0gdGhpcy52aWV3ZXIuZW50aXRpZXMuYWRkKHsKICAgICAgbmFtZTogJ2ZydXN0dW1PdXRsaW5lJywKICAgICAgcG9zaXRpb246IHRoaXMudmlld1Bvc2l0aW9uLAogICAgICBvcmllbnRhdGlvbjogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgIHJldHVybiBDZXNpdW0uVHJhbnNmb3Jtcy5oZWFkaW5nUGl0Y2hSb2xsUXVhdGVybmlvbih0aGlzLnZpZXdQb3NpdGlvbiwgQ2VzaXVtLkhlYWRpbmdQaXRjaFJvbGwuZnJvbURlZ3JlZXModGhpcy5nZXRWaWV3SGVhZGluZygpIC0gdGhpcy5ob3Jpem9udGFsVmlld0FuZ2xlLCB0aGlzLmdldFZpZXdQaXRjaCgpLCAwLjApKTsKICAgICAgfSwgZmFsc2UpLAogICAgICBlbGxpcHNvaWQ6IHsKICAgICAgICByYWRpaTogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSB0aGlzLmdldERpc3RhbmNlKCk7CiAgICAgICAgICByZXR1cm4gbmV3IENlc2l1bS5DYXJ0ZXNpYW4zKGRpc3RhbmNlLCBkaXN0YW5jZSwgZGlzdGFuY2UpOwogICAgICAgIH0sIGZhbHNlKSwKICAgICAgICBpbm5lclJhZGlpOiBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoMC4wMSwgMC4wMSwgMC4wMSksCiAgICAgICAgbWluaW11bUNsb2NrOiBDZXNpdW0uTWF0aC50b1JhZGlhbnMoLXRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSAvIDIpLAogICAgICAgIG1heGltdW1DbG9jazogQ2VzaXVtLk1hdGgudG9SYWRpYW5zKHRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSAvIDIpLAogICAgICAgIG1pbmltdW1Db25lOiBDZXNpdW0uTWF0aC50b1JhZGlhbnModGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSArIDcuNzUpLAogICAgICAgIG1heGltdW1Db25lOiBDZXNpdW0uTWF0aC50b1JhZGlhbnMoMTgwIC0gdGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSAtIDcuNzUpLAogICAgICAgIGZpbGw6IGZhbHNlLAogICAgICAgIG91dGxpbmU6IHRydWUsCiAgICAgICAgb3V0bGluZUNvbG9yOiBDZXNpdW0uQ29sb3IuQVFVQQogICAgICB9CiAgICB9KTsKICB9CgogIGRyYXdTa2V0Y2goKSB7CiAgICB0aGlzLnNrZXRjaCA9IHRoaXMudmlld2VyLmVudGl0aWVzLmFkZCh7CiAgICAgIG5hbWU6ICdza2V0Y2gnLAogICAgICBwb3NpdGlvbjogdGhpcy52aWV3UG9zaXRpb24sCiAgICAgIG9yaWVudGF0aW9uOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgcmV0dXJuIENlc2l1bS5UcmFuc2Zvcm1zLmhlYWRpbmdQaXRjaFJvbGxRdWF0ZXJuaW9uKHRoaXMudmlld1Bvc2l0aW9uLCBDZXNpdW0uSGVhZGluZ1BpdGNoUm9sbC5mcm9tRGVncmVlcyh0aGlzLmdldFZpZXdIZWFkaW5nKCkgLSB0aGlzLmhvcml6b250YWxWaWV3QW5nbGUsIHRoaXMuZ2V0Vmlld1BpdGNoKCksIDAuMCkpOwogICAgICB9LCBmYWxzZSksCiAgICAgIGVsbGlwc29pZDogewogICAgICAgIHJhZGlpOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IHRoaXMuZ2V0RGlzdGFuY2UoKTsKICAgICAgICAgIHJldHVybiBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoZGlzdGFuY2UsIGRpc3RhbmNlLCBkaXN0YW5jZSk7CiAgICAgICAgfSwgZmFsc2UpLAogICAgICAgIG1pbmltdW1DbG9jazogQ2VzaXVtLk1hdGgudG9SYWRpYW5zKC10aGlzLmhvcml6b250YWxWaWV3QW5nbGUgLyAyKSwKICAgICAgICBtYXhpbXVtQ2xvY2s6IENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLmhvcml6b250YWxWaWV3QW5nbGUgLyAyKSwKICAgICAgICBtaW5pbXVtQ29uZTogQ2VzaXVtLk1hdGgudG9SYWRpYW5zKHRoaXMudmVydGljYWxWaWV3QW5nbGUgKyA3Ljc1KSwKICAgICAgICBtYXhpbXVtQ29uZTogQ2VzaXVtLk1hdGgudG9SYWRpYW5zKDE4MCAtIHRoaXMudmVydGljYWxWaWV3QW5nbGUgLSA3Ljc1KSwKICAgICAgICBmaWxsOiBmYWxzZSwKICAgICAgICBvdXRsaW5lOiB0cnVlLAogICAgICAgIHN1YmRpdmlzaW9uczogMjU2LAogICAgICAgIHN0YWNrUGFydGl0aW9uczogNjQsCiAgICAgICAgc2xpY2VQYXJ0aXRpb25zOiA2NCwKICAgICAgICBvdXRsaW5lQ29sb3I6IENlc2l1bS5Db2xvci5BUVVBCiAgICAgIH0KICAgIH0pOwogIH0KCiAgcmVtb3ZlKCkgewogICAgaWYgKHRoaXMuc2tldGNoKSB7CiAgICAgIHRoaXMudmlld2VyLmVudGl0aWVzLnJlbW92ZSh0aGlzLnNrZXRjaCk7CiAgICAgIHRoaXMuc2tldGNoID0gbnVsbDsKICAgIH0KCiAgICBpZiAodGhpcy5mcnVzdHVtT3V0bGluZSkgewogICAgICB0aGlzLnZpZXdlci5lbnRpdGllcy5yZW1vdmUodGhpcy5mcnVzdHVtT3V0bGluZSk7CiAgICAgIHRoaXMuZnJ1c3R1bU91dGxpbmUgPSBudWxsOwogICAgfQogIH0KCn0KCmNsYXNzIFZpc2liaWxpdHkgewogIGNvbnN0cnVjdG9yKHZpZXdlciwgb3B0aW9ucykgewogICAgdGhpcy52aWV3ZXIgPSB2aWV3ZXI7CiAgICB0aGlzLnZpZXdQb3NpdGlvbiA9IG9wdGlvbnMudmlld1Bvc2l0aW9uOwogICAgdGhpcy52aWV3UG9zaXRpb25FbmQgPSBvcHRpb25zLnZpZXdQb3NpdGlvbkVuZDsKICAgIHRoaXMudmlld0Rpc3RhbmNlID0gb3B0aW9ucy52aWV3RGlzdGFuY2U7CiAgICB0aGlzLnZpZXdIZWFkaW5nID0gb3B0aW9ucy52aWV3SGVhZGluZzsKCiAgICBpZiAodGhpcy52aWV3SGVhZGluZyA8IDApIHsKICAgICAgdGhpcy52aWV3SGVhZGluZyArPSAzNjA7CiAgICB9CgogICAgdGhpcy52aWV3UGl0Y2ggPSBvcHRpb25zLnZpZXdQaXRjaDsKICAgIHRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSA9IG9wdGlvbnMuaG9yaXpvbnRhbFZpZXdBbmdsZSB8fCA5MC4wOwogICAgdGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSA9IG9wdGlvbnMudmVydGljYWxWaWV3QW5nbGUgfHwgOTAuMDsKICAgIHRoaXMudmlzaWJsZUFyZWFDb2xvciA9IG9wdGlvbnMudmlzaWJsZUFyZWFDb2xvciB8fCBDZXNpdW0uQ29sb3IuTElNRTsgLy8gQ2VzaXVtLkNvbG9yLkdSRUVOOwoKICAgIHRoaXMuaW52aXNpYmxlQXJlYUNvbG9yID0gb3B0aW9ucy5pbnZpc2libGVBcmVhQ29sb3IgfHwgQ2VzaXVtLkNvbG9yLlJFRDsKICAgIHRoaXMuZW5hYmxlZCA9IHR5cGVvZiBvcHRpb25zLmVuYWJsZWQgPT09ICJib29sZWFuIiA/IG9wdGlvbnMuZW5hYmxlZCA6IHRydWU7CiAgICB0aGlzLnNvZnRTaGFkb3dzID0gdHlwZW9mIG9wdGlvbnMuc29mdFNoYWRvd3MgPT09ICJib29sZWFuIiA/IG9wdGlvbnMuc29mdFNoYWRvd3MgOiB0cnVlOwogICAgdGhpcy5zaXplID0gb3B0aW9ucy5zaXplIHx8IDIwNDg7CiAgICB0aGlzLmFkZCgpOwogIH0KCiAgYWRkKCkgewogICAgdGhpcy5jcmVhdGVMaWdodENhbWVyYSgpOwogICAgdGhpcy5jcmVhdGVTaGFkb3dNYXAoKTsKICAgIHRoaXMuY3JlYXRlUG9zdFN0YWdlKCk7CiAgICB0aGlzLmRyYXdGcnVzdHVtT3V0bGluZSgpOwogICAgdGhpcy5kcmF3U2tldGNoKCk7CiAgfQoKICBnZXRTdHlsZSgpIHsKICAgIHJldHVybiB7CiAgICAgIHZpZXdIZWFkaW5nOiB0aGlzLnZpZXdIZWFkaW5nLAogICAgICB2aWV3RGlzdGFuY2U6IHRoaXMudmlld0Rpc3RhbmNlLAogICAgICBob3Jpem9udGFsVmlld0FuZ2xlOiB0aGlzLmhvcml6b250YWxWaWV3QW5nbGUsCiAgICAgIHZlcnRpY2FsVmlld0FuZ2xlOiB0aGlzLnZlcnRpY2FsVmlld0FuZ2xlCiAgICB9OwogIH0KCiAgdXBkYXRlU3R5bGUob3B0aW9ucykgewogICAgdGhpcy52aWV3SGVhZGluZyA9IG9wdGlvbnMudmlld0hlYWRpbmc7CiAgICB0aGlzLnZpZXdEaXN0YW5jZSA9IG9wdGlvbnMudmlld0Rpc3RhbmNlOwogICAgdGhpcy5ob3Jpem9udGFsVmlld0FuZ2xlID0gb3B0aW9ucy5ob3Jpem9udGFsVmlld0FuZ2xlOwogICAgdGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSA9IG9wdGlvbnMudmVydGljYWxWaWV3QW5nbGU7CiAgICB0aGlzLmNsZWFyKCk7CiAgICB0aGlzLmFkZCgpOwogIH0KCiAgcmVtb3ZlKCkgewogICAgdGhpcy5jbGVhcigpOwogIH0KCiAgY2xlYXIoKSB7CiAgICBpZiAodGhpcy5za2V0Y2gpIHsKICAgICAgdGhpcy52aWV3ZXIuZW50aXRpZXMucmVtb3ZlQnlJZCh0aGlzLnNrZXRjaC5pZCk7CiAgICAgIHRoaXMuc2tldGNoID0gbnVsbDsKICAgIH0KCiAgICBpZiAodGhpcy5mcnVzdHVtT3V0bGluZSkgewogICAgICB0aGlzLnZpZXdlci5lbnRpdGllcy5yZW1vdmUodGhpcy5mcnVzdHVtT3V0bGluZSk7CiAgICAgIHRoaXMuZnJ1c3R1bU91dGxpbmUgPSBudWxsOwogICAgfQoKICAgIGlmICh0aGlzLnBvc3RTdGFnZSkgewogICAgICB0aGlzLnZpZXdlci5zY2VuZS5wb3N0UHJvY2Vzc1N0YWdlcy5yZW1vdmUodGhpcy5wb3N0U3RhZ2UpOwogICAgICB0aGlzLnBvc3RTdGFnZSA9IG51bGw7CiAgICB9CiAgfQoKICBjcmVhdGVMaWdodENhbWVyYSgpIHsKICAgIHRoaXMubGlnaHRDYW1lcmEgPSBuZXcgQ2VzaXVtLkNhbWVyYSh0aGlzLnZpZXdlci5zY2VuZSk7CiAgICB0aGlzLmxpZ2h0Q2FtZXJhLnBvc2l0aW9uID0gdGhpcy52aWV3UG9zaXRpb247CiAgICB0aGlzLmxpZ2h0Q2FtZXJhLmZydXN0dW0ubmVhciA9IHRoaXMudmlld0Rpc3RhbmNlICogMC4wMDE7CiAgICB0aGlzLmxpZ2h0Q2FtZXJhLmZydXN0dW0uZmFyID0gdGhpcy52aWV3RGlzdGFuY2U7CiAgICBjb25zdCBociA9IENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLmhvcml6b250YWxWaWV3QW5nbGUpOwogICAgY29uc3QgdnIgPSBDZXNpdW0uTWF0aC50b1JhZGlhbnModGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSk7CiAgICBjb25zdCBhc3BlY3RSYXRpbyA9IHRoaXMudmlld0Rpc3RhbmNlICogTWF0aC50YW4oaHIgLyAyKSAqIDIgLyAodGhpcy52aWV3RGlzdGFuY2UgKiBNYXRoLnRhbih2ciAvIDIpICogMik7CiAgICB0aGlzLmxpZ2h0Q2FtZXJhLmZydXN0dW0uYXNwZWN0UmF0aW8gPSBhc3BlY3RSYXRpbzsKCiAgICBpZiAoaHIgPiB2cikgewogICAgICB0aGlzLmxpZ2h0Q2FtZXJhLmZydXN0dW0uZm92ID0gaHI7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmxpZ2h0Q2FtZXJhLmZydXN0dW0uZm92ID0gdnI7CiAgICB9CgogICAgdGhpcy5saWdodENhbWVyYS5zZXRWaWV3KHsKICAgICAgZGVzdGluYXRpb246IHRoaXMudmlld1Bvc2l0aW9uLAogICAgICBvcmllbnRhdGlvbjogewogICAgICAgIGhlYWRpbmc6IENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLnZpZXdIZWFkaW5nIHx8IDApLAogICAgICAgIHBpdGNoOiBDZXNpdW0uTWF0aC50b1JhZGlhbnModGhpcy52aWV3UGl0Y2ggfHwgMCksCiAgICAgICAgcm9sbDogMAogICAgICB9CiAgICB9KTsKICB9CgogIGNyZWF0ZVNoYWRvd01hcCgpIHsKICAgIHRoaXMuc2hhZG93TWFwID0gbmV3IENlc2l1bS5TaGFkb3dNYXAoewogICAgICBjb250ZXh0OiB0aGlzLnZpZXdlci5zY2VuZS5jb250ZXh0LAogICAgICBsaWdodENhbWVyYTogdGhpcy5saWdodENhbWVyYSwKICAgICAgZW5hYmxlZDogdGhpcy5lbmFibGVkLAogICAgICBpc1BvaW50TGlnaHQ6IHRydWUsCiAgICAgIHBvaW50TGlnaHRSYWRpdXM6IHRoaXMudmlld0Rpc3RhbmNlLAogICAgICBjYXNjYWRlc0VuYWJsZWQ6IGZhbHNlLAogICAgICBzaXplOiB0aGlzLnNpemUsCiAgICAgIHNvZnRTaGFkb3dzOiB0aGlzLnNvZnRTaGFkb3dzLAogICAgICBub3JtYWxPZmZzZXQ6IGZhbHNlLAogICAgICBmcm9tTGlnaHRTb3VyY2U6IGZhbHNlCiAgICB9KTsKICAgIHRoaXMudmlld2VyLnNjZW5lLnNoYWRvd01hcCA9IHRoaXMuc2hhZG93TWFwOwogIH0KCiAgY3JlYXRlUG9zdFN0YWdlKCkgewogICAgY29uc3QgZnMgPSBnbHNsOwogICAgY29uc3QgcG9zdFN0YWdlID0gbmV3IENlc2l1bS5Qb3N0UHJvY2Vzc1N0YWdlKHsKICAgICAgZnJhZ21lbnRTaGFkZXI6IGZzLAogICAgICB1bmlmb3JtczogewogICAgICAgIHNoYWRvd01hcF90ZXh0dXJlQ3ViZTogKCkgPT4gewogICAgICAgICAgdGhpcy5zaGFkb3dNYXAudXBkYXRlKFJlZmxlY3QuZ2V0KHRoaXMudmlld2VyLnNjZW5lLCAiX2ZyYW1lU3RhdGUiKSk7CiAgICAgICAgICByZXR1cm4gUmVmbGVjdC5nZXQodGhpcy5zaGFkb3dNYXAsICJfc2hhZG93TWFwVGV4dHVyZSIpOwogICAgICAgIH0sCiAgICAgICAgc2hhZG93TWFwX21hdHJpeDogKCkgPT4gewogICAgICAgICAgdGhpcy5zaGFkb3dNYXAudXBkYXRlKFJlZmxlY3QuZ2V0KHRoaXMudmlld2VyLnNjZW5lLCAiX2ZyYW1lU3RhdGUiKSk7CiAgICAgICAgICByZXR1cm4gUmVmbGVjdC5nZXQodGhpcy5zaGFkb3dNYXAsICJfc2hhZG93TWFwTWF0cml4Iik7CiAgICAgICAgfSwKICAgICAgICBzaGFkb3dNYXBfbGlnaHRQb3NpdGlvbkVDOiAoKSA9PiB7CiAgICAgICAgICB0aGlzLnNoYWRvd01hcC51cGRhdGUoUmVmbGVjdC5nZXQodGhpcy52aWV3ZXIuc2NlbmUsICJfZnJhbWVTdGF0ZSIpKTsKICAgICAgICAgIHJldHVybiBSZWZsZWN0LmdldCh0aGlzLnNoYWRvd01hcCwgIl9saWdodFBvc2l0aW9uRUMiKTsKICAgICAgICB9LAogICAgICAgIHNoYWRvd01hcF9ub3JtYWxPZmZzZXRTY2FsZURpc3RhbmNlTWF4RGlzdGFuY2VBbmREYXJrbmVzczogKCkgPT4gewogICAgICAgICAgdGhpcy5zaGFkb3dNYXAudXBkYXRlKFJlZmxlY3QuZ2V0KHRoaXMudmlld2VyLnNjZW5lLCAiX2ZyYW1lU3RhdGUiKSk7CiAgICAgICAgICBjb25zdCBiaWFzID0gdGhpcy5zaGFkb3dNYXAuX3BvaW50QmlhczsKICAgICAgICAgIHJldHVybiBDZXNpdW0uQ2FydGVzaWFuNC5mcm9tRWxlbWVudHMoYmlhcy5ub3JtYWxPZmZzZXRTY2FsZSwgdGhpcy5zaGFkb3dNYXAuX2Rpc3RhbmNlLCB0aGlzLnNoYWRvd01hcC5tYXhpbXVtRGlzdGFuY2UsIDAuMCwgbmV3IENlc2l1bS5DYXJ0ZXNpYW40KCkpOwogICAgICAgIH0sCiAgICAgICAgc2hhZG93TWFwX3RleGVsU2l6ZURlcHRoQmlhc0FuZE5vcm1hbFNoYWRpbmdTbW9vdGg6ICgpID0+IHsKICAgICAgICAgIHRoaXMuc2hhZG93TWFwLnVwZGF0ZShSZWZsZWN0LmdldCh0aGlzLnZpZXdlci5zY2VuZSwgIl9mcmFtZVN0YXRlIikpOwogICAgICAgICAgY29uc3QgYmlhcyA9IHRoaXMuc2hhZG93TWFwLl9wb2ludEJpYXM7CiAgICAgICAgICBjb25zdCBzY3JhdGNoVGV4ZWxTdGVwU2l6ZSA9IG5ldyBDZXNpdW0uQ2FydGVzaWFuMigpOwogICAgICAgICAgY29uc3QgdGV4ZWxTdGVwU2l6ZSA9IHNjcmF0Y2hUZXhlbFN0ZXBTaXplOwogICAgICAgICAgdGV4ZWxTdGVwU2l6ZS54ID0gMS4wIC8gdGhpcy5zaGFkb3dNYXAuX3RleHR1cmVTaXplLng7CiAgICAgICAgICB0ZXhlbFN0ZXBTaXplLnkgPSAxLjAgLyB0aGlzLnNoYWRvd01hcC5fdGV4dHVyZVNpemUueTsKICAgICAgICAgIHJldHVybiBDZXNpdW0uQ2FydGVzaWFuNC5mcm9tRWxlbWVudHModGV4ZWxTdGVwU2l6ZS54LCB0ZXhlbFN0ZXBTaXplLnksIGJpYXMuZGVwdGhCaWFzLCBiaWFzLm5vcm1hbFNoYWRpbmdTbW9vdGgsIG5ldyBDZXNpdW0uQ2FydGVzaWFuNCgpKTsKICAgICAgICB9LAogICAgICAgIGNhbWVyYV9wcm9qZWN0aW9uX21hdHJpeDogKCkgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMubGlnaHRDYW1lcmEuZnJ1c3R1bS5wcm9qZWN0aW9uTWF0cml4OwogICAgICAgIH0sCiAgICAgICAgY2FtZXJhX3ZpZXdfbWF0cml4OiAoKSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5saWdodENhbWVyYS52aWV3TWF0cml4OwogICAgICAgIH0sCiAgICAgICAgeF92aWV3RGlzdGFuY2U6ICgpID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLnZpZXdEaXN0YW5jZTsKICAgICAgICB9LAogICAgICAgIHhfdmlzaWJsZUFyZWFDb2xvcjogdGhpcy52aXNpYmxlQXJlYUNvbG9yLAogICAgICAgIHhfaW52aXNpYmxlQXJlYUNvbG9yOiB0aGlzLmludmlzaWJsZUFyZWFDb2xvcgogICAgICB9CiAgICB9KTsKICAgIHRoaXMucG9zdFN0YWdlID0gdGhpcy52aWV3ZXIuc2NlbmUucG9zdFByb2Nlc3NTdGFnZXMuYWRkKHBvc3RTdGFnZSk7CiAgfQoKICBkcmF3RnJ1c3R1bU91dGxpbmUoKSB7CiAgICB0aGlzLmZydXN0dW1PdXRsaW5lID0gdGhpcy52aWV3ZXIuZW50aXRpZXMuYWRkKHsKICAgICAgbmFtZTogJ2ZydXN0dW1PdXRsaW5lJywKICAgICAgcG9zaXRpb246IHRoaXMudmlld1Bvc2l0aW9uLAogICAgICBvcmllbnRhdGlvbjogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgIHJldHVybiBDZXNpdW0uVHJhbnNmb3Jtcy5oZWFkaW5nUGl0Y2hSb2xsUXVhdGVybmlvbih0aGlzLnZpZXdQb3NpdGlvbiwgQ2VzaXVtLkhlYWRpbmdQaXRjaFJvbGwuZnJvbURlZ3JlZXModGhpcy52aWV3SGVhZGluZyAtIDkwLCB0aGlzLnZpZXdQaXRjaCwgMC4wKSk7CiAgICAgIH0sIGZhbHNlKSwKICAgICAgZWxsaXBzb2lkOiB7CiAgICAgICAgcmFkaWk6IG5ldyBDZXNpdW0uQ2FsbGJhY2tQcm9wZXJ0eShlID0+IHsKICAgICAgICAgIHJldHVybiBuZXcgQ2VzaXVtLkNhcnRlc2lhbjModGhpcy52aWV3RGlzdGFuY2UsIHRoaXMudmlld0Rpc3RhbmNlLCB0aGlzLnZpZXdEaXN0YW5jZSk7CiAgICAgICAgfSwgZmFsc2UpLAogICAgICAgIGlubmVyUmFkaWk6IG5ldyBDZXNpdW0uQ2FydGVzaWFuMygwLjAxLCAwLjAxLCAwLjAxKSwKICAgICAgICBtaW5pbXVtQ2xvY2s6IG5ldyBDZXNpdW0uQ2FsbGJhY2tQcm9wZXJ0eShlID0+IHsKICAgICAgICAgIHJldHVybiBDZXNpdW0uTWF0aC50b1JhZGlhbnMoLXRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSAvIDIpOwogICAgICAgIH0sIGZhbHNlKSwKICAgICAgICBtYXhpbXVtQ2xvY2s6IG5ldyBDZXNpdW0uQ2FsbGJhY2tQcm9wZXJ0eShlID0+IHsKICAgICAgICAgIHJldHVybiBDZXNpdW0uTWF0aC50b1JhZGlhbnModGhpcy5ob3Jpem9udGFsVmlld0FuZ2xlIC8gMik7CiAgICAgICAgfSwgZmFsc2UpLAogICAgICAgIG1pbmltdW1Db25lOiBDZXNpdW0uTWF0aC50b1JhZGlhbnModGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSArIDcuNzUpLAogICAgICAgIG1heGltdW1Db25lOiBDZXNpdW0uTWF0aC50b1JhZGlhbnMoMTgwIC0gdGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSAtIDcuNzUpLAogICAgICAgIGZpbGw6IGZhbHNlLAogICAgICAgIHNsaWNlUGFydGl0aW9uczogNjQsCiAgICAgICAgc3RhY2tQYXJ0aXRpb25zOiA2NCwKICAgICAgICBvdXRsaW5lOiB0cnVlLAogICAgICAgIG91dGxpbmVDb2xvcjogQ2VzaXVtLkNvbG9yLkFRVUEKICAgICAgfQogICAgfSk7CiAgfQoKICBkcmF3U2tldGNoKCkgewogICAgdGhpcy5za2V0Y2ggPSB0aGlzLnZpZXdlci5lbnRpdGllcy5hZGQoewogICAgICBuYW1lOiAnc2tldGNoJywKICAgICAgcG9zaXRpb246IHRoaXMudmlld1Bvc2l0aW9uLAogICAgICBvcmllbnRhdGlvbjogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgIHJldHVybiBDZXNpdW0uVHJhbnNmb3Jtcy5oZWFkaW5nUGl0Y2hSb2xsUXVhdGVybmlvbih0aGlzLnZpZXdQb3NpdGlvbiwgQ2VzaXVtLkhlYWRpbmdQaXRjaFJvbGwuZnJvbURlZ3JlZXModGhpcy52aWV3SGVhZGluZyAtIDkwLCB0aGlzLnZpZXdQaXRjaCwgMC4wKSk7CiAgICAgIH0sIGZhbHNlKSwKICAgICAgZWxsaXBzb2lkOiB7CiAgICAgICAgcmFkaWk6IG5ldyBDZXNpdW0uQ2FsbGJhY2tQcm9wZXJ0eShlID0+IHsKICAgICAgICAgIHJldHVybiBuZXcgQ2VzaXVtLkNhcnRlc2lhbjModGhpcy52aWV3RGlzdGFuY2UsIHRoaXMudmlld0Rpc3RhbmNlLCB0aGlzLnZpZXdEaXN0YW5jZSk7CiAgICAgICAgfSwgZmFsc2UpLAogICAgICAgIG1pbmltdW1DbG9jazogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgcmV0dXJuIENlc2l1bS5NYXRoLnRvUmFkaWFucygtdGhpcy5ob3Jpem9udGFsVmlld0FuZ2xlIC8gMik7CiAgICAgICAgfSwgZmFsc2UpLAogICAgICAgIG1heGltdW1DbG9jazogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgcmV0dXJuIENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLmhvcml6b250YWxWaWV3QW5nbGUgLyAyKTsKICAgICAgICB9LCBmYWxzZSksCiAgICAgICAgbWluaW11bUNvbmU6IENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLnZlcnRpY2FsVmlld0FuZ2xlICsgNy43NSksCiAgICAgICAgbWF4aW11bUNvbmU6IENlc2l1bS5NYXRoLnRvUmFkaWFucygxODAgLSB0aGlzLnZlcnRpY2FsVmlld0FuZ2xlIC0gNy43NSksCiAgICAgICAgZmlsbDogZmFsc2UsCiAgICAgICAgb3V0bGluZTogdHJ1ZSwKICAgICAgICBzdWJkaXZpc2lvbnM6IDI1NiwKICAgICAgICBzdGFja1BhcnRpdGlvbnM6IDY0LAogICAgICAgIHNsaWNlUGFydGl0aW9uczogNjQsCiAgICAgICAgb3V0bGluZUNvbG9yOiBDZXNpdW0uQ29sb3IuQVFVQQogICAgICB9CiAgICB9KTsKICB9Cgp9CgpjbGFzcyBWaXNpYmlsaXR5QW5hbHlzaXMgewogIGNvbnN0cnVjdG9yKHZpZXdlcikgewogICAgdGhpcy52aWV3ZXIgPSB2aWV3ZXI7CiAgICB0aGlzLnZpZXdlci5jZXNpdW1XaWRnZXQuc2NyZWVuU3BhY2VFdmVudEhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLkxFRlRfRE9VQkxFX0NMSUNLKTsKICAgIHRoaXMuaW5pdEV2ZW50cygpOwogIH0KCiAgYWN0aXZhdGUoKSB7CiAgICB0aGlzLmRlYWN0aXZhdGUoKTsKICAgIHRoaXMuY2xlYXIoKTsKICAgIHRoaXMuZmlyc3RQb3NpdGlvbiA9IHVuZGVmaW5lZDsKICAgIHRoaXMucmVnaXN0ZXJFdmVudHMoKTsKICB9CgogIGRlYWN0aXZhdGUoKSB7CiAgICB0aGlzLnVuUmVnaXN0ZXJFdmVudHMoKTsKICAgIHRoaXMudmlld2VyLl9lbGVtZW50LnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJzsKICAgIHRoaXMudmlld2VyLmVuYWJsZUN1cnNvclN0eWxlID0gdHJ1ZTsKICB9CgogIGNsZWFyKCkgewogICAgaWYgKHRoaXMuY2FtZXJhTGluZSkgewogICAgICB0aGlzLmNhbWVyYUxpbmUucmVtb3ZlKCk7CiAgICAgIHRoaXMuY2FtZXJhTGluZSA9IHVuZGVmaW5lZDsKICAgIH0KICB9CgogIGluaXRFdmVudHMoKSB7CiAgICB0aGlzLmhhbmRsZXIgPSBuZXcgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRIYW5kbGVyKHRoaXMudmlld2VyLnNjZW5lLmNhbnZhcyk7CiAgICB0aGlzLkRyYXdFbmRFdmVudCA9IG5ldyBDZXNpdW0uRXZlbnQoKTsKICB9CgogIHJlZ2lzdGVyRXZlbnRzKCkgewogICAgdGhpcy5sZWZ0Q2xpY2tFdmVudCgpOwogICAgdGhpcy5yaWdodENsaWNrRXZlbnQoKTsKICAgIHRoaXMubW91c2VNb3ZlRXZlbnQoKTsKICB9CgogIGxlZnRDbGlja0V2ZW50KCkgewogICAgdGhpcy5oYW5kbGVyLnNldElucHV0QWN0aW9uKGUgPT4gewogICAgICB0aGlzLnZpZXdlci5fZWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7CiAgICAgIGxldCBwb3NpdGlvbiA9IHRoaXMudmlld2VyLnNjZW5lLnBpY2tQb3NpdGlvbihlLnBvc2l0aW9uKTsKCiAgICAgIGlmICghcG9zaXRpb24pIHsKICAgICAgICBwb3NpdGlvbiA9IHRoaXMudmlld2VyLnNjZW5lLmNhbWVyYS5waWNrRWxsaXBzb2lkKGUucG9zaXRpb24sIHRoaXMudmlld2VyLnNjZW5lLmdsb2JlLmVsbGlwc29pZCk7CiAgICAgIH0KCiAgICAgIGlmICghcG9zaXRpb24pIHJldHVybjsKCiAgICAgIGlmICghdGhpcy5maXJzdFBvc2l0aW9uKSB7CiAgICAgICAgdGhpcy5maXJzdFBvc2l0aW9uID0gdGhpcy5nZXRGaXJzdFBvc2l0aW9uKHBvc2l0aW9uKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRyYXdFbmQoKTsKICAgICAgfQogICAgfSwgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLkxFRlRfQ0xJQ0spOwogIH0KCiAgZ2V0Rmlyc3RQb3NpdGlvbihwb3NpdGlvbikgewogICAgY29uc3QgYyA9IENlc2l1bS5DYXJ0b2dyYXBoaWMuZnJvbUNhcnRlc2lhbihwb3NpdGlvbik7CiAgICBjb25zdCBsb24gPSBDZXNpdW0uTWF0aC50b0RlZ3JlZXMoYy5sb25naXR1ZGUpOwogICAgY29uc3QgbGF0ID0gQ2VzaXVtLk1hdGgudG9EZWdyZWVzKGMubGF0aXR1ZGUpOwogICAgY29uc3QgaGVpZ2h0ID0gYy5oZWlnaHQgKyAxOwogICAgcmV0dXJuIENlc2l1bS5DYXJ0ZXNpYW4zLmZyb21EZWdyZWVzKGxvbiwgbGF0LCBoZWlnaHQpOwogIH0KCiAgY3JlYXRlQ2FtZXJhTGluZShwb3NpdGlvbikgewogICAgdGhpcy5jYW1lcmFMaW5lID0gbmV3IENhbWVyYUxpbmUodGhpcy52aWV3ZXIsIHsKICAgICAgdmlld1Bvc2l0aW9uOiB0aGlzLmZpcnN0UG9zaXRpb24sCiAgICAgIHZpZXdQb3NpdGlvbkVuZDogcG9zaXRpb24KICAgIH0pOwogIH0KCiAgbW91c2VNb3ZlRXZlbnQoKSB7CiAgICB0aGlzLmhhbmRsZXIuc2V0SW5wdXRBY3Rpb24oZSA9PiB7CiAgICAgIHRoaXMudmlld2VyLl9lbGVtZW50LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JzsKICAgICAgbGV0IHBvc2l0aW9uID0gdGhpcy52aWV3ZXIuc2NlbmUucGlja1Bvc2l0aW9uKGUuZW5kUG9zaXRpb24pOwoKICAgICAgaWYgKCFwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uID0gdGhpcy52aWV3ZXIuc2NlbmUuY2FtZXJhLnBpY2tFbGxpcHNvaWQoZS5zdGFydFBvc2l0aW9uLCB0aGlzLnZpZXdlci5zY2VuZS5nbG9iZS5lbGxpcHNvaWQpOwogICAgICB9CgogICAgICBpZiAoIXBvc2l0aW9uKSByZXR1cm47CiAgICAgIGlmICghdGhpcy5maXJzdFBvc2l0aW9uKSByZXR1cm47CgogICAgICBpZiAoIXRoaXMuY2FtZXJhTGluZSkgewogICAgICAgIHRoaXMuY3JlYXRlQ2FtZXJhTGluZShwb3NpdGlvbik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jYW1lcmFMaW5lLnVwZGF0ZUVuZFBvc2l0aW9uKHBvc2l0aW9uKTsKICAgICAgfQogICAgfSwgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLk1PVVNFX01PVkUpOwogIH0KCiAgcmlnaHRDbGlja0V2ZW50KCkgewogICAgdGhpcy5oYW5kbGVyLnNldElucHV0QWN0aW9uKGUgPT4gewogICAgICBpZiAoIXRoaXMuZmlyc3RQb3NpdGlvbikgewogICAgICAgIHRoaXMuZGVhY3RpdmF0ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNsZWFyKCk7CiAgICAgICAgdGhpcy5kZWFjdGl2YXRlKCk7CiAgICAgIH0KICAgIH0sIENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5SSUdIVF9DTElDSyk7CiAgfQoKICB1blJlZ2lzdGVyRXZlbnRzKCkgewogICAgdGhpcy5oYW5kbGVyLnJlbW92ZUlucHV0QWN0aW9uKENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5SSUdIVF9DTElDSyk7CiAgICB0aGlzLmhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLkxFRlRfQ0xJQ0spOwogICAgdGhpcy5oYW5kbGVyLnJlbW92ZUlucHV0QWN0aW9uKENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5NT1VTRV9NT1ZFKTsKICAgIHRoaXMuaGFuZGxlci5yZW1vdmVJbnB1dEFjdGlvbihDZXNpdW0uU2NyZWVuU3BhY2VFdmVudFR5cGUuTEVGVF9ET1VCTEVfQ0xJQ0spOwogIH0KCiAgZHJhd0VuZCgpIHsKICAgIHRoaXMuVmlzaWJpbGl0eSA9IG5ldyBWaXNpYmlsaXR5KHRoaXMudmlld2VyLCB0aGlzLmNhbWVyYUxpbmUuZ2V0T3B0aW9ucygpKTsKICAgIHRoaXMuRHJhd0VuZEV2ZW50LnJhaXNlRXZlbnQodGhpcy5WaXNpYmlsaXR5KTsKICAgIHRoaXMuY2FtZXJhTGluZS5yZW1vdmUoKTsKICAgIHRoaXMuZGVhY3RpdmF0ZSgpOwogIH0KCn0KCmNsYXNzIEJ1ZmZlckFuYWx5c2lzIHsKICBzdGF0aWMgcG9pbnRCdWZmZXIocG9pbnQsIHJhZGl1cywgb3B0aW9ucykgewogICAgbGV0IHBvaW50RiA9IHR1cmYucG9pbnQocG9pbnQpOwogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgewogICAgICB1bml0czogJ21ldGVycycsCiAgICAgIHo6IDAKICAgIH07CiAgICBsZXQgYnVmZmVyID0gdHVyZi5idWZmZXIocG9pbnRGLCByYWRpdXMgfHwgMTAwLCBvcHRpb25zLnVuaXRzKTsKICAgIGxldCBjb29yZGluYXRlcyA9IGJ1ZmZlci5nZW9tZXRyeS5jb29yZGluYXRlczsKICAgIGxldCBwb2ludHMgPSBjb29yZGluYXRlc1swXTsKICAgIGxldCBkZWdyZWVzQXJyYXlIZWlnaHRzID0gdGhpcy5wb2ludHNUb0RlZ3JlZXNBcnJheShwb2ludHMsIG9wdGlvbnMueiB8fCAwKTsKICAgIHJldHVybiBDZXNpdW0uQ2FydGVzaWFuMy5mcm9tRGVncmVlc0FycmF5SGVpZ2h0cyhkZWdyZWVzQXJyYXlIZWlnaHRzKTsKICB9CgogIHN0YXRpYyBwb2x5bGluZUJ1ZmZlcihwb2ludHMsIHJhZGl1cywgb3B0aW9ucykgewogICAgbGV0IHBvbHlsaW5lRiA9IHR1cmYubGluZVN0cmluZyhwb2ludHMpOwogICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgewogICAgICB1bml0czogJ21ldGVycycsCiAgICAgIHo6IDAKICAgIH07CiAgICBsZXQgYnVmZmVyZWQgPSB0dXJmLmJ1ZmZlcihwb2x5bGluZUYsIHJhZGl1cyB8fCAxMDAsIG9wdGlvbnMudW5pdHMpOwogICAgbGV0IGNvb3JkaW5hdGVzID0gYnVmZmVyZWQuZ2VvbWV0cnkuY29vcmRpbmF0ZXM7CiAgICBwb2ludHMgPSBjb29yZGluYXRlc1swXTsKICAgIGxldCBkZWdyZWVzQXJyYXlIZWlnaHRzID0gdGhpcy5wb2ludHNUb0RlZ3JlZXNBcnJheShwb2ludHMsIG9wdGlvbnMueiB8fCAwKTsKICAgIHJldHVybiBDZXNpdW0uQ2FydGVzaWFuMy5mcm9tRGVncmVlc0FycmF5SGVpZ2h0cyhkZWdyZWVzQXJyYXlIZWlnaHRzKTsKICB9CgogIHN0YXRpYyBwb2x5Z29uQnVmZmVyKHBvaW50cywgcmFkaXVzLCBvcHRpb25zKSB7CiAgICByZXR1cm4gdGhpcy5wb2x5bGluZUJ1ZmZlcihwb2ludHMsIHJhZGl1cywgb3B0aW9ucyk7CiAgfQoKICBzdGF0aWMgcG9pbnRzVG9EZWdyZWVzQXJyYXkocG9pbnRzLCBoZWlnaHQpIHsKICAgIGxldCBkZWdyZWVzQXJyYXkgPSBbXTsKICAgIHBvaW50cy5tYXAoaXRlbSA9PiB7CiAgICAgIGRlZ3JlZXNBcnJheS5wdXNoKGl0ZW1bMF0pOwogICAgICBkZWdyZWVzQXJyYXkucHVzaChpdGVtWzFdKTsKICAgICAgZGVncmVlc0FycmF5LnB1c2goaGVpZ2h0KTsKICAgIH0pOwogICAgcmV0dXJuIGRlZ3JlZXNBcnJheTsKICB9Cgp9CgpjbGFzcyBTaWdodExpbmUgewogIGNvbnN0cnVjdG9yKHZpZXdlcikgewogICAgdGhpcy52aWV3ZXIgPSB2aWV3ZXI7CiAgICB0aGlzLnZpZXdlci5jZXNpdW1XaWRnZXQuc2NyZWVuU3BhY2VFdmVudEhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLkxFRlRfRE9VQkxFX0NMSUNLKTsKICAgIHRoaXMuaW5pdEV2ZW50cygpOwogIH0KCiAgYWN0aXZhdGUoKSB7CiAgICB0aGlzLmRlYWN0aXZhdGUoKTsKICAgIHRoaXMuY2xlYXIoKTsKICAgIHRoaXMucG9zaXRpb25zID0gW107CiAgICB0aGlzLnRlbXBQb3NpdGlvbnMgPSBbXTsKICAgIHRoaXMucmVnaXN0ZXJFdmVudHMoKTsKICAgIHRoaXMudmlld2VyLmVuYWJsZUN1cnNvclN0eWxlID0gZmFsc2U7CiAgICB0aGlzLnZpZXdlci5fZWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7CiAgfQoKICBkZWFjdGl2YXRlKCkgewogICAgdGhpcy51blJlZ2lzdGVyRXZlbnRzKCk7CiAgICB0aGlzLnZpZXdlci5fZWxlbWVudC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICB0aGlzLnZpZXdlci5lbmFibGVDdXJzb3JTdHlsZSA9IHRydWU7CiAgfQoKICBjbGVhcigpIHsKICAgIGlmICh0aGlzLnBvbHlsaW5lRW50aXR5KSB7CiAgICAgIHRoaXMudmlld2VyLmVudGl0aWVzLnJlbW92ZSh0aGlzLnBvbHlsaW5lRW50aXR5KTsKICAgICAgdGhpcy5wb2x5bGluZUVudGl0eSA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBpZiAodGhpcy52aWV3RW50aXR5KSB7CiAgICAgIHRoaXMudmlld2VyLmVudGl0aWVzLnJlbW92ZSh0aGlzLnZpZXdFbnRpdHkpOwogICAgICB0aGlzLnZpZXdFbnRpdHkgPSB1bmRlZmluZWQ7CiAgICB9CgogICAgaWYgKHRoaXMudGFyZ2V0RW50aXR5KSB7CiAgICAgIHRoaXMudmlld2VyLmVudGl0aWVzLnJlbW92ZSh0aGlzLnRhcmdldEVudGl0eSk7CiAgICAgIHRoaXMudGFyZ2V0RW50aXR5ID0gdW5kZWZpbmVkOwogICAgfQoKICAgIGlmICh0aGlzLnJlc3VsdFBvbHlsaW5lcykgewogICAgICB0aGlzLnJlc3VsdFBvbHlsaW5lcy5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgIHRoaXMudmlld2VyLmVudGl0aWVzLnJlbW92ZShpdGVtKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICBpbml0RXZlbnRzKCkgewogICAgdGhpcy5oYW5kbGVyID0gbmV3IENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50SGFuZGxlcih0aGlzLnZpZXdlci5zY2VuZS5jYW52YXMpOwogIH0KCiAgcmVnaXN0ZXJFdmVudHMoKSB7CiAgICB0aGlzLmxlZnRDbGlja0V2ZW50KCk7CiAgICB0aGlzLnJpZ2h0Q2xpY2tFdmVudCgpOwogICAgdGhpcy5tb3VzZU1vdmVFdmVudCgpOwogIH0KCiAgbGVmdENsaWNrRXZlbnQoKSB7CiAgICB0aGlzLmhhbmRsZXIuc2V0SW5wdXRBY3Rpb24oZSA9PiB7CiAgICAgIHRoaXMudmlld2VyLl9lbGVtZW50LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JzsKICAgICAgbGV0IHBvc2l0aW9uID0gdGhpcy52aWV3ZXIuc2NlbmUucGlja1Bvc2l0aW9uKGUucG9zaXRpb24pOwoKICAgICAgaWYgKCFwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uID0gdGhpcy52aWV3ZXIuc2NlbmUuY2FtZXJhLnBpY2tFbGxpcHNvaWQoZS5wb3NpdGlvbiwgdGhpcy52aWV3ZXIuc2NlbmUuZ2xvYmUuZWxsaXBzb2lkKTsKICAgICAgfQoKICAgICAgaWYgKCFwb3NpdGlvbikgcmV0dXJuOwogICAgICB0aGlzLnBvc2l0aW9ucy5wdXNoKHBvc2l0aW9uKTsKCiAgICAgIGlmICh0aGlzLnBvc2l0aW9ucy5sZW5ndGggPT0gMSkgewogICAgICAgIHRoaXMuaGFuZGxlRmlyc3RQb3NpdGlvbigpOwogICAgICB9IGVsc2UgewogICAgICAgIC8v5Lik54K55pe257uT5p2fCiAgICAgICAgdGhpcy5kcmF3RW5kKCk7CiAgICAgIH0KICAgIH0sIENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5MRUZUX0NMSUNLKTsKICB9CgogIGhhbmRsZUZpcnN0UG9zaXRpb24oKSB7CiAgICB0aGlzLmdlbmVyYXRlVmlldygpOwogICAgdGhpcy5nZW5lcmF0ZVBvbHlsaW5lKCk7CiAgfQoKICBnZW5lcmF0ZVBvbHlsaW5lKCkgewogICAgdGhpcy5wb2x5bGluZUVudGl0eSA9IHRoaXMudmlld2VyLmVudGl0aWVzLmFkZCh7CiAgICAgIHBvbHlsaW5lOiB7CiAgICAgICAgcG9zaXRpb25zOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy50ZW1wUG9zaXRpb25zOwogICAgICAgIH0sIGZhbHNlKSwKICAgICAgICB3aWR0aDogMiwKICAgICAgICBtYXRlcmlhbDogbmV3IENlc2l1bS5Qb2x5bGluZURhc2hNYXRlcmlhbFByb3BlcnR5KHsKICAgICAgICAgIGNvbG9yOiBDZXNpdW0uQ29sb3IuWUVMTE9XCiAgICAgICAgfSksCiAgICAgICAgZGVwdGhGYWlsTWF0ZXJpYWw6IG5ldyBDZXNpdW0uUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSh7CiAgICAgICAgICBjb2xvcjogQ2VzaXVtLkNvbG9yLllFTExPVwogICAgICAgIH0pCiAgICAgIH0KICAgIH0pOwogIH0KCiAgZ2VuZXJhdGVWaWV3KCkgewogICAgdGhpcy52aWV3RW50aXR5ID0gdGhpcy52aWV3ZXIuZW50aXRpZXMuYWRkKHsKICAgICAgcG9zaXRpb246IHRoaXMucG9zaXRpb25zWzBdLAogICAgICBsYWJlbDogewogICAgICAgIHRleHQ6ICLop4Llr5/kvY3nva4iLAogICAgICAgIGZpbGxDb2xvcjogQ2VzaXVtLkNvbG9yLldISVRFLAogICAgICAgIHNjYWxlOiAwLjUsCiAgICAgICAgZm9udDogJ25vcm1hbCAzNHB4IE1pY3JvU29mdCBZYUhlaScsCiAgICAgICAgZGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uOiBuZXcgQ2VzaXVtLkRpc3RhbmNlRGlzcGxheUNvbmRpdGlvbigwLCA1MDAwKSwKICAgICAgICBzY2FsZUJ5RGlzdGFuY2U6IG5ldyBDZXNpdW0uTmVhckZhclNjYWxhcig1MDAsIDEsIDE1MDAsIDAuNCksCiAgICAgICAgdmVydGljYWxPcmlnaW46IENlc2l1bS5WZXJ0aWNhbE9yaWdpbi5CT1RUT00sCiAgICAgICAgc3R5bGU6IENlc2l1bS5MYWJlbFN0eWxlLkZJTExfQU5EX09VVExJTkUsCiAgICAgICAgcGl4ZWxPZmZzZXQ6IG5ldyBDZXNpdW0uQ2FydGVzaWFuMigwLCAtMjApLAogICAgICAgIG91dGxpbmVXaWR0aDogMywKICAgICAgICBvdXRsaW5lQ29sb3I6IENlc2l1bS5Db2xvci5CTEFDSwogICAgICB9LAogICAgICBwb2ludDogewogICAgICAgIGNvbG9yOiBDZXNpdW0uQ29sb3IuRE9ER0VSQkxVRSwKICAgICAgICBwaXhlbFNpemU6IDUsCiAgICAgICAgb3V0bGluZUNvbG9yOiBDZXNpdW0uQ29sb3IuV0hJVEUsCiAgICAgICAgb3V0bGluZVdpZHRoOiAyLAogICAgICAgIHNjYWxlQnlEaXN0YW5jZTogbmV3IENlc2l1bS5OZWFyRmFyU2NhbGFyKDEwMDAsIDEsIDQyMDAsIDAuNCksCiAgICAgICAgZGlzYWJsZURlcHRoVGVzdERpc3RhbmNlOiA1MDAKICAgICAgfQogICAgfSk7CiAgfQoKICBnZW5lcmF0ZUVuZFBvaW50KCkgewogICAgdGhpcy50YXJnZXRFbnRpdHkgPSB0aGlzLnZpZXdlci5lbnRpdGllcy5hZGQoewogICAgICBwb3NpdGlvbjogdGhpcy5wb3NpdGlvbnNbMV0sCiAgICAgIGxhYmVsOiB7CiAgICAgICAgdGV4dDogIuebruagh+S9jee9riIsCiAgICAgICAgZmlsbENvbG9yOiBDZXNpdW0uQ29sb3IuV0hJVEUsCiAgICAgICAgc2NhbGU6IDAuNSwKICAgICAgICBmb250OiAnbm9ybWFsIDM0cHggTWljcm9Tb2Z0IFlhSGVpJywKICAgICAgICBkaXN0YW5jZURpc3BsYXlDb25kaXRpb246IG5ldyBDZXNpdW0uRGlzdGFuY2VEaXNwbGF5Q29uZGl0aW9uKDAsIDUwMDApLAogICAgICAgIHNjYWxlQnlEaXN0YW5jZTogbmV3IENlc2l1bS5OZWFyRmFyU2NhbGFyKDUwMCwgMSwgMTUwMCwgMC40KSwKICAgICAgICB2ZXJ0aWNhbE9yaWdpbjogQ2VzaXVtLlZlcnRpY2FsT3JpZ2luLkJPVFRPTSwKICAgICAgICBzdHlsZTogQ2VzaXVtLkxhYmVsU3R5bGUuRklMTF9BTkRfT1VUTElORSwKICAgICAgICBwaXhlbE9mZnNldDogbmV3IENlc2l1bS5DYXJ0ZXNpYW4yKDAsIC0yMCksCiAgICAgICAgb3V0bGluZVdpZHRoOiAzLAogICAgICAgIG91dGxpbmVDb2xvcjogQ2VzaXVtLkNvbG9yLkJMQUNLCiAgICAgIH0sCiAgICAgIHBvaW50OiB7CiAgICAgICAgY29sb3I6IENlc2l1bS5Db2xvci5ET0RHRVJCTFVFLAogICAgICAgIHBpeGVsU2l6ZTogNSwKICAgICAgICBvdXRsaW5lQ29sb3I6IENlc2l1bS5Db2xvci5XSElURSwKICAgICAgICBvdXRsaW5lV2lkdGg6IDIsCiAgICAgICAgc2NhbGVCeURpc3RhbmNlOiBuZXcgQ2VzaXVtLk5lYXJGYXJTY2FsYXIoMTAwMCwgMSwgNDIwMCwgMC40KSwKICAgICAgICBkaXNhYmxlRGVwdGhUZXN0RGlzdGFuY2U6IDUwMAogICAgICB9CiAgICB9KTsKICB9CgogIG1vdXNlTW92ZUV2ZW50KCkgewogICAgdGhpcy5oYW5kbGVyLnNldElucHV0QWN0aW9uKGUgPT4gewogICAgICB0aGlzLnZpZXdlci5fZWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7CiAgICAgIGxldCBwb3NpdGlvbiA9IHRoaXMudmlld2VyLnNjZW5lLnBpY2tQb3NpdGlvbihlLmVuZFBvc2l0aW9uKTsKCiAgICAgIGlmICghcG9zaXRpb24pIHsKICAgICAgICBwb3NpdGlvbiA9IHRoaXMudmlld2VyLnNjZW5lLmNhbWVyYS5waWNrRWxsaXBzb2lkKGUuc3RhcnRQb3NpdGlvbiwgdGhpcy52aWV3ZXIuc2NlbmUuZ2xvYmUuZWxsaXBzb2lkKTsKICAgICAgfQoKICAgICAgaWYgKCFwb3NpdGlvbikgcmV0dXJuOwogICAgICBpZiAoIXRoaXMucG9seWxpbmVFbnRpdHkpIHJldHVybjsKICAgICAgdGhpcy50ZW1wUG9zaXRpb25zID0gdGhpcy5wb3NpdGlvbnMuY29uY2F0KFtwb3NpdGlvbl0pOwogICAgfSwgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLk1PVVNFX01PVkUpOwogIH0KCiAgcmlnaHRDbGlja0V2ZW50KCkgewogICAgdGhpcy5oYW5kbGVyLnNldElucHV0QWN0aW9uKGUgPT4gewogICAgICBpZiAoIXRoaXMucG9seWxpbmVFbnRpdHkpIHsKICAgICAgICB0aGlzLmRlYWN0aXZhdGUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnBvc2l0aW9ucy5sZW5ndGggPCAyKSB7CiAgICAgICAgdGhpcy5jbGVhcigpOwogICAgICAgIHRoaXMuZGVhY3RpdmF0ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfSwgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLlJJR0hUX0NMSUNLKTsKICB9CgogIHVuUmVnaXN0ZXJFdmVudHMoKSB7CiAgICB0aGlzLmhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLlJJR0hUX0NMSUNLKTsKICAgIHRoaXMuaGFuZGxlci5yZW1vdmVJbnB1dEFjdGlvbihDZXNpdW0uU2NyZWVuU3BhY2VFdmVudFR5cGUuTEVGVF9DTElDSyk7CiAgICB0aGlzLmhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLk1PVVNFX01PVkUpOwogICAgdGhpcy5oYW5kbGVyLnJlbW92ZUlucHV0QWN0aW9uKENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5MRUZUX0RPVUJMRV9DTElDSyk7CiAgfQoKICBkcmF3RW5kKCkgewogICAgdGhpcy5nZW5lcmF0ZUVuZFBvaW50KCk7CiAgICB0aGlzLnN0YXJ0bmFseXNpcygpOwogICAgdGhpcy52aWV3ZXIuZW50aXRpZXMucmVtb3ZlKHRoaXMucG9seWxpbmVFbnRpdHkpOwogICAgdGhpcy5kZWFjdGl2YXRlKCk7CiAgfQoKICBzdGFydG5hbHlzaXMoKSB7CiAgICB2YXIgZGlyZWN0aW9uID0gQ2VzaXVtLkNhcnRlc2lhbjMubm9ybWFsaXplKENlc2l1bS5DYXJ0ZXNpYW4zLnN1YnRyYWN0KHRoaXMucG9zaXRpb25zWzFdLCB0aGlzLnBvc2l0aW9uc1swXSwgbmV3IENlc2l1bS5DYXJ0ZXNpYW4zKCkpLCBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoKSk7CiAgICB2YXIgcmF5ID0gbmV3IENlc2l1bS5SYXkodGhpcy5wb3NpdGlvbnNbMF0sIGRpcmVjdGlvbik7CiAgICB2YXIgcmVzdWx0ID0gdGhpcy52aWV3ZXIuc2NlbmUucGlja0Zyb21SYXkocmF5LCBbdGhpcy52aWV3RW50aXR5LCB0aGlzLnRhcmdldEVudGl0eV0pOyAvLyDorqHnrpfkuqTkupLngrnvvIzov5Tlm57nrKzkuIDkuKoKCiAgICB0aGlzLnJlc3VsdFBvbHlsaW5lcyA9IHRoaXMuc2hvd0ludGVyc2VjdGlvbihyZXN1bHQsIHRoaXMucG9zaXRpb25zWzFdLCB0aGlzLnBvc2l0aW9uc1swXSk7CiAgfQoKICBzaG93SW50ZXJzZWN0aW9uKHJlc3VsdCwgZGVzdFBvaW50LCB2aWV3UG9pbnQpIHsKICAgIGxldCByZXN1bHRQb2x5bGluZXMgPSBbXTsKICAgIGxldCByZXN1bHRMaW5lOwoKICAgIGlmIChDZXNpdW0uZGVmaW5lZChyZXN1bHQpICYmIENlc2l1bS5kZWZpbmVkKHJlc3VsdC5vYmplY3QpKSB7CiAgICAgIHJlc3VsdExpbmUgPSB0aGlzLmRyYXdSZXN1bHRMaW5lKHJlc3VsdC5wb3NpdGlvbiwgdmlld1BvaW50LCBDZXNpdW0uQ29sb3IuQ0hBUlRSRVVTRSk7CiAgICAgIHJlc3VsdFBvbHlsaW5lcy5wdXNoKHJlc3VsdExpbmUpOwogICAgICByZXN1bHRMaW5lID0gdGhpcy5kcmF3UmVzdWx0TGluZShyZXN1bHQucG9zaXRpb24sIGRlc3RQb2ludCwgQ2VzaXVtLkNvbG9yLlJFRCk7CiAgICAgIHJlc3VsdFBvbHlsaW5lcy5wdXNoKHJlc3VsdExpbmUpOwogICAgfSBlbHNlIHsKICAgICAgcmVzdWx0TGluZSA9IHRoaXMuZHJhd1Jlc3VsdExpbmUodmlld1BvaW50LCBkZXN0UG9pbnQsIENlc2l1bS5Db2xvci5DSEFSVFJFVVNFKTsKICAgICAgcmVzdWx0UG9seWxpbmVzLnB1c2gocmVzdWx0TGluZSk7CiAgICB9CgogICAgcmV0dXJuIHJlc3VsdFBvbHlsaW5lczsKICB9CgogIGRyYXdSZXN1bHRMaW5lKGxlZnRQb2ludCwgc2VjUG9pbnQsIGNvbG9yKSB7CiAgICByZXR1cm4gdGhpcy52aWV3ZXIuZW50aXRpZXMuYWRkKHsKICAgICAgcG9seWxpbmU6IHsKICAgICAgICBwb3NpdGlvbnM6IFtsZWZ0UG9pbnQsIHNlY1BvaW50XSwKICAgICAgICB3aWR0aDogMiwKICAgICAgICBtYXRlcmlhbDogY29sb3IsCiAgICAgICAgZGVwdGhGYWlsTWF0ZXJpYWw6IGNvbG9yCiAgICAgIH0KICAgIH0pOwogIH0KCn0KCmZ1bmN0aW9uIGdldENpcmNsZVBvaW50KGxvbiwgbGF0LCBhbmdsZSwgcmFkaXVzKSB7CiAgbGV0IGR4ID0gcmFkaXVzICogTWF0aC5zaW4oYW5nbGUgKiBNYXRoLlBJIC8gMTgwLjApOwogIGxldCBkeSA9IHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlICogTWF0aC5QSSAvIDE4MC4wKTsKICBsZXQgZWMgPSA2MzU2NzI1ICsgKDYzNzgxMzcgLSA2MzU2NzI1KSAqICg5MC4wIC0gbGF0KSAvIDkwLjA7CiAgbGV0IGVkID0gZWMgKiBNYXRoLmNvcyhsYXQgKiBNYXRoLlBJIC8gMTgwKTsKICBsZXQgbmV3TG9uID0gKGR4IC8gZWQgKyBsb24gKiBNYXRoLlBJIC8gMTgwLjApICogMTgwLjAgLyBNYXRoLlBJOwogIGxldCBuZXdMYXQgPSAoZHkgLyBlYyArIGxhdCAqIE1hdGguUEkgLyAxODAuMCkgKiAxODAuMCAvIE1hdGguUEk7CiAgcmV0dXJuIFtuZXdMb24sIG5ld0xhdF07Cn0KCmZ1bmN0aW9uIGdlbmVyYXRlQ2lyY2xlUG9pbnRzKGNlbnRlciwgcmFkaXVzLCBzdGVwcykgewogIGxldCBwb2ludHMgPSBbXTsKICBzdGVwcyA9IHN0ZXBzIHx8IDM2MDsKICBsZXQgbnVtID0gcGFyc2VJbnQoMzYwIC8gc3RlcHMpOwoKICBmb3IgKGxldCBpID0gMDsgaSA8PSAzNjA7IGkgKz0gbnVtKSB7CiAgICBwb2ludHMucHVzaChnZXRDaXJjbGVQb2ludChjZW50ZXJbMF0sIGNlbnRlclsxXSwgaSwgcmFkaXVzKSk7CiAgfQoKICByZXR1cm4gcG9pbnRzOwp9CgpjbGFzcyBDaXJjbGUgewogIGNvbnN0cnVjdG9yKHZpZXdlcikgewogICAgdGhpcy52aWV3ZXIgPSB2aWV3ZXI7CiAgICB0aGlzLnZpZXdlci5jZXNpdW1XaWRnZXQuc2NyZWVuU3BhY2VFdmVudEhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLkxFRlRfRE9VQkxFX0NMSUNLKTsKICAgIHRoaXMuaW5pdEV2ZW50cygpOwogIH0KCiAgYWN0aXZhdGUoKSB7CiAgICB0aGlzLmRlYWN0aXZhdGUoKTsKICAgIHRoaXMuY2xlYXIoKTsKICAgIHRoaXMucG9zaXRpb25zID0gW107CiAgICB0aGlzLnRlbXBQb3NpdGlvbnMgPSBbXTsKICAgIHRoaXMucmVnaXN0ZXJFdmVudHMoKTsKICAgIHRoaXMudmlld2VyLmVuYWJsZUN1cnNvclN0eWxlID0gZmFsc2U7CiAgICB0aGlzLnZpZXdlci5fZWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7CiAgfQoKICBkZWFjdGl2YXRlKCkgewogICAgdGhpcy51blJlZ2lzdGVyRXZlbnRzKCk7CiAgICB0aGlzLnZpZXdlci5fZWxlbWVudC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICB0aGlzLnZpZXdlci5lbmFibGVDdXJzb3JTdHlsZSA9IHRydWU7CiAgfQoKICBjbGVhcigpIHsKICAgIGlmICh0aGlzLmNpcmNsZUVudGl0eSkgewogICAgICB0aGlzLnZpZXdlci5lbnRpdGllcy5yZW1vdmUodGhpcy5jaXJjbGVFbnRpdHkpOwogICAgICB0aGlzLmNpcmNsZUVudGl0eSA9IHVuZGVmaW5lZDsKICAgIH0KCiAgICBpZiAodGhpcy52aWV3RW50aXR5KSB7CiAgICAgIHRoaXMudmlld2VyLmVudGl0aWVzLnJlbW92ZSh0aGlzLnZpZXdFbnRpdHkpOwogICAgICB0aGlzLnZpZXdFbnRpdHkgPSB1bmRlZmluZWQ7CiAgICB9CgogICAgaWYgKHRoaXMucmVzdWx0UG9seWxpbmVzKSB7CiAgICAgIHRoaXMucmVzdWx0UG9seWxpbmVzLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgdGhpcy52aWV3ZXIuZW50aXRpZXMucmVtb3ZlKGl0ZW0pOwogICAgICB9KTsKICAgIH0KICB9CgogIGluaXRFdmVudHMoKSB7CiAgICB0aGlzLmhhbmRsZXIgPSBuZXcgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRIYW5kbGVyKHRoaXMudmlld2VyLnNjZW5lLmNhbnZhcyk7CiAgfQoKICByZWdpc3RlckV2ZW50cygpIHsKICAgIHRoaXMubGVmdENsaWNrRXZlbnQoKTsKICAgIHRoaXMucmlnaHRDbGlja0V2ZW50KCk7CiAgICB0aGlzLm1vdXNlTW92ZUV2ZW50KCk7CiAgfQoKICBsZWZ0Q2xpY2tFdmVudCgpIHsKICAgIHRoaXMuaGFuZGxlci5zZXRJbnB1dEFjdGlvbihlID0+IHsKICAgICAgdGhpcy52aWV3ZXIuX2VsZW1lbnQuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnOwogICAgICBsZXQgcG9zaXRpb24gPSB0aGlzLnZpZXdlci5zY2VuZS5waWNrUG9zaXRpb24oZS5wb3NpdGlvbik7CgogICAgICBpZiAoIXBvc2l0aW9uKSB7CiAgICAgICAgcG9zaXRpb24gPSB0aGlzLnZpZXdlci5zY2VuZS5jYW1lcmEucGlja0VsbGlwc29pZChlLnBvc2l0aW9uLCB0aGlzLnZpZXdlci5zY2VuZS5nbG9iZS5lbGxpcHNvaWQpOwogICAgICB9CgogICAgICBpZiAoIXBvc2l0aW9uKSByZXR1cm47CiAgICAgIHRoaXMucG9zaXRpb25zLnB1c2gocG9zaXRpb24pOwoKICAgICAgaWYgKHRoaXMucG9zaXRpb25zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgdGhpcy50ZW1wUG9zaXRpb25zLnB1c2gocG9zaXRpb24pOwogICAgICAgIHRoaXMuaGFuZGxlRmlyc3RQb3NpdGlvbigpOwogICAgICB9IGVsc2UgewogICAgICAgIC8v5Lik54K55pe257uT5p2fCiAgICAgICAgdGhpcy5kcmF3RW5kKCk7CiAgICAgIH0KICAgIH0sIENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5MRUZUX0NMSUNLKTsKICB9CgogIGhhbmRsZUZpcnN0UG9zaXRpb24oKSB7CiAgICB0aGlzLmdlbmVyYXRlVmlldygpOwogICAgdGhpcy5nZW5lcmF0ZUNpcmNsZSgpOwogIH0KCiAgZ2VuZXJhdGVDaXJjbGUoKSB7CiAgICB0aGlzLmNpcmNsZUVudGl0eSA9IHRoaXMudmlld2VyLmVudGl0aWVzLmFkZCh7CiAgICAgIHBvc2l0aW9uOiB0aGlzLnBvc2l0aW9uc1swXSwKICAgICAgZWxsaXBzZTogewogICAgICAgIHNlbWlNaW5vckF4aXM6IG5ldyBDZXNpdW0uQ2FsbGJhY2tQcm9wZXJ0eShlID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLmdldFJhZGl1cygpOwogICAgICAgIH0sIGZhbHNlKSwKICAgICAgICBzZW1pTWFqb3JBeGlzOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRSYWRpdXMoKTsKICAgICAgICB9LCBmYWxzZSksCiAgICAgICAgbWF0ZXJpYWw6IENlc2l1bS5Db2xvci5SRUQud2l0aEFscGhhKDAuNiksCiAgICAgICAgY2xhc3NpZmljYXRpb25UeXBlOiBDZXNpdW0uQ2xhc3NpZmljYXRpb25UeXBlLkJPVEgKICAgICAgfQogICAgfSk7CiAgfQoKICBnZXRSYWRpdXMoKSB7CiAgICBsZXQgcDEgPSB0aGlzLnRlbXBQb3NpdGlvbnNbMF07CiAgICBsZXQgcDIgPSB0aGlzLnRlbXBQb3NpdGlvbnNbMF07CiAgICBpZiAodGhpcy50ZW1wUG9zaXRpb25zLmxlbmd0aCA+IDEpIHAyID0gdGhpcy50ZW1wUG9zaXRpb25zWzFdOwogICAgbGV0IGRpc3RhbmNlID0gQ2VzaXVtLkNhcnRlc2lhbjMuZGlzdGFuY2UocDEsIHAyKTsKICAgIHJldHVybiBkaXN0YW5jZSA9PSAwID8gMC4wMDAwMDEgOiBkaXN0YW5jZTsKICB9CgogIGdlbmVyYXRlVmlldygpIHsKICAgIHRoaXMudmlld0VudGl0eSA9IHRoaXMudmlld2VyLmVudGl0aWVzLmFkZCh7CiAgICAgIHBvc2l0aW9uOiB0aGlzLnBvc2l0aW9uc1swXSwKICAgICAgbGFiZWw6IHsKICAgICAgICB0ZXh0OiAi6KeC5a+f5L2N572uIiwKICAgICAgICBmaWxsQ29sb3I6IENlc2l1bS5Db2xvci5XSElURSwKICAgICAgICBzY2FsZTogMC41LAogICAgICAgIGZvbnQ6ICdub3JtYWwgMzRweCBNaWNyb1NvZnQgWWFIZWknLAogICAgICAgIGRpc3RhbmNlRGlzcGxheUNvbmRpdGlvbjogbmV3IENlc2l1bS5EaXN0YW5jZURpc3BsYXlDb25kaXRpb24oMCwgNTAwMCksCiAgICAgICAgc2NhbGVCeURpc3RhbmNlOiBuZXcgQ2VzaXVtLk5lYXJGYXJTY2FsYXIoNTAwLCAxLCAxNTAwLCAwLjQpLAogICAgICAgIHZlcnRpY2FsT3JpZ2luOiBDZXNpdW0uVmVydGljYWxPcmlnaW4uQk9UVE9NLAogICAgICAgIHN0eWxlOiBDZXNpdW0uTGFiZWxTdHlsZS5GSUxMX0FORF9PVVRMSU5FLAogICAgICAgIHBpeGVsT2Zmc2V0OiBuZXcgQ2VzaXVtLkNhcnRlc2lhbjIoMCwgLTIwKSwKICAgICAgICBvdXRsaW5lV2lkdGg6IDMsCiAgICAgICAgb3V0bGluZUNvbG9yOiBDZXNpdW0uQ29sb3IuQkxBQ0sKICAgICAgfSwKICAgICAgcG9pbnQ6IHsKICAgICAgICBjb2xvcjogQ2VzaXVtLkNvbG9yLkRPREdFUkJMVUUsCiAgICAgICAgcGl4ZWxTaXplOiA1LAogICAgICAgIG91dGxpbmVDb2xvcjogQ2VzaXVtLkNvbG9yLldISVRFLAogICAgICAgIG91dGxpbmVXaWR0aDogMiwKICAgICAgICBzY2FsZUJ5RGlzdGFuY2U6IG5ldyBDZXNpdW0uTmVhckZhclNjYWxhcigxMDAwLCAxLCA0MjAwLCAwLjQpLAogICAgICAgIGRpc2FibGVEZXB0aFRlc3REaXN0YW5jZTogNTAwCiAgICAgIH0KICAgIH0pOwogIH0KCiAgbW91c2VNb3ZlRXZlbnQoKSB7CiAgICB0aGlzLmhhbmRsZXIuc2V0SW5wdXRBY3Rpb24oZSA9PiB7CiAgICAgIHRoaXMudmlld2VyLl9lbGVtZW50LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JzsKICAgICAgbGV0IHBvc2l0aW9uID0gdGhpcy52aWV3ZXIuc2NlbmUucGlja1Bvc2l0aW9uKGUuZW5kUG9zaXRpb24pOwoKICAgICAgaWYgKCFwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uID0gdGhpcy52aWV3ZXIuc2NlbmUuY2FtZXJhLnBpY2tFbGxpcHNvaWQoZS5zdGFydFBvc2l0aW9uLCB0aGlzLnZpZXdlci5zY2VuZS5nbG9iZS5lbGxpcHNvaWQpOwogICAgICB9CgogICAgICBpZiAoIXBvc2l0aW9uKSByZXR1cm47CiAgICAgIGlmICghdGhpcy5jaXJjbGVFbnRpdHkpIHJldHVybjsKICAgICAgdGhpcy50ZW1wUG9zaXRpb25zID0gdGhpcy5wb3NpdGlvbnMuY29uY2F0KFtwb3NpdGlvbl0pOwogICAgfSwgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLk1PVVNFX01PVkUpOwogIH0KCiAgcmlnaHRDbGlja0V2ZW50KCkgewogICAgdGhpcy5oYW5kbGVyLnNldElucHV0QWN0aW9uKGUgPT4gewogICAgICBpZiAoIXRoaXMuY2lyY2xlRW50aXR5KSB7CiAgICAgICAgdGhpcy5kZWFjdGl2YXRlKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5wb3NpdGlvbnMubGVuZ3RoIDwgMikgewogICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICB0aGlzLmRlYWN0aXZhdGUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0sIENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5SSUdIVF9DTElDSyk7CiAgfQoKICB1blJlZ2lzdGVyRXZlbnRzKCkgewogICAgdGhpcy5oYW5kbGVyLnJlbW92ZUlucHV0QWN0aW9uKENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5SSUdIVF9DTElDSyk7CiAgICB0aGlzLmhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLkxFRlRfQ0xJQ0spOwogICAgdGhpcy5oYW5kbGVyLnJlbW92ZUlucHV0QWN0aW9uKENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5NT1VTRV9NT1ZFKTsKICAgIHRoaXMuaGFuZGxlci5yZW1vdmVJbnB1dEFjdGlvbihDZXNpdW0uU2NyZWVuU3BhY2VFdmVudFR5cGUuTEVGVF9ET1VCTEVfQ0xJQ0spOwogIH0KCiAgZHJhd0VuZCgpIHsKICAgIHRoaXMuc3RhcnRuYWx5c2lzKCk7CiAgICB0aGlzLnZpZXdlci5lbnRpdGllcy5yZW1vdmUodGhpcy5jaXJjbGVFbnRpdHkpOwogICAgdGhpcy5kZWFjdGl2YXRlKCk7CiAgfQoKICBzdGFydG5hbHlzaXMoKSB7CiAgICBjb25zdCBjID0gQ2VzaXVtLkNhcnRvZ3JhcGhpYy5mcm9tQ2FydGVzaWFuKHRoaXMucG9zaXRpb25zWzBdKTsKICAgIGNvbnN0IGNlbnRlciA9IFtDZXNpdW0uTWF0aC50b0RlZ3JlZXMoYy5sb25naXR1ZGUpLCBDZXNpdW0uTWF0aC50b0RlZ3JlZXMoYy5sYXRpdHVkZSldOwogICAgbGV0IGNpcmNsZVBvaW50cyA9IGdlbmVyYXRlQ2lyY2xlUG9pbnRzKGNlbnRlciwgdGhpcy5nZXRSYWRpdXMoKSk7CiAgICBsZXQgdGFyZ2V0UG9zaXRpb25zID0gdGhpcy5wb2ludDJkVG9Qb2ludDNkKGNpcmNsZVBvaW50cyk7CiAgICB0aGlzLnJlc3VsdFBvbHlsaW5lcyA9IFtdOwogICAgbGV0IGRpcmVjdGlvbiwgcmF5LCByZXN1bHQsIGxpbmVzOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0UG9zaXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgIGRpcmVjdGlvbiA9IENlc2l1bS5DYXJ0ZXNpYW4zLm5vcm1hbGl6ZShDZXNpdW0uQ2FydGVzaWFuMy5zdWJ0cmFjdCh0YXJnZXRQb3NpdGlvbnNbaV0sIHRoaXMucG9zaXRpb25zWzBdLCBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoKSksIG5ldyBDZXNpdW0uQ2FydGVzaWFuMygpKTsKICAgICAgcmF5ID0gbmV3IENlc2l1bS5SYXkodGhpcy5wb3NpdGlvbnNbMF0sIGRpcmVjdGlvbik7CiAgICAgIHJlc3VsdCA9IHRoaXMudmlld2VyLnNjZW5lLnBpY2tGcm9tUmF5KHJheSwgW3RoaXMudmlld0VudGl0eSwgdGhpcy50YXJnZXRFbnRpdHldKTsKICAgICAgbGluZXMgPSB0aGlzLnNob3dJbnRlcnNlY3Rpb24ocmVzdWx0LCB0YXJnZXRQb3NpdGlvbnNbaV0sIHRoaXMucG9zaXRpb25zWzBdKTsKICAgICAgdGhpcy5yZXN1bHRQb2x5bGluZXMgPSB0aGlzLnJlc3VsdFBvbHlsaW5lcy5jb25jYXQobGluZXMpOwogICAgfQogIH0KCiAgcG9pbnQyZFRvUG9pbnQzZChwb2ludDJkcykgewogICAgbGV0IHBvaW50M2RzID0gW107CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb2ludDJkcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBpdGVtID0gcG9pbnQyZHNbaV07CiAgICAgIGNvbnN0IGNhcnRlc2lhbjMgPSBDZXNpdW0uQ2FydGVzaWFuMy5mcm9tRGVncmVlcyhpdGVtWzBdLCBpdGVtWzFdLCAwKTsKICAgICAgY29uc3QgYyA9IHRoaXMudmlld2VyLnNjZW5lLmNsYW1wVG9IZWlnaHQoY2FydGVzaWFuMyk7CiAgICAgIHBvaW50M2RzLnB1c2goYyk7CiAgICB9CgogICAgcmV0dXJuIHBvaW50M2RzOwogIH0KCiAgc2hvd0ludGVyc2VjdGlvbihyZXN1bHQsIGRlc3RQb2ludCwgdmlld1BvaW50KSB7CiAgICBsZXQgcmVzdWx0UG9seWxpbmVzID0gW107CiAgICBsZXQgcmVzdWx0TGluZTsKCiAgICBpZiAoQ2VzaXVtLmRlZmluZWQocmVzdWx0KSAmJiBDZXNpdW0uZGVmaW5lZChyZXN1bHQub2JqZWN0KSkgewogICAgICByZXN1bHRMaW5lID0gdGhpcy5kcmF3UmVzdWx0TGluZShyZXN1bHQucG9zaXRpb24sIHZpZXdQb2ludCwgQ2VzaXVtLkNvbG9yLkNIQVJUUkVVU0UpOwogICAgICByZXN1bHRQb2x5bGluZXMucHVzaChyZXN1bHRMaW5lKTsKICAgICAgcmVzdWx0TGluZSA9IHRoaXMuZHJhd1Jlc3VsdExpbmUocmVzdWx0LnBvc2l0aW9uLCBkZXN0UG9pbnQsIENlc2l1bS5Db2xvci5SRUQpOwogICAgICByZXN1bHRQb2x5bGluZXMucHVzaChyZXN1bHRMaW5lKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlc3VsdExpbmUgPSB0aGlzLmRyYXdSZXN1bHRMaW5lKHZpZXdQb2ludCwgZGVzdFBvaW50LCBDZXNpdW0uQ29sb3IuQ0hBUlRSRVVTRSk7CiAgICAgIHJlc3VsdFBvbHlsaW5lcy5wdXNoKHJlc3VsdExpbmUpOwogICAgfQoKICAgIHJldHVybiByZXN1bHRQb2x5bGluZXM7CiAgfQoKICBkcmF3UmVzdWx0TGluZShsZWZ0UG9pbnQsIHNlY1BvaW50LCBjb2xvcikgewogICAgcmV0dXJuIHRoaXMudmlld2VyLmVudGl0aWVzLmFkZCh7CiAgICAgIHBvbHlsaW5lOiB7CiAgICAgICAgcG9zaXRpb25zOiBbbGVmdFBvaW50LCBzZWNQb2ludF0sCiAgICAgICAgd2lkdGg6IDIsCiAgICAgICAgbWF0ZXJpYWw6IGNvbG9yLAogICAgICAgIGRlcHRoRmFpbE1hdGVyaWFsOiBjb2xvcgogICAgICB9CiAgICB9KTsKICB9Cgp9IC8vIGZ1bmN0aW9uIGNhcnRlc2lhbjNUb0RlZ3JlZXMocG9zaXRpb24pIHsKLy8gICAgIGxldCBjID0gQ2VzaXVtLkNhcnRvZ3JhcGhpYy5mcm9tQ2FydGVzaWFuKHBvc2l0aW9uKTsKLy8gICAgIHJldHVybiBbQ2VzaXVtLk1hdGgudG9EZWdyZWVzKGMubG9uZ2l0dWRlKSwgQ2VzaXVtLk1hdGgudG9EZWdyZWVzKGMubGF0aXR1ZGUpXTsKLy8gfQovLyBmdW5jdGlvbiBib29sZWFuQ2xvY2t3aXNlKHBvc2l0aW9ucykgewovLyAgICAgbGV0IGRlZ3JlZXNBcnJhcnkgPSBbXTsKLy8gICAgIHBvc2l0aW9ucy5tYXAocG9zaXRpb24gPT4gewovLyAgICAgICAgIGRlZ3JlZXNBcnJhcnkucHVzaChjYXJ0ZXNpYW4zVG9EZWdyZWVzKHBvc2l0aW9uKSk7Ci8vICAgICB9KTsKLy8gICAgIC8v6aaW5bC+6Zet5ZCICi8vICAgICBkZWdyZWVzQXJyYXJ5LnB1c2goZGVncmVlc0FycmFyeVswXSk7Ci8vICAgICBsZXQgbGluZVN0cmluZyA9IHR1cmYubGluZVN0cmluZyhkZWdyZWVzQXJyYXJ5KTsKLy8gICAgIGNvbnNvbGUubG9nKDEpCi8vICAgICByZXR1cm4gdHVyZi5ib29sZWFuQ2xvY2t3aXNlKGxpbmVTdHJpbmcpCi8vIH0KCgpmdW5jdGlvbiBnZXRDbGlwcGluZ1BsYW5lcyhwb3NpdGlvbnMpIHsKICBsZXQgcExlbmd0aCA9IHBvc2l0aW9ucy5sZW5ndGg7CiAgbGV0IGNsaXBwaW5nUGxhbmVzID0gW107IC8vIOWtmOWCqENsaXBwaW5nUGxhbmXpm4blkIgKCiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwTGVuZ3RoOyArK2kpIHsKICAgIGxldCBuZXh0SW5kZXggPSAoaSArIDEpICUgcExlbmd0aDsKICAgIGxldCBtaWRwb2ludCA9IENlc2l1bS5DYXJ0ZXNpYW4zLmFkZChwb3NpdGlvbnNbaV0sIHBvc2l0aW9uc1tuZXh0SW5kZXhdLCBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoKSk7CiAgICBtaWRwb2ludCA9IENlc2l1bS5DYXJ0ZXNpYW4zLm11bHRpcGx5QnlTY2FsYXIobWlkcG9pbnQsIDAuNSwgbWlkcG9pbnQpOwogICAgbGV0IHVwID0gQ2VzaXVtLkNhcnRlc2lhbjMubm9ybWFsaXplKG1pZHBvaW50LCBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoKSk7CiAgICBsZXQgcmlnaHQgPSBDZXNpdW0uQ2FydGVzaWFuMy5zdWJ0cmFjdChwb3NpdGlvbnNbbmV4dEluZGV4XSwgbWlkcG9pbnQsIG5ldyBDZXNpdW0uQ2FydGVzaWFuMygpKTsKICAgIHJpZ2h0ID0gQ2VzaXVtLkNhcnRlc2lhbjMubm9ybWFsaXplKHJpZ2h0LCByaWdodCk7CiAgICBsZXQgbm9ybWFsID0gQ2VzaXVtLkNhcnRlc2lhbjMuY3Jvc3MocmlnaHQsIHVwLCBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoKSk7CiAgICBub3JtYWwgPSBDZXNpdW0uQ2FydGVzaWFuMy5ub3JtYWxpemUobm9ybWFsLCBub3JtYWwpOwogICAgbGV0IG9yaWdpbkNlbnRlcmVkUGxhbmUgPSBuZXcgQ2VzaXVtLlBsYW5lKG5vcm1hbCwgMC4wKTsKICAgIGxldCBkaXN0YW5jZSA9IENlc2l1bS5QbGFuZS5nZXRQb2ludERpc3RhbmNlKG9yaWdpbkNlbnRlcmVkUGxhbmUsIG1pZHBvaW50KTsKICAgIGNsaXBwaW5nUGxhbmVzLnB1c2gobmV3IENlc2l1bS5DbGlwcGluZ1BsYW5lKG5vcm1hbCwgZGlzdGFuY2UpKTsKICB9CgogIHJldHVybiBjbGlwcGluZ1BsYW5lczsKfQoKY2xhc3MgRXhjYXZhdGUgewogIGNvbnN0cnVjdG9yKHZpZXdlcikgewogICAgdGhpcy52aWV3ZXIgPSB2aWV3ZXI7CiAgfQoKICBhZGQocG9zaXRpb25zLCBvcGl0b25zKSB7CiAgICBpZiAoIW9waXRvbnMpIG9waXRvbnMgPSB7fTsKICAgIHRoaXMuZXhjYXZhdGVEZXB0aCA9IG9waXRvbnMuZXhjYXZhdGVEZXB0aCB8fCAyMDA7IC8v5byA5oyW5rex5bqmCgogICAgdGhpcy5ib3R0b21JbWFnZSA9IG9waXRvbnMuYm90dG9tSW1hZ2UgfHwgJ2ltZy9leGNhdmF0ZV9ib3R0b21fbWluLmpwZyc7CiAgICB0aGlzLnNpZGVJbWFnZSA9IG9waXRvbnMuc2lkZUltYWdlIHx8ICdpbWcvZXhjYXZhdGVfc2lkZV9taW4uanBnJzsKICAgIHRoaXMuY2xlYXIoKTsKICAgIHBvc2l0aW9ucyA9IHBvc2l0aW9ucy5yZXZlcnNlKCk7CiAgICBsZXQgY2xpcHBpbmdQbGFuZXMgPSBnZXRDbGlwcGluZ1BsYW5lcyhwb3NpdGlvbnMpOwogICAgdGhpcy52aWV3ZXIuc2NlbmUuZ2xvYmUuY2xpcHBpbmdQbGFuZXMgPSBuZXcgQ2VzaXVtLkNsaXBwaW5nUGxhbmVDb2xsZWN0aW9uKHsKICAgICAgcGxhbmVzOiBjbGlwcGluZ1BsYW5lcywKICAgICAgZWRnZVdpZHRoOiAxLjAsCiAgICAgIGVkZ2VDb2xvcjogQ2VzaXVtLkNvbG9yLldISVRFCiAgICB9KTsKICAgIGNvbnNvbGUubG9nKHBvc2l0aW9ucyk7CiAgICB0aGlzLmFkZEJvdHRvbVBvbHlnb24ocG9zaXRpb25zKTsKICAgIHRoaXMuYWRkU2lkZVdhbGwocG9zaXRpb25zKTsKICB9CgogIGFkZEJvdHRvbVBvbHlnb24ocG9zaXRpb25zKSB7CiAgICB0aGlzLmJvdHRvbVBvbHlnb24gPSB0aGlzLnZpZXdlci5lbnRpdGllcy5hZGQoewogICAgICBwb2x5Z29uOiB7CiAgICAgICAgaGllcmFyY2h5OiBwb3NpdGlvbnMsCiAgICAgICAgbWF0ZXJpYWw6IHRoaXMuYm90dG9tSW1hZ2UsCiAgICAgICAgaGVpZ2h0OiAtdGhpcy5leGNhdmF0ZURlcHRoCiAgICAgIH0KICAgIH0pOwogIH0KCiAgYWRkU2lkZVdhbGwocG9zaXRpb25zKSB7CiAgICBwb3NpdGlvbnMucHVzaChwb3NpdGlvbnNbMF0pOyAvL+mmluWwvumXreWQiAoKICAgIGxldCBtaW5pbXVtSGVpZ2h0cyA9IG5ldyBBcnJheShwb3NpdGlvbnMubGVuZ3RoKS5maWxsKC10aGlzLmV4Y2F2YXRlRGVwdGgpOwogICAgdGhpcy5zaWRlV2FsbCA9IHRoaXMudmlld2VyLmVudGl0aWVzLmFkZCh7CiAgICAgIHdhbGw6IHsKICAgICAgICBwb3NpdGlvbnM6IHBvc2l0aW9ucywKICAgICAgICBtaW5pbXVtSGVpZ2h0czogbWluaW11bUhlaWdodHMsCiAgICAgICAgbWF0ZXJpYWw6IHRoaXMuc2lkZUltYWdlCiAgICAgIH0KICAgIH0pOwogIH0KCiAgY2xlYXIoKSB7CiAgICB0aGlzLnZpZXdlci5lbnRpdGllcy5yZW1vdmVBbGwoKTsKICAgIHRoaXMudmlld2VyLmltYWdlcnlMYXllcnMucmVtb3ZlQWxsKHRydWUpOwogIH0KCn0KCmNsYXNzIEVudGl0eURyYXcgewogIGNvbnN0cnVjdG9yKHZpZXdlcikgewogICAgdGhpcy52aWV3ZXIgPSB2aWV3ZXI7CiAgICB0aGlzLnZpZXdlci5jZXNpdW1XaWRnZXQuc2NyZWVuU3BhY2VFdmVudEhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLkxFRlRfRE9VQkxFX0NMSUNLKTsKICAgIHRoaXMuaW5pdEV2ZW50cygpOwogIH0KCiAgYWN0aXZhdGUoZHJhd1R5cGUpIHsKICAgIHRoaXMuZGVhY3RpdmF0ZSgpOwogICAgdGhpcy5jbGVhcigpOwogICAgdGhpcy5kcmF3VHlwZSA9IGRyYXdUeXBlOwogICAgdGhpcy5wb3NpdGlvbnMgPSBbXTsKICAgIHRoaXMudGVtcFBvc2l0aW9ucyA9IFtdOwogICAgdGhpcy5yZWdpc3RlckV2ZW50cygpOwogICAgdGhpcy52aWV3ZXIuZW5hYmxlQ3Vyc29yU3R5bGUgPSBmYWxzZTsKICAgIHRoaXMudmlld2VyLl9lbGVtZW50LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JzsKICB9CgogIGRlYWN0aXZhdGUoKSB7CiAgICB0aGlzLnVuUmVnaXN0ZXJFdmVudHMoKTsKICAgIHRoaXMuZHJhd1R5cGUgPSB1bmRlZmluZWQ7CiAgICB0aGlzLmRyYXdFbnRpdHkgPSB1bmRlZmluZWQ7CiAgICB0aGlzLnZpZXdlci5fZWxlbWVudC5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICB0aGlzLnZpZXdlci5lbmFibGVDdXJzb3JTdHlsZSA9IHRydWU7CiAgfQoKICBjbGVhcigpIHsKICAgIGlmICh0aGlzLmRyYXdFbnRpdHkpIHsKICAgICAgdGhpcy52aWV3ZXIuZW50aXRpZXMucmVtb3ZlKHRoaXMuZHJhd0VudGl0eSk7CiAgICAgIHRoaXMuZHJhd0VudGl0eSA9IHVuZGVmaW5lZDsKICAgIH0KICB9CgogIGluaXRFdmVudHMoKSB7CiAgICB0aGlzLmhhbmRsZXIgPSBuZXcgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRIYW5kbGVyKHRoaXMudmlld2VyLnNjZW5lLmNhbnZhcyk7CiAgICB0aGlzLkRyYXdTdGFydEV2ZW50ID0gbmV3IENlc2l1bS5FdmVudCgpOwogICAgdGhpcy5EcmF3RW5kRXZlbnQgPSBuZXcgQ2VzaXVtLkV2ZW50KCk7CiAgfQoKICByZWdpc3RlckV2ZW50cygpIHsKICAgIHRoaXMubGVmdENsaWNrRXZlbnQoKTsKICAgIHRoaXMucmlnaHRDbGlja0V2ZW50KCk7CiAgICB0aGlzLm1vdXNlTW92ZUV2ZW50KCk7CiAgfQoKICBsZWZ0Q2xpY2tFdmVudCgpIHsKICAgIHRoaXMuaGFuZGxlci5zZXRJbnB1dEFjdGlvbihlID0+IHsKICAgICAgdGhpcy52aWV3ZXIuX2VsZW1lbnQuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnOwogICAgICBsZXQgcG9zaXRpb24gPSB0aGlzLnZpZXdlci5zY2VuZS5waWNrUG9zaXRpb24oZS5wb3NpdGlvbik7CgogICAgICBpZiAoIXBvc2l0aW9uKSB7CiAgICAgICAgcG9zaXRpb24gPSB0aGlzLnZpZXdlci5zY2VuZS5jYW1lcmEucGlja0VsbGlwc29pZChlLnBvc2l0aW9uLCB0aGlzLnZpZXdlci5zY2VuZS5nbG9iZS5lbGxpcHNvaWQpOwogICAgICB9CgogICAgICBpZiAoIXBvc2l0aW9uKSByZXR1cm47CiAgICAgIHRoaXMucG9zaXRpb25zLnB1c2gocG9zaXRpb24pOwoKICAgICAgaWYgKHRoaXMucG9zaXRpb25zLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgdGhpcy5oYW5kbGVGaXJzdFBvc2l0aW9uKCk7CiAgICAgIH0KICAgIH0sIENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5MRUZUX0NMSUNLKTsKICB9CgogIGhhbmRsZUZpcnN0UG9zaXRpb24oKSB7CiAgICBzd2l0Y2ggKHRoaXMuZHJhd1R5cGUpIHsKICAgICAgY2FzZSAiUG9pbnQiOgogICAgICAgIHRoaXMuZ2VuZXJhdGVQb2ludCgpOwogICAgICAgIHRoaXMuZHJhd0VuZCgpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAiUG9seWxpbmUiOgogICAgICAgIHRoaXMuZ2VuZXJhdGVQb2x5bGluZSgpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAiUG9seWdvbiI6CiAgICAgICAgdGhpcy5nZW5lcmF0ZVBvbHlnb24oKTsKICAgICAgICBicmVhazsKICAgIH0KICB9CgogIGdlbmVyYXRlUG9pbnQoKSB7CiAgICB0aGlzLmRyYXdFbnRpdHkgPSB0aGlzLnZpZXdlci5lbnRpdGllcy5hZGQoewogICAgICBwb3NpdGlvbjogdGhpcy5wb3NpdGlvbnNbMF0sCiAgICAgIHBvaW50OiB7CiAgICAgICAgcGl4ZWxTaXplOiA0LAogICAgICAgIGNvbG9yOiBDZXNpdW0uQ29sb3IuUkVECiAgICAgIH0KICAgIH0pOwogIH0KCiAgZ2VuZXJhdGVQb2x5bGluZSgpIHsKICAgIHRoaXMuZHJhd0VudGl0eSA9IHRoaXMudmlld2VyLmVudGl0aWVzLmFkZCh7CiAgICAgIHBvbHlsaW5lOiB7CiAgICAgICAgcG9zaXRpb25zOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy50ZW1wUG9zaXRpb25zOwogICAgICAgIH0sIGZhbHNlKSwKICAgICAgICB3aWR0aDogMiwKICAgICAgICBtYXRlcmlhbDogbmV3IENlc2l1bS5Qb2x5bGluZURhc2hNYXRlcmlhbFByb3BlcnR5KHsKICAgICAgICAgIGNvbG9yOiBDZXNpdW0uQ29sb3IuWUVMTE9XCiAgICAgICAgfSksCiAgICAgICAgZGVwdGhGYWlsTWF0ZXJpYWw6IG5ldyBDZXNpdW0uUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSh7CiAgICAgICAgICBjb2xvcjogQ2VzaXVtLkNvbG9yLllFTExPVwogICAgICAgIH0pCiAgICAgIH0KICAgIH0pOwogIH0KCiAgZ2VuZXJhdGVQb2x5Z29uKCkgewogICAgdGhpcy5kcmF3RW50aXR5ID0gdGhpcy52aWV3ZXIuZW50aXRpZXMuYWRkKHsKICAgICAgcG9seWdvbjogewogICAgICAgIGhpZXJhcmNoeTogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgcmV0dXJuIG5ldyBDZXNpdW0uUG9seWdvbkhpZXJhcmNoeSh0aGlzLnRlbXBQb3NpdGlvbnMpOwogICAgICAgIH0sIGZhbHNlKSwKICAgICAgICBtYXRlcmlhbDogQ2VzaXVtLkNvbG9yLlJFRC53aXRoQWxwaGEoMC40KSwKICAgICAgICBwZXJQb3NpdGlvbkhlaWdodDogdHJ1ZQogICAgICB9LAogICAgICBwb2x5bGluZTogewogICAgICAgIHBvc2l0aW9uczogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMudGVtcFBvc2l0aW9ucy5jb25jYXQodGhpcy50ZW1wUG9zaXRpb25zWzBdKTsKICAgICAgICB9LCBmYWxzZSksCiAgICAgICAgd2lkdGg6IDEsCiAgICAgICAgbWF0ZXJpYWw6IG5ldyBDZXNpdW0uUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSh7CiAgICAgICAgICBjb2xvcjogQ2VzaXVtLkNvbG9yLllFTExPVwogICAgICAgIH0pLAogICAgICAgIGRlcHRoRmFpbE1hdGVyaWFsOiBuZXcgQ2VzaXVtLlBvbHlsaW5lRGFzaE1hdGVyaWFsUHJvcGVydHkoewogICAgICAgICAgY29sb3I6IENlc2l1bS5Db2xvci5ZRUxMT1cKICAgICAgICB9KQogICAgICB9CiAgICB9KTsKICB9CgogIG1vdXNlTW92ZUV2ZW50KCkgewogICAgdGhpcy5oYW5kbGVyLnNldElucHV0QWN0aW9uKGUgPT4gewogICAgICB0aGlzLnZpZXdlci5fZWxlbWVudC5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7CiAgICAgIGxldCBwb3NpdGlvbiA9IHRoaXMudmlld2VyLnNjZW5lLnBpY2tQb3NpdGlvbihlLmVuZFBvc2l0aW9uKTsKCiAgICAgIGlmICghcG9zaXRpb24pIHsKICAgICAgICBwb3NpdGlvbiA9IHRoaXMudmlld2VyLnNjZW5lLmNhbWVyYS5waWNrRWxsaXBzb2lkKGUuc3RhcnRQb3NpdGlvbiwgdGhpcy52aWV3ZXIuc2NlbmUuZ2xvYmUuZWxsaXBzb2lkKTsKICAgICAgfQoKICAgICAgaWYgKCFwb3NpdGlvbikgcmV0dXJuOwogICAgICBpZiAoIXRoaXMuZHJhd0VudGl0eSkgcmV0dXJuOwogICAgICB0aGlzLnRlbXBQb3NpdGlvbnMgPSB0aGlzLnBvc2l0aW9ucy5jb25jYXQoW3Bvc2l0aW9uXSk7CiAgICB9LCBDZXNpdW0uU2NyZWVuU3BhY2VFdmVudFR5cGUuTU9VU0VfTU9WRSk7CiAgfQoKICByaWdodENsaWNrRXZlbnQoKSB7CiAgICB0aGlzLmhhbmRsZXIuc2V0SW5wdXRBY3Rpb24oZSA9PiB7CiAgICAgIGlmICghdGhpcy5kcmF3RW50aXR5KSB7CiAgICAgICAgdGhpcy5kZWFjdGl2YXRlKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBzd2l0Y2ggKHRoaXMuZHJhd1R5cGUpIHsKICAgICAgICBjYXNlICJQb2x5bGluZSI6CiAgICAgICAgICB0aGlzLmRyYXdFbnRpdHkucG9seWxpbmUucG9zaXRpb25zID0gdGhpcy5wb3NpdGlvbnM7CiAgICAgICAgICB0aGlzLm1pblBvc2l0aW9uQ291bnQgPSAyOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIlBvbHlnb24iOgogICAgICAgICAgdGhpcy5kcmF3RW50aXR5LnBvbHlnb24uaGllcmFyY2h5ID0gdGhpcy5wb3NpdGlvbnM7CiAgICAgICAgICB0aGlzLmRyYXdFbnRpdHkucG9seWxpbmUucG9zaXRpb25zID0gdGhpcy5wb3NpdGlvbnMuY29uY2F0KHRoaXMucG9zaXRpb25zWzBdKTsKICAgICAgICAgIHRoaXMubWluUG9zaXRpb25Db3VudCA9IDM7CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgaWYgKHRoaXMucG9zaXRpb25zLmxlbmd0aCA8IHRoaXMubWluUG9zaXRpb25Db3VudCkgewogICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICB0aGlzLmRlYWN0aXZhdGUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuZHJhd0VuZCgpOwogICAgfSwgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLlJJR0hUX0NMSUNLKTsKICB9CgogIHVuUmVnaXN0ZXJFdmVudHMoKSB7CiAgICB0aGlzLmhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLlJJR0hUX0NMSUNLKTsKICAgIHRoaXMuaGFuZGxlci5yZW1vdmVJbnB1dEFjdGlvbihDZXNpdW0uU2NyZWVuU3BhY2VFdmVudFR5cGUuTEVGVF9DTElDSyk7CiAgICB0aGlzLmhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLk1PVVNFX01PVkUpOwogICAgdGhpcy5oYW5kbGVyLnJlbW92ZUlucHV0QWN0aW9uKENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5MRUZUX0RPVUJMRV9DTElDSyk7CiAgfQoKICBkcmF3RW5kKCkgewogICAgdGhpcy5kcmF3RW50aXR5LnJlbW92ZSA9ICgpID0+IHsKICAgICAgdGhpcy52aWV3ZXIuZW50aXRpZXMucmVtb3ZlKHRoaXMuZHJhd0VudGl0eSk7CiAgICB9OwoKICAgIHRoaXMuRHJhd0VuZEV2ZW50LnJhaXNlRXZlbnQodGhpcy5kcmF3RW50aXR5LCB0aGlzLnBvc2l0aW9ucywgdGhpcy5kcmF3VHlwZSk7CiAgICB0aGlzLmRlYWN0aXZhdGUoKTsKICB9Cgp9CgpleHBvcnQgZGVmYXVsdCB7CiAgTGltaXRIZWlnaHRBbmFseXNpcywKICBWaXNpYmlsaXR5QW5hbHlzaXMsCiAgQnVmZmVyQW5hbHlzaXMsCiAgU2lnaHRMaW5lLAogIENpcmNsZSwKICBFeGNhdmF0ZSwKICBFbnRpdHlEcmF3Cn07"},{"version":3,"names":["turf","glsl","Cesium","require","LimitHeightAnalysis","constructor","viewer","degreesArray","height","style","init","scene","invertClassification","invertClassificationColor","color","Color","addBottomPolygon","addPrimitive","bottomPolygon","entities","add","polygon","hierarchy","PolygonHierarchy","Cartesian3","fromDegreesArray","CallbackProperty","e","material","YELLOW","withAlpha","outline","outlineColor","RED","geometry","createGeometry","addClassificationPrimitive","setHeight","removePrimitive","PolygonGeometry","polygonHierarchy","extrudedHeight","polygonGeometry","Primitive","primitives","ClassificationPrimitive","geometryInstances","GeometryInstance","attributes","ColorGeometryInstanceAttribute","fromColor","show","ShowGeometryInstanceAttribute","classificationType","ClassificationType","CESIUM_3D_TILE","asynchronous","remove","getHeading","fromPosition","toPosition","finalPosition","matrix4","Transforms","eastNorthUpToFixedFrame","Matrix4","inverse","multiplyByPoint","normalize","Math","toDegrees","atan2","x","y","getPitch","asin","z","CameraLine","options","viewPosition","viewPositionEnd","viewDistance","getDistance","viewHeading","getViewHeading","viewPitch","getViewPitch","horizontalViewAngle","verticalViewAngle","drawSketch","drawFrustumOutline","updateEndPosition","endPosition","distance","getOptions","frustumOutline","name","position","orientation","headingPitchRollQuaternion","HeadingPitchRoll","fromDegrees","ellipsoid","radii","innerRadii","minimumClock","toRadians","maximumClock","minimumCone","maximumCone","fill","AQUA","sketch","subdivisions","stackPartitions","slicePartitions","Visibility","visibleAreaColor","LIME","invisibleAreaColor","enabled","softShadows","size","createLightCamera","createShadowMap","createPostStage","getStyle","updateStyle","clear","removeById","id","postStage","postProcessStages","lightCamera","Camera","frustum","near","far","hr","vr","aspectRatio","tan","fov","setView","destination","heading","pitch","roll","shadowMap","ShadowMap","context","isPointLight","pointLightRadius","cascadesEnabled","normalOffset","fromLightSource","fs","PostProcessStage","fragmentShader","uniforms","shadowMap_textureCube","update","Reflect","get","shadowMap_matrix","shadowMap_lightPositionEC","shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness","bias","_pointBias","Cartesian4","fromElements","normalOffsetScale","_distance","maximumDistance","shadowMap_texelSizeDepthBiasAndNormalShadingSmooth","scratchTexelStepSize","Cartesian2","texelStepSize","_textureSize","depthBias","normalShadingSmooth","camera_projection_matrix","projectionMatrix","camera_view_matrix","viewMatrix","x_viewDistance","x_visibleAreaColor","x_invisibleAreaColor","VisibilityAnalysis","cesiumWidget","screenSpaceEventHandler","removeInputAction","ScreenSpaceEventType","LEFT_DOUBLE_CLICK","initEvents","activate","deactivate","firstPosition","undefined","registerEvents","unRegisterEvents","_element","cursor","enableCursorStyle","cameraLine","handler","ScreenSpaceEventHandler","canvas","DrawEndEvent","Event","leftClickEvent","rightClickEvent","mouseMoveEvent","setInputAction","pickPosition","camera","pickEllipsoid","globe","getFirstPosition","drawEnd","LEFT_CLICK","c","Cartographic","fromCartesian","lon","longitude","lat","latitude","createCameraLine","startPosition","MOUSE_MOVE","RIGHT_CLICK","raiseEvent","BufferAnalysis","pointBuffer","point","radius","pointF","units","buffer","coordinates","points","degreesArrayHeights","pointsToDegreesArray","fromDegreesArrayHeights","polylineBuffer","polylineF","lineString","buffered","polygonBuffer","map","item","push","SightLine","positions","tempPositions","polylineEntity","viewEntity","targetEntity","resultPolylines","forEach","length","handleFirstPosition","generateView","generatePolyline","polyline","width","PolylineDashMaterialProperty","depthFailMaterial","label","text","fillColor","WHITE","scale","font","distanceDisplayCondition","DistanceDisplayCondition","scaleByDistance","NearFarScalar","verticalOrigin","VerticalOrigin","BOTTOM","LabelStyle","FILL_AND_OUTLINE","pixelOffset","outlineWidth","BLACK","DODGERBLUE","pixelSize","disableDepthTestDistance","generateEndPoint","concat","startnalysis","direction","subtract","ray","Ray","result","pickFromRay","showIntersection","destPoint","viewPoint","resultLine","defined","object","drawResultLine","CHARTREUSE","leftPoint","secPoint","getCirclePoint","angle","dx","sin","PI","dy","cos","ec","ed","newLon","newLat","generateCirclePoints","center","steps","num","parseInt","i","Circle","circleEntity","generateCircle","ellipse","semiMinorAxis","getRadius","semiMajorAxis","BOTH","p1","p2","circlePoints","targetPositions","point2dToPoint3d","lines","point2ds","point3ds","cartesian3","clampToHeight","getClippingPlanes","pLength","clippingPlanes","nextIndex","midpoint","multiplyByScalar","up","right","normal","cross","originCenteredPlane","Plane","getPointDistance","ClippingPlane","Excavate","opitons","excavateDepth","bottomImage","sideImage","reverse","ClippingPlaneCollection","planes","edgeWidth","edgeColor","console","log","addSideWall","minimumHeights","Array","sideWall","wall","removeAll","imageryLayers","EntityDraw","drawType","drawEntity","DrawStartEvent","generatePoint","generatePolygon","perPositionHeight","minPositionCount"],"sources":["C:/Users/20606/Desktop/课程/三维GIS原理与应用/smartSchool/src/utils/spatialAnalysis.js"],"sourcesContent":["import * as turf from 'turf'\r\nimport glsl from './glsl'\r\n\r\nconst Cesium = require(\"../../node_modules/cesium/Source/Cesium.js\");\r\n\r\nclass LimitHeightAnalysis{\r\n    constructor(viewer, degreesArray, height, style) {\r\n        this.viewer = viewer;\r\n        this.degreesArray = degreesArray;\r\n        this.height = height;\r\n        this.style = style || {};\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        this.viewer.scene.invertClassification = true;\r\n        this.viewer.scene.invertClassificationColor = this.style.color || new Cesium.Color(1, 1, 1, 1);\r\n        this.addBottomPolygon();\r\n        this.addPrimitive();\r\n    }\r\n\r\n    addBottomPolygon() {\r\n        this.bottomPolygon = this.viewer.entities.add({\r\n            polygon: {\r\n                hierarchy: new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(this.degreesArray)),\r\n                height: new Cesium.CallbackProperty(e => {\r\n                    return this.height;\r\n                }, false),\r\n                material: Cesium.Color.YELLOW.withAlpha(0.2),\r\n                outline: true,\r\n                outlineColor: Cesium.Color.RED\r\n            }\r\n        })\r\n    }\r\n\r\n    addPrimitive() {\r\n        let geometry = this.createGeometry();\r\n        this.addClassificationPrimitive(geometry);\r\n    }\r\n\r\n    setHeight(height) {\r\n        this.height = height || 100;\r\n        this.removePrimitive();\r\n        this.addPrimitive();\r\n    }\r\n\r\n    createGeometry() {\r\n        return new Cesium.PolygonGeometry({\r\n            polygonHierarchy: new Cesium.PolygonHierarchy(\r\n                Cesium.Cartesian3.fromDegreesArray(this.degreesArray)\r\n            ),\r\n            height: this.height,\r\n            extrudedHeight: 200000,\r\n        });\r\n    }\r\n\r\n    addClassificationPrimitive(polygonGeometry) {\r\n        this.Primitive = this.viewer.scene.primitives.add(\r\n            new Cesium.ClassificationPrimitive({\r\n                geometryInstances: new Cesium.GeometryInstance({\r\n                    geometry: Cesium.PolygonGeometry.createGeometry(polygonGeometry),\r\n                    attributes: {\r\n                        color: Cesium.ColorGeometryInstanceAttribute.fromColor(\r\n                            Cesium.Color.RED.withAlpha(0.6) //颜色值\r\n                        ),\r\n                        show: new Cesium.ShowGeometryInstanceAttribute(true),\r\n                    },\r\n                }),\r\n                classificationType: Cesium.ClassificationType.CESIUM_3D_TILE,\r\n                asynchronous: !1,\r\n            })\r\n        );\r\n    }\r\n\r\n    removePrimitive() {\r\n        this.viewer.scene.primitives.remove(this.Primitive)\r\n    }\r\n\r\n    remove() {\r\n        this.removePrimitive();\r\n        this.viewer.scene.invertClassification = false;\r\n        this.viewer.entities.remove(this.bottomPolygon);\r\n    }\r\n}\r\n\r\nfunction getHeading(fromPosition, toPosition) {\r\n    let finalPosition = new Cesium.Cartesian3();\r\n    let matrix4 = Cesium.Transforms.eastNorthUpToFixedFrame(fromPosition);\r\n    Cesium.Matrix4.inverse(matrix4, matrix4);\r\n    Cesium.Matrix4.multiplyByPoint(matrix4, toPosition, finalPosition);\r\n    Cesium.Cartesian3.normalize(finalPosition, finalPosition);\r\n    return Cesium.Math.toDegrees(Math.atan2(finalPosition.x, finalPosition.y));\r\n}\r\n\r\nfunction getPitch(fromPosition, toPosition) {\r\n    let finalPosition = new Cesium.Cartesian3();\r\n    let matrix4 = Cesium.Transforms.eastNorthUpToFixedFrame(fromPosition);\r\n    Cesium.Matrix4.inverse(matrix4, matrix4);\r\n    Cesium.Matrix4.multiplyByPoint(matrix4, toPosition, finalPosition);\r\n    Cesium.Cartesian3.normalize(finalPosition, finalPosition);\r\n    return Cesium.Math.toDegrees(Math.asin(finalPosition.z));\r\n}\r\n\r\nclass CameraLine {\r\n    constructor(viewer, options) {\r\n        this.viewer = viewer;\r\n        this.viewPosition = options.viewPosition; //观察点\r\n        this.viewPositionEnd = options.viewPositionEnd; //结束点\r\n        this.viewDistance = this.getDistance();\r\n        this.viewHeading = this.getViewHeading();\r\n        this.viewPitch = this.getViewPitch();\r\n        this.horizontalViewAngle = options.horizontalViewAngle || 90.0;\r\n        this.verticalViewAngle = options.verticalViewAngle || 60.0;\r\n        this.drawSketch();\r\n        this.drawFrustumOutline();\r\n    }\r\n\r\n    updateEndPosition(endPosition) {\r\n        this.viewPositionEnd = endPosition;\r\n    }\r\n\r\n    getViewHeading() {\r\n        this.viewHeading = getHeading(this.viewPosition, this.viewPositionEnd);\r\n        return this.viewHeading;\r\n    }\r\n\r\n    getViewPitch() {\r\n        this.viewPitch = getPitch(this.viewPosition, this.viewPositionEnd);\r\n        return this.viewPitch;\r\n    }\r\n\r\n    getDistance() {\r\n        this.viewDistance = Cesium.Cartesian3.distance(this.viewPosition, this.viewPositionEnd);\r\n        return this.viewDistance;\r\n    }\r\n\r\n    getOptions() {\r\n        return {\r\n            viewPosition: this.viewPosition,\r\n            viewPositionEnd: this.viewPositionEnd,\r\n            viewDistance: this.viewDistance,\r\n            viewHeading: this.viewHeading,\r\n            viewPitch: this.viewPitch,\r\n            horizontalViewAngle: this.horizontalViewAngle,\r\n            verticalViewAngle: this.verticalViewAngle\r\n        }\r\n    }\r\n\r\n    drawFrustumOutline() {\r\n        this.frustumOutline = this.viewer.entities.add({\r\n            name: 'frustumOutline',\r\n            position: this.viewPosition,\r\n            orientation: new Cesium.CallbackProperty(e => {\r\n                return Cesium.Transforms.headingPitchRollQuaternion(\r\n                    this.viewPosition,\r\n                    Cesium.HeadingPitchRoll.fromDegrees(this.getViewHeading() - this.horizontalViewAngle, this.getViewPitch(), 0.0)\r\n                )\r\n            }, false),\r\n            ellipsoid: {\r\n                radii: new Cesium.CallbackProperty(e => {\r\n                    const distance = this.getDistance();\r\n                    return new Cesium.Cartesian3(distance, distance, distance);\r\n                }, false),\r\n                innerRadii: new Cesium.Cartesian3(0.01, 0.01, 0.01),\r\n                minimumClock: Cesium.Math.toRadians(-this.horizontalViewAngle / 2),\r\n                maximumClock: Cesium.Math.toRadians(this.horizontalViewAngle / 2),\r\n                minimumCone: Cesium.Math.toRadians(this.verticalViewAngle + 7.75),\r\n                maximumCone: Cesium.Math.toRadians(180 - this.verticalViewAngle - 7.75),\r\n                fill: false,\r\n                outline: true,\r\n                outlineColor: Cesium.Color.AQUA\r\n            }\r\n        });\r\n    }\r\n\r\n    drawSketch() {\r\n        this.sketch = this.viewer.entities.add({\r\n            name: 'sketch',\r\n            position: this.viewPosition,\r\n            orientation: new Cesium.CallbackProperty(e => {\r\n                return Cesium.Transforms.headingPitchRollQuaternion(\r\n                    this.viewPosition,\r\n                    Cesium.HeadingPitchRoll.fromDegrees(this.getViewHeading() - this.horizontalViewAngle, this.getViewPitch(), 0.0)\r\n                )\r\n            }, false),\r\n            ellipsoid: {\r\n                radii: new Cesium.CallbackProperty(e => {\r\n                    const distance = this.getDistance();\r\n                    return new Cesium.Cartesian3(distance, distance, distance);\r\n                }, false),\r\n                minimumClock: Cesium.Math.toRadians(-this.horizontalViewAngle / 2),\r\n                maximumClock: Cesium.Math.toRadians(this.horizontalViewAngle / 2),\r\n                minimumCone: Cesium.Math.toRadians(this.verticalViewAngle + 7.75),\r\n                maximumCone: Cesium.Math.toRadians(180 - this.verticalViewAngle - 7.75),\r\n                fill: false,\r\n                outline: true,\r\n                subdivisions: 256,\r\n                stackPartitions: 64,\r\n                slicePartitions: 64,\r\n                outlineColor: Cesium.Color.AQUA\r\n            }\r\n        });\r\n    }\r\n\r\n    remove() {\r\n        if (this.sketch) {\r\n            this.viewer.entities.remove(this.sketch);\r\n            this.sketch = null;\r\n        }\r\n\r\n        if (this.frustumOutline) {\r\n            this.viewer.entities.remove(this.frustumOutline);\r\n            this.frustumOutline = null;\r\n        }\r\n    }\r\n}\r\n\r\nclass Visibility {\r\n    constructor(viewer, options) {\r\n        this.viewer = viewer;\r\n        this.viewPosition = options.viewPosition;\r\n        this.viewPositionEnd = options.viewPositionEnd;\r\n        this.viewDistance = options.viewDistance;\r\n        this.viewHeading = options.viewHeading;\r\n        if (this.viewHeading < 0) {\r\n            this.viewHeading += 360;\r\n        }\r\n        this.viewPitch = options.viewPitch;\r\n        this.horizontalViewAngle = options.horizontalViewAngle || 90.0;\r\n        this.verticalViewAngle = options.verticalViewAngle || 90.0;\r\n        this.visibleAreaColor = options.visibleAreaColor || Cesium.Color.LIME; // Cesium.Color.GREEN;\r\n        this.invisibleAreaColor = options.invisibleAreaColor || Cesium.Color.RED;\r\n        this.enabled = (typeof options.enabled === \"boolean\") ? options.enabled : true;\r\n        this.softShadows = (typeof options.softShadows === \"boolean\") ? options.softShadows : true;\r\n        this.size = options.size || 2048;\r\n        this.add();\r\n    }\r\n\r\n    add() {\r\n        this.createLightCamera();\r\n        this.createShadowMap();\r\n        this.createPostStage();\r\n        this.drawFrustumOutline();\r\n        this.drawSketch();\r\n    }\r\n\r\n    getStyle() {\r\n        return {\r\n            viewHeading: this.viewHeading,\r\n            viewDistance: this.viewDistance,\r\n            horizontalViewAngle: this.horizontalViewAngle,\r\n            verticalViewAngle: this.verticalViewAngle\r\n        }\r\n    }\r\n\r\n    updateStyle(options) {\r\n        this.viewHeading = options.viewHeading;\r\n        this.viewDistance = options.viewDistance;\r\n        this.horizontalViewAngle = options.horizontalViewAngle;\r\n        this.verticalViewAngle = options.verticalViewAngle;\r\n        this.clear();\r\n        this.add();\r\n    }\r\n\r\n    remove() {\r\n        this.clear();\r\n    }\r\n\r\n    clear() {\r\n        if (this.sketch) {\r\n            this.viewer.entities.removeById(this.sketch.id);\r\n            this.sketch = null;\r\n        }\r\n\r\n        if (this.frustumOutline) {\r\n            this.viewer.entities.remove(this.frustumOutline);\r\n            this.frustumOutline = null;\r\n        }\r\n\r\n        if (this.postStage) {\r\n            this.viewer.scene.postProcessStages.remove(this.postStage);\r\n            this.postStage = null;\r\n        }\r\n    }\r\n\r\n    createLightCamera() {\r\n        this.lightCamera = new Cesium.Camera(this.viewer.scene);\r\n        this.lightCamera.position = this.viewPosition;\r\n        this.lightCamera.frustum.near = this.viewDistance * 0.001;\r\n        this.lightCamera.frustum.far = this.viewDistance;\r\n        const hr = Cesium.Math.toRadians(this.horizontalViewAngle);\r\n        const vr = Cesium.Math.toRadians(this.verticalViewAngle);\r\n        const aspectRatio =\r\n            (this.viewDistance * Math.tan(hr / 2) * 2) /\r\n            (this.viewDistance * Math.tan(vr / 2) * 2);\r\n        this.lightCamera.frustum.aspectRatio = aspectRatio;\r\n        if (hr > vr) {\r\n            this.lightCamera.frustum.fov = hr;\r\n        } else {\r\n            this.lightCamera.frustum.fov = vr;\r\n        }\r\n        this.lightCamera.setView({\r\n            destination: this.viewPosition,\r\n            orientation: {\r\n                heading: Cesium.Math.toRadians(this.viewHeading || 0),\r\n                pitch: Cesium.Math.toRadians(this.viewPitch || 0),\r\n                roll: 0\r\n            }\r\n        });\r\n    }\r\n\r\n    createShadowMap() {\r\n        this.shadowMap = new Cesium.ShadowMap({\r\n            context: (this.viewer.scene).context,\r\n            lightCamera: this.lightCamera,\r\n            enabled: this.enabled,\r\n            isPointLight: true,\r\n            pointLightRadius: this.viewDistance,\r\n            cascadesEnabled: false,\r\n            size: this.size,\r\n            softShadows: this.softShadows,\r\n            normalOffset: false,\r\n            fromLightSource: false\r\n        });\r\n        this.viewer.scene.shadowMap = this.shadowMap;\r\n    }\r\n\r\n    createPostStage() {\r\n        const fs = glsl\r\n        const postStage = new Cesium.PostProcessStage({\r\n            fragmentShader: fs,\r\n            uniforms: {\r\n                shadowMap_textureCube: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    return Reflect.get(this.shadowMap, \"_shadowMapTexture\");\r\n                },\r\n                shadowMap_matrix: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    return Reflect.get(this.shadowMap, \"_shadowMapMatrix\");\r\n                },\r\n                shadowMap_lightPositionEC: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    return Reflect.get(this.shadowMap, \"_lightPositionEC\");\r\n                },\r\n                shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    const bias = this.shadowMap._pointBias;\r\n                    return Cesium.Cartesian4.fromElements(\r\n                        bias.normalOffsetScale,\r\n                        this.shadowMap._distance,\r\n                        this.shadowMap.maximumDistance,\r\n                        0.0,\r\n                        new Cesium.Cartesian4()\r\n                    );\r\n                },\r\n                shadowMap_texelSizeDepthBiasAndNormalShadingSmooth: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    const bias = this.shadowMap._pointBias;\r\n                    const scratchTexelStepSize = new Cesium.Cartesian2();\r\n                    const texelStepSize = scratchTexelStepSize;\r\n                    texelStepSize.x = 1.0 / this.shadowMap._textureSize.x;\r\n                    texelStepSize.y = 1.0 / this.shadowMap._textureSize.y;\r\n                    return Cesium.Cartesian4.fromElements(\r\n                        texelStepSize.x,\r\n                        texelStepSize.y,\r\n                        bias.depthBias,\r\n                        bias.normalShadingSmooth,\r\n                        new Cesium.Cartesian4()\r\n                    );\r\n                },\r\n                camera_projection_matrix: () => {\r\n                    return this.lightCamera.frustum.projectionMatrix;\r\n                },\r\n                camera_view_matrix: () => {\r\n                    return this.lightCamera.viewMatrix;\r\n                },\r\n                x_viewDistance: () => {\r\n                    return this.viewDistance;\r\n                },\r\n                x_visibleAreaColor: this.visibleAreaColor,\r\n                x_invisibleAreaColor: this.invisibleAreaColor,\r\n            }\r\n        });\r\n        this.postStage = this.viewer.scene.postProcessStages.add(postStage);\r\n    }\r\n\r\n    drawFrustumOutline() {\r\n        this.frustumOutline = this.viewer.entities.add({\r\n            name: 'frustumOutline',\r\n            position: this.viewPosition,\r\n            orientation: new Cesium.CallbackProperty(e => {\r\n                return Cesium.Transforms.headingPitchRollQuaternion(\r\n                    this.viewPosition,\r\n                    Cesium.HeadingPitchRoll.fromDegrees(this.viewHeading - 90, this.viewPitch, 0.0)\r\n                )\r\n            }, false),\r\n            ellipsoid: {\r\n                radii: new Cesium.CallbackProperty(e => {\r\n                    return new Cesium.Cartesian3(this.viewDistance, this.viewDistance, this.viewDistance);\r\n                }, false),\r\n\r\n                innerRadii: new Cesium.Cartesian3(0.01, 0.01, 0.01),\r\n                minimumClock: new Cesium.CallbackProperty(e => {\r\n                    return Cesium.Math.toRadians(-this.horizontalViewAngle / 2);\r\n                }, false),\r\n                maximumClock: new Cesium.CallbackProperty(e => {\r\n                    return Cesium.Math.toRadians(this.horizontalViewAngle / 2);\r\n                }, false),\r\n                minimumCone: Cesium.Math.toRadians(this.verticalViewAngle + 7.75),\r\n                maximumCone: Cesium.Math.toRadians(180 - this.verticalViewAngle - 7.75),\r\n                fill: false,\r\n                slicePartitions: 64,\r\n                stackPartitions: 64,\r\n                outline: true,\r\n                outlineColor: Cesium.Color.AQUA\r\n            }\r\n        });\r\n    }\r\n\r\n    drawSketch() {\r\n        this.sketch = this.viewer.entities.add({\r\n            name: 'sketch',\r\n            position: this.viewPosition,\r\n            orientation: new Cesium.CallbackProperty(e => {\r\n                return Cesium.Transforms.headingPitchRollQuaternion(\r\n                    this.viewPosition,\r\n                    Cesium.HeadingPitchRoll.fromDegrees(this.viewHeading - 90, this.viewPitch, 0.0)\r\n                )\r\n            }, false),\r\n            ellipsoid: {\r\n                radii: new Cesium.CallbackProperty(e => {\r\n                    return new Cesium.Cartesian3(this.viewDistance, this.viewDistance, this.viewDistance);\r\n                }, false),\r\n                minimumClock: new Cesium.CallbackProperty(e => {\r\n                    return Cesium.Math.toRadians(-this.horizontalViewAngle / 2);\r\n                }, false),\r\n                maximumClock: new Cesium.CallbackProperty(e => {\r\n                    return Cesium.Math.toRadians(this.horizontalViewAngle / 2);\r\n                }, false),\r\n                minimumCone: Cesium.Math.toRadians(this.verticalViewAngle + 7.75),\r\n                maximumCone: Cesium.Math.toRadians(180 - this.verticalViewAngle - 7.75),\r\n                fill: false,\r\n                outline: true,\r\n                subdivisions: 256,\r\n                stackPartitions: 64,\r\n                slicePartitions: 64,\r\n                outlineColor: Cesium.Color.AQUA\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nclass VisibilityAnalysis {\r\n    constructor(viewer) {\r\n        this.viewer = viewer;\r\n        this.viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        this.initEvents();\r\n    }\r\n\r\n    activate() {\r\n        this.deactivate();\r\n        this.clear();\r\n        this.firstPosition = undefined;\r\n        this.registerEvents();\r\n    }\r\n\r\n    deactivate() {\r\n        this.unRegisterEvents();\r\n        this.viewer._element.style.cursor = 'pointer';\r\n        this.viewer.enableCursorStyle = true;\r\n    }\r\n\r\n    clear() {\r\n        if (this.cameraLine) {\r\n            this.cameraLine.remove();\r\n            this.cameraLine = undefined;\r\n        }\r\n    }\r\n\r\n    initEvents() {\r\n        this.handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);\r\n        this.DrawEndEvent = new Cesium.Event();\r\n    }\r\n\r\n    registerEvents() {\r\n        this.leftClickEvent();\r\n        this.rightClickEvent();\r\n        this.mouseMoveEvent();\r\n    }\r\n\r\n    leftClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.position);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.position, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            if (!this.firstPosition) {\r\n                this.firstPosition = this.getFirstPosition(position);\r\n            } else {\r\n                this.drawEnd();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n    }\r\n\r\n    getFirstPosition(position) {\r\n        const c = Cesium.Cartographic.fromCartesian(position);\r\n        const lon = Cesium.Math.toDegrees(c.longitude);\r\n        const lat = Cesium.Math.toDegrees(c.latitude);\r\n        const height = c.height + 1;\r\n        return Cesium.Cartesian3.fromDegrees(lon, lat, height);\r\n    }\r\n\r\n    createCameraLine(position) {\r\n        this.cameraLine = new CameraLine(this.viewer, {\r\n            viewPosition: this.firstPosition,\r\n            viewPositionEnd: position\r\n        })\r\n    }\r\n\r\n    mouseMoveEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.endPosition);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.startPosition, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            if (!this.firstPosition) return;\r\n\r\n            if (!this.cameraLine) {\r\n                this.createCameraLine(position);\r\n            } else {\r\n                this.cameraLine.updateEndPosition(position);\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n    }\r\n\r\n    rightClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            if (!this.firstPosition) {\r\n                this.deactivate()\r\n                return;\r\n            } else {\r\n                this.clear();\r\n                this.deactivate();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n    }\r\n\r\n    unRegisterEvents() {\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n    }\r\n\r\n    drawEnd() {\r\n        this.Visibility = new Visibility(this.viewer, this.cameraLine.getOptions());\r\n        this.DrawEndEvent.raiseEvent(this.Visibility);\r\n        this.cameraLine.remove();\r\n        this.deactivate();\r\n    }\r\n}\r\n\r\nclass BufferAnalysis {\r\n    static pointBuffer(point, radius, options) {\r\n        let pointF = turf.point(point);\r\n        options = options || {\r\n            units: 'meters',\r\n            z: 0\r\n        };\r\n        let buffer = turf.buffer(pointF, radius || 100, options.units);\r\n        let coordinates = buffer.geometry.coordinates;\r\n        let points = coordinates[0];\r\n        let degreesArrayHeights = this.pointsToDegreesArray(points, options.z || 0);\r\n        return Cesium.Cartesian3.fromDegreesArrayHeights(degreesArrayHeights);\r\n    }\r\n\r\n    static polylineBuffer(points, radius, options) {\r\n        let polylineF = turf.lineString(points);\r\n        options = options || {\r\n            units: 'meters',\r\n            z: 0\r\n        };\r\n        let buffered = turf.buffer(polylineF, radius || 100, options.units);\r\n        let coordinates = buffered.geometry.coordinates;\r\n        points = coordinates[0];\r\n        let degreesArrayHeights = this.pointsToDegreesArray(points, options.z || 0);\r\n        return Cesium.Cartesian3.fromDegreesArrayHeights(degreesArrayHeights);\r\n    }\r\n\r\n    static polygonBuffer(points, radius, options) {\r\n        return this.polylineBuffer(points, radius, options);\r\n    }\r\n\r\n    static pointsToDegreesArray(points, height) {\r\n        let degreesArray = [];\r\n        points.map(item => {\r\n            degreesArray.push(item[0]);\r\n            degreesArray.push(item[1]);\r\n            degreesArray.push(height);\r\n        });\r\n        return degreesArray;\r\n    }\r\n}\r\n\r\nclass SightLine {\r\n    constructor(viewer) {\r\n        this.viewer = viewer;\r\n        this.viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        this.initEvents();\r\n    }\r\n\r\n    activate() {\r\n        this.deactivate();\r\n        this.clear();\r\n        this.positions = [];\r\n        this.tempPositions = [];\r\n        this.registerEvents();\r\n        this.viewer.enableCursorStyle = false;\r\n        this.viewer._element.style.cursor = 'default';\r\n    }\r\n\r\n    deactivate() {\r\n        this.unRegisterEvents();\r\n        this.viewer._element.style.cursor = 'pointer';\r\n        this.viewer.enableCursorStyle = true;\r\n    }\r\n\r\n    clear() {\r\n        if (this.polylineEntity) {\r\n            this.viewer.entities.remove(this.polylineEntity);\r\n            this.polylineEntity = undefined;\r\n        }\r\n        if (this.viewEntity) {\r\n            this.viewer.entities.remove(this.viewEntity);\r\n            this.viewEntity = undefined;\r\n        }\r\n        if (this.targetEntity) {\r\n            this.viewer.entities.remove(this.targetEntity);\r\n            this.targetEntity = undefined;\r\n        }\r\n\r\n\r\n        if (this.resultPolylines) {\r\n            this.resultPolylines.forEach((item) => {\r\n                this.viewer.entities.remove(item);\r\n            })\r\n        }\r\n    }\r\n\r\n    initEvents() {\r\n        this.handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);\r\n    }\r\n\r\n    registerEvents() {\r\n        this.leftClickEvent();\r\n        this.rightClickEvent();\r\n        this.mouseMoveEvent();\r\n    }\r\n\r\n    leftClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.position);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.position, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            this.positions.push(position);\r\n            if (this.positions.length == 1) {\r\n                this.handleFirstPosition();\r\n            } else { //两点时结束\r\n                this.drawEnd();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n    }\r\n\r\n    handleFirstPosition() {\r\n        this.generateView();\r\n        this.generatePolyline();\r\n    }\r\n\r\n    generatePolyline() {\r\n        this.polylineEntity = this.viewer.entities.add({\r\n            polyline: {\r\n                positions: new Cesium.CallbackProperty(e => {\r\n                    return this.tempPositions;\r\n                }, false),\r\n                width: 2,\r\n                material: new Cesium.PolylineDashMaterialProperty({\r\n                    color: Cesium.Color.YELLOW,\r\n                }),\r\n                depthFailMaterial: new Cesium.PolylineDashMaterialProperty({\r\n                    color: Cesium.Color.YELLOW,\r\n                }),\r\n            }\r\n        })\r\n    }\r\n\r\n    generateView() {\r\n        this.viewEntity = this.viewer.entities.add({\r\n            position: this.positions[0],\r\n            label: {\r\n                text: \"观察位置\",\r\n                fillColor: Cesium.Color.WHITE,\r\n                scale: 0.5,\r\n                font: 'normal 34px MicroSoft YaHei',\r\n                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 5000),\r\n                scaleByDistance: new Cesium.NearFarScalar(500, 1, 1500, 0.4),\r\n                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\r\n                style: Cesium.LabelStyle.FILL_AND_OUTLINE,\r\n                pixelOffset: new Cesium.Cartesian2(0, -20),\r\n                outlineWidth: 3,\r\n                outlineColor: Cesium.Color.BLACK\r\n            },\r\n            point: {\r\n                color: Cesium.Color.DODGERBLUE,\r\n                pixelSize: 5,\r\n                outlineColor: Cesium.Color.WHITE,\r\n                outlineWidth: 2,\r\n                scaleByDistance: new Cesium.NearFarScalar(1000, 1, 4200, 0.4),\r\n                disableDepthTestDistance: 500,\r\n            },\r\n        })\r\n    }\r\n\r\n    generateEndPoint() {\r\n        this.targetEntity = this.viewer.entities.add({\r\n            position: this.positions[1],\r\n            label: {\r\n                text: \"目标位置\",\r\n                fillColor: Cesium.Color.WHITE,\r\n                scale: 0.5,\r\n                font: 'normal 34px MicroSoft YaHei',\r\n                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 5000),\r\n                scaleByDistance: new Cesium.NearFarScalar(500, 1, 1500, 0.4),\r\n                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\r\n                style: Cesium.LabelStyle.FILL_AND_OUTLINE,\r\n                pixelOffset: new Cesium.Cartesian2(0, -20),\r\n                outlineWidth: 3,\r\n                outlineColor: Cesium.Color.BLACK\r\n            },\r\n            point: {\r\n                color: Cesium.Color.DODGERBLUE,\r\n                pixelSize: 5,\r\n                outlineColor: Cesium.Color.WHITE,\r\n                outlineWidth: 2,\r\n                scaleByDistance: new Cesium.NearFarScalar(1000, 1, 4200, 0.4),\r\n                disableDepthTestDistance: 500,\r\n            },\r\n        })\r\n    }\r\n\r\n    mouseMoveEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.endPosition);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.startPosition, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            if (!this.polylineEntity) return;\r\n            this.tempPositions = this.positions.concat([position]);\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n    }\r\n\r\n    rightClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            if (!this.polylineEntity) {\r\n                this.deactivate()\r\n                return;\r\n            }\r\n            if (this.positions.length < 2) {\r\n                this.clear();\r\n                this.deactivate();\r\n                return;\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n    }\r\n\r\n    unRegisterEvents() {\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n    }\r\n\r\n    drawEnd() {\r\n        this.generateEndPoint();\r\n        this.startnalysis();\r\n        this.viewer.entities.remove(this.polylineEntity);\r\n        this.deactivate();\r\n    }\r\n\r\n    startnalysis() {\r\n        var direction = Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(this.positions[1], this.positions[0], new Cesium.Cartesian3()), new Cesium.Cartesian3());\r\n        var ray = new Cesium.Ray(this.positions[0], direction);\r\n        var result = this.viewer.scene.pickFromRay(ray, [this.viewEntity, this.targetEntity]); // 计算交互点，返回第一个\r\n        this.resultPolylines = this.showIntersection(result, this.positions[1], this.positions[0]);\r\n    }\r\n\r\n    showIntersection(result, destPoint, viewPoint) {\r\n        let resultPolylines = [];\r\n        let resultLine;\r\n        if (Cesium.defined(result) && Cesium.defined(result.object)) {\r\n            resultLine = this.drawResultLine(result.position, viewPoint, Cesium.Color.CHARTREUSE);\r\n            resultPolylines.push(resultLine);\r\n            resultLine = this.drawResultLine(result.position, destPoint, Cesium.Color.RED);\r\n            resultPolylines.push(resultLine);\r\n        } else {\r\n            resultLine = this.drawResultLine(viewPoint, destPoint, Cesium.Color.CHARTREUSE);\r\n            resultPolylines.push(resultLine);\r\n        }\r\n        return resultPolylines;\r\n    }\r\n\r\n    drawResultLine(leftPoint, secPoint, color) {\r\n        return this.viewer.entities.add({\r\n            polyline: {\r\n                positions: [leftPoint, secPoint],\r\n                width: 2,\r\n                material: color,\r\n                depthFailMaterial: color\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nfunction getCirclePoint(lon, lat, angle, radius) {\r\n    let dx = radius * Math.sin(angle * Math.PI / 180.0);\r\n    let dy = radius * Math.cos(angle * Math.PI / 180.0);\r\n    let ec = 6356725 + (6378137 - 6356725) * (90.0 - lat) / 90.0;\r\n    let ed = ec * Math.cos(lat * Math.PI / 180);\r\n    let newLon = (dx / ed + lon * Math.PI / 180.0) * 180.0 / Math.PI;\r\n    let newLat = (dy / ec + lat * Math.PI / 180.0) * 180.0 / Math.PI;\r\n    return [newLon, newLat];\r\n}\r\n\r\nfunction generateCirclePoints(center, radius, steps) {\r\n    let points = [];\r\n    steps = steps || 360;\r\n    let num = parseInt(360 / steps);\r\n    for (let i = 0; i <= 360; i += num) {\r\n        points.push(getCirclePoint(center[0], center[1], i, radius));\r\n    }\r\n    return points;\r\n}\r\n\r\nclass Circle {\r\n    constructor(viewer) {\r\n        this.viewer = viewer;\r\n        this.viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        this.initEvents();\r\n    }\r\n\r\n    activate() {\r\n        this.deactivate();\r\n        this.clear();\r\n        this.positions = [];\r\n        this.tempPositions = [];\r\n        this.registerEvents();\r\n        this.viewer.enableCursorStyle = false;\r\n        this.viewer._element.style.cursor = 'default';\r\n    }\r\n\r\n    deactivate() {\r\n        this.unRegisterEvents();\r\n        this.viewer._element.style.cursor = 'pointer';\r\n        this.viewer.enableCursorStyle = true;\r\n    }\r\n\r\n    clear() {\r\n        if (this.circleEntity) {\r\n            this.viewer.entities.remove(this.circleEntity);\r\n            this.circleEntity = undefined;\r\n        }\r\n        if (this.viewEntity) {\r\n            this.viewer.entities.remove(this.viewEntity);\r\n            this.viewEntity = undefined;\r\n        }\r\n\r\n        if (this.resultPolylines) {\r\n            this.resultPolylines.forEach((item) => {\r\n                this.viewer.entities.remove(item);\r\n            })\r\n        }\r\n    }\r\n\r\n    initEvents() {\r\n        this.handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);\r\n    }\r\n\r\n    registerEvents() {\r\n        this.leftClickEvent();\r\n        this.rightClickEvent();\r\n        this.mouseMoveEvent();\r\n    }\r\n\r\n    leftClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.position);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.position, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            this.positions.push(position);\r\n            if (this.positions.length == 1) {\r\n                this.tempPositions.push(position);\r\n                this.handleFirstPosition();\r\n            } else { //两点时结束\r\n                this.drawEnd();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n    }\r\n\r\n    handleFirstPosition() {\r\n        this.generateView();\r\n        this.generateCircle();\r\n    }\r\n\r\n    generateCircle() {\r\n        this.circleEntity = this.viewer.entities.add({\r\n            position: this.positions[0],\r\n            ellipse: {\r\n                semiMinorAxis: new Cesium.CallbackProperty(e => {\r\n                    return this.getRadius();\r\n                }, false),\r\n                semiMajorAxis: new Cesium.CallbackProperty(e => {\r\n                    return this.getRadius();\r\n                }, false),\r\n                material: Cesium.Color.RED.withAlpha(0.6),\r\n                classificationType: Cesium.ClassificationType.BOTH\r\n            },\r\n        })\r\n    }\r\n\r\n    getRadius() {\r\n        let p1 = this.tempPositions[0];\r\n        let p2 = this.tempPositions[0];\r\n        if (this.tempPositions.length > 1) p2 = this.tempPositions[1];\r\n        let distance = Cesium.Cartesian3.distance(p1, p2);\r\n        return distance == 0 ? 0.000001 : distance;\r\n    }\r\n\r\n    generateView() {\r\n        this.viewEntity = this.viewer.entities.add({\r\n            position: this.positions[0],\r\n            label: {\r\n                text: \"观察位置\",\r\n                fillColor: Cesium.Color.WHITE,\r\n                scale: 0.5,\r\n                font: 'normal 34px MicroSoft YaHei',\r\n                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 5000),\r\n                scaleByDistance: new Cesium.NearFarScalar(500, 1, 1500, 0.4),\r\n                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,\r\n                style: Cesium.LabelStyle.FILL_AND_OUTLINE,\r\n                pixelOffset: new Cesium.Cartesian2(0, -20),\r\n                outlineWidth: 3,\r\n                outlineColor: Cesium.Color.BLACK\r\n            },\r\n            point: {\r\n                color: Cesium.Color.DODGERBLUE,\r\n                pixelSize: 5,\r\n                outlineColor: Cesium.Color.WHITE,\r\n                outlineWidth: 2,\r\n                scaleByDistance: new Cesium.NearFarScalar(1000, 1, 4200, 0.4),\r\n                disableDepthTestDistance: 500,\r\n            },\r\n        })\r\n    }\r\n\r\n    mouseMoveEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.endPosition);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.startPosition, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            if (!this.circleEntity) return;\r\n            this.tempPositions = this.positions.concat([position]);\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n    }\r\n\r\n    rightClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            if (!this.circleEntity) {\r\n                this.deactivate()\r\n                return;\r\n            }\r\n            if (this.positions.length < 2) {\r\n                this.clear();\r\n                this.deactivate();\r\n                return;\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n    }\r\n\r\n    unRegisterEvents() {\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n    }\r\n\r\n    drawEnd() {\r\n        this.startnalysis();\r\n        this.viewer.entities.remove(this.circleEntity);\r\n        this.deactivate();\r\n    }\r\n\r\n    startnalysis() {\r\n        const c = Cesium.Cartographic.fromCartesian(this.positions[0]);\r\n        const center = [Cesium.Math.toDegrees(c.longitude), Cesium.Math.toDegrees(c.latitude)]\r\n        let circlePoints = generateCirclePoints(center, this.getRadius());\r\n        let targetPositions = this.point2dToPoint3d(circlePoints);\r\n        this.resultPolylines = [];\r\n        let direction, ray, result, lines;\r\n        for (let i = 0; i < targetPositions.length; i++) {\r\n            direction = Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(targetPositions[i], this.positions[0], new Cesium.Cartesian3()), new Cesium.Cartesian3());\r\n            ray = new Cesium.Ray(this.positions[0], direction);\r\n            result = this.viewer.scene.pickFromRay(ray, [this.viewEntity, this.targetEntity]);\r\n            lines = this.showIntersection(result, targetPositions[i], this.positions[0]);\r\n            this.resultPolylines = this.resultPolylines.concat(lines);\r\n        }\r\n    }\r\n\r\n    point2dToPoint3d(point2ds) {\r\n        let point3ds = [];\r\n        for (let i = 0; i < point2ds.length; i++) {\r\n            const item = point2ds[i];\r\n            const cartesian3 = Cesium.Cartesian3.fromDegrees(item[0], item[1], 0);\r\n            const c = this.viewer.scene.clampToHeight(cartesian3);\r\n            point3ds.push(c);\r\n        }\r\n        return point3ds;\r\n    }\r\n\r\n    showIntersection(result, destPoint, viewPoint) {\r\n        let resultPolylines = [];\r\n        let resultLine;\r\n        if (Cesium.defined(result) && Cesium.defined(result.object)) {\r\n            resultLine = this.drawResultLine(result.position, viewPoint, Cesium.Color.CHARTREUSE);\r\n            resultPolylines.push(resultLine);\r\n            resultLine = this.drawResultLine(result.position, destPoint, Cesium.Color.RED);\r\n            resultPolylines.push(resultLine);\r\n        } else {\r\n            resultLine = this.drawResultLine(viewPoint, destPoint, Cesium.Color.CHARTREUSE);\r\n            resultPolylines.push(resultLine);\r\n        }\r\n        return resultPolylines;\r\n    }\r\n\r\n    drawResultLine(leftPoint, secPoint, color) {\r\n        return this.viewer.entities.add({\r\n            polyline: {\r\n                positions: [leftPoint, secPoint],\r\n                width: 2,\r\n                material: color,\r\n                depthFailMaterial: color\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\n// function cartesian3ToDegrees(position) {\r\n//     let c = Cesium.Cartographic.fromCartesian(position);\r\n//     return [Cesium.Math.toDegrees(c.longitude), Cesium.Math.toDegrees(c.latitude)];\r\n// }\r\n\r\n// function booleanClockwise(positions) {\r\n//     let degreesArrary = [];\r\n//     positions.map(position => {\r\n//         degreesArrary.push(cartesian3ToDegrees(position));\r\n//     });\r\n//     //首尾闭合\r\n//     degreesArrary.push(degreesArrary[0]);\r\n//     let lineString = turf.lineString(degreesArrary);\r\n//     console.log(1)\r\n//     return turf.booleanClockwise(lineString)\r\n// }\r\n\r\nfunction getClippingPlanes(positions) {\r\n    let pLength = positions.length;\r\n    let clippingPlanes = []; // 存储ClippingPlane集合\r\n    for (let i = 0; i < pLength; ++i) {\r\n        let nextIndex = (i + 1) % pLength;\r\n        let midpoint = Cesium.Cartesian3.add(positions[i], positions[nextIndex], new Cesium.Cartesian3());\r\n        midpoint = Cesium.Cartesian3.multiplyByScalar(midpoint, 0.5, midpoint);\r\n\r\n        let up = Cesium.Cartesian3.normalize(midpoint, new Cesium.Cartesian3());\r\n        let right = Cesium.Cartesian3.subtract(positions[nextIndex], midpoint, new Cesium.Cartesian3());\r\n        right = Cesium.Cartesian3.normalize(right, right);\r\n\r\n        let normal = Cesium.Cartesian3.cross(right, up, new Cesium.Cartesian3());\r\n        normal = Cesium.Cartesian3.normalize(normal, normal);\r\n\r\n        let originCenteredPlane = new Cesium.Plane(normal, 0.0);\r\n        let distance = Cesium.Plane.getPointDistance(originCenteredPlane, midpoint);\r\n        clippingPlanes.push(new Cesium.ClippingPlane(normal, distance));\r\n    }\r\n    return clippingPlanes;\r\n}\r\n\r\nclass Excavate {\r\n    constructor(viewer) {\r\n        this.viewer = viewer;\r\n    }\r\n\r\n    add(positions, opitons) {\r\n        if (!opitons) opitons = {};\r\n        this.excavateDepth = opitons.excavateDepth || 200; //开挖深度\r\n        this.bottomImage = opitons.bottomImage || 'img/excavate_bottom_min.jpg';\r\n        this.sideImage = opitons.sideImage || 'img/excavate_side_min.jpg';\r\n        this.clear();\r\n        positions = positions.reverse();\r\n        let clippingPlanes = getClippingPlanes(positions);\r\n        this.viewer.scene.globe.clippingPlanes = new Cesium.ClippingPlaneCollection({\r\n            planes: clippingPlanes,\r\n            edgeWidth: 1.0,\r\n            edgeColor: Cesium.Color.WHITE\r\n        });\r\n        console.log(positions)\r\n        this.addBottomPolygon(positions);\r\n        this.addSideWall(positions);\r\n    }\r\n\r\n    addBottomPolygon(positions) {\r\n        this.bottomPolygon = this.viewer.entities.add({\r\n            polygon: {\r\n                hierarchy: positions,\r\n                material: this.bottomImage,\r\n                height: -this.excavateDepth\r\n            },\r\n        });\r\n    }\r\n\r\n    addSideWall(positions) {\r\n        positions.push(positions[0]); //首尾闭合\r\n        let minimumHeights = new Array(positions.length).fill(-this.excavateDepth);\r\n        this.sideWall = this.viewer.entities.add({\r\n            wall: {\r\n                positions: positions,\r\n                minimumHeights: minimumHeights,\r\n                material: this.sideImage\r\n            }\r\n        });\r\n    }\r\n\r\n    clear() {\r\n        this.viewer.entities.removeAll();\r\n        this.viewer.imageryLayers.removeAll(true);\r\n    }\r\n}\r\n\r\nclass EntityDraw {\r\n    constructor(viewer) {\r\n        this.viewer = viewer;\r\n        this.viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        this.initEvents();\r\n    }\r\n\r\n    activate(drawType) {\r\n        this.deactivate();\r\n        this.clear();\r\n        this.drawType = drawType;\r\n        this.positions = [];\r\n        this.tempPositions = [];\r\n        this.registerEvents();\r\n        this.viewer.enableCursorStyle = false;\r\n        this.viewer._element.style.cursor = 'default';\r\n    }\r\n\r\n    deactivate() {\r\n        this.unRegisterEvents();\r\n        this.drawType = undefined;\r\n        this.drawEntity = undefined;\r\n\r\n        this.viewer._element.style.cursor = 'pointer';\r\n        this.viewer.enableCursorStyle = true;\r\n    }\r\n\r\n    clear() {\r\n        if (this.drawEntity) {\r\n            this.viewer.entities.remove(this.drawEntity);\r\n            this.drawEntity = undefined;\r\n        }\r\n    }\r\n\r\n    initEvents() {\r\n        this.handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);\r\n        this.DrawStartEvent = new Cesium.Event();\r\n        this.DrawEndEvent = new Cesium.Event();\r\n    }\r\n\r\n    registerEvents() {\r\n        this.leftClickEvent();\r\n        this.rightClickEvent();\r\n        this.mouseMoveEvent();\r\n    }\r\n\r\n    leftClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.position);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.position, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            this.positions.push(position);\r\n            if (this.positions.length == 1) {\r\n                this.handleFirstPosition();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n    }\r\n\r\n    handleFirstPosition() {\r\n        switch (this.drawType) {\r\n            case \"Point\":\r\n                this.generatePoint();\r\n                this.drawEnd();\r\n                break;\r\n            case \"Polyline\":\r\n                this.generatePolyline();\r\n                break;\r\n            case \"Polygon\":\r\n                this.generatePolygon();\r\n                break;\r\n        }\r\n    }\r\n\r\n    generatePoint() {\r\n        this.drawEntity = this.viewer.entities.add({\r\n            position: this.positions[0],\r\n            point: {\r\n                pixelSize: 4,\r\n                color: Cesium.Color.RED\r\n            }\r\n        })\r\n    }\r\n\r\n    generatePolyline() {\r\n        this.drawEntity = this.viewer.entities.add({\r\n            polyline: {\r\n                positions: new Cesium.CallbackProperty(e => {\r\n                    return this.tempPositions;\r\n                }, false),\r\n                width: 2,\r\n                material: new Cesium.PolylineDashMaterialProperty({\r\n                    color: Cesium.Color.YELLOW,\r\n                }),\r\n                depthFailMaterial: new Cesium.PolylineDashMaterialProperty({\r\n                    color: Cesium.Color.YELLOW,\r\n                }),\r\n            }\r\n        })\r\n    }\r\n\r\n    generatePolygon() {\r\n        this.drawEntity = this.viewer.entities.add({\r\n            polygon: {\r\n                hierarchy: new Cesium.CallbackProperty(e => {\r\n                    return new Cesium.PolygonHierarchy(this.tempPositions);\r\n                }, false),\r\n                material: Cesium.Color.RED.withAlpha(0.4),\r\n                perPositionHeight: true\r\n            },\r\n            polyline: {\r\n                positions: new Cesium.CallbackProperty(e => {\r\n                    return this.tempPositions.concat(this.tempPositions[0]);\r\n                }, false),\r\n                width: 1,\r\n                material: new Cesium.PolylineDashMaterialProperty({\r\n                    color: Cesium.Color.YELLOW,\r\n                }),\r\n                depthFailMaterial: new Cesium.PolylineDashMaterialProperty({\r\n                    color: Cesium.Color.YELLOW,\r\n                }),\r\n            }\r\n        })\r\n    }\r\n\r\n    mouseMoveEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.endPosition);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.startPosition, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            if (!this.drawEntity) return;\r\n            this.tempPositions = this.positions.concat([position]);\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n    }\r\n\r\n    rightClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            if (!this.drawEntity) {\r\n                this.deactivate()\r\n                return;\r\n            }\r\n            switch (this.drawType) {\r\n                case \"Polyline\":\r\n                    this.drawEntity.polyline.positions = this.positions;\r\n                    this.minPositionCount = 2;\r\n                    break;\r\n                case \"Polygon\":\r\n                    this.drawEntity.polygon.hierarchy = this.positions;\r\n                    this.drawEntity.polyline.positions = this.positions.concat(this.positions[0]);\r\n                    this.minPositionCount = 3;\r\n                    break;\r\n            }\r\n            if (this.positions.length < this.minPositionCount) {\r\n                this.clear();\r\n                this.deactivate();\r\n                return;\r\n            }\r\n            this.drawEnd();\r\n        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n    }\r\n\r\n    unRegisterEvents() {\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n    }\r\n\r\n    drawEnd() {\r\n        this.drawEntity.remove = () => {\r\n            this.viewer.entities.remove(this.drawEntity);\r\n        }\r\n        this.DrawEndEvent.raiseEvent(this.drawEntity, this.positions, this.drawType);\r\n        this.deactivate();\r\n    }\r\n}\r\n\r\nexport default { LimitHeightAnalysis, VisibilityAnalysis, BufferAnalysis, SightLine, Circle, Excavate, EntityDraw }"],"mappings":"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"}]}