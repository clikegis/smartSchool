{"remainingRequest":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\src\\utils\\glsl.js","dependencies":[{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\src\\utils\\glsl.js","mtime":1617264765803},{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\babel.config.js","mtime":1656398191838},{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZXhwb3J0IGRlZmF1bHQgYAojZGVmaW5lIFVTRV9DVUJFX01BUF9TSEFET1cgdHJ1ZQp1bmlmb3JtIHNhbXBsZXIyRCBjb2xvclRleHR1cmU7CnVuaWZvcm0gc2FtcGxlcjJEIGRlcHRoVGV4dHVyZTsKdmFyeWluZyB2ZWMyIHZfdGV4dHVyZUNvb3JkaW5hdGVzOwp1bmlmb3JtIG1hdDQgY2FtZXJhX3Byb2plY3Rpb25fbWF0cml4Owp1bmlmb3JtIG1hdDQgY2FtZXJhX3ZpZXdfbWF0cml4Owp1bmlmb3JtIHNhbXBsZXJDdWJlIHNoYWRvd01hcF90ZXh0dXJlQ3ViZTsKdW5pZm9ybSBtYXQ0IHNoYWRvd01hcF9tYXRyaXg7CnVuaWZvcm0gdmVjNCBzaGFkb3dNYXBfbGlnaHRQb3NpdGlvbkVDOwp1bmlmb3JtIHZlYzQgc2hhZG93TWFwX25vcm1hbE9mZnNldFNjYWxlRGlzdGFuY2VNYXhEaXN0YW5jZUFuZERhcmtuZXNzOwp1bmlmb3JtIHZlYzQgc2hhZG93TWFwX3RleGVsU2l6ZURlcHRoQmlhc0FuZE5vcm1hbFNoYWRpbmdTbW9vdGg7CnVuaWZvcm0gZmxvYXQgeF92aWV3RGlzdGFuY2U7IAp1bmlmb3JtIHZlYzQgeF92aXNpYmxlQXJlYUNvbG9yOwp1bmlmb3JtIHZlYzQgeF9pbnZpc2libGVBcmVhQ29sb3I7CnN0cnVjdCB6eF9zaGFkb3dQYXJhbWV0ZXJzCnsKICAgIHZlYzMgdGV4Q29vcmRzOwogICAgZmxvYXQgZGVwdGhCaWFzOwogICAgZmxvYXQgZGVwdGg7CiAgICBmbG9hdCBuRG90TDsKICAgIHZlYzIgdGV4ZWxTdGVwU2l6ZTsKICAgIGZsb2F0IG5vcm1hbFNoYWRpbmdTbW9vdGg7CiAgICBmbG9hdCBkYXJrbmVzczsKfTsKZmxvYXQgY3ptX3NoYWRvd1Zpc2liaWxpdHkoc2FtcGxlckN1YmUgc2hhZG93TWFwLCB6eF9zaGFkb3dQYXJhbWV0ZXJzIHNoYWRvd1BhcmFtZXRlcnMpCnsKICAgIGZsb2F0IGRlcHRoQmlhcyA9IHNoYWRvd1BhcmFtZXRlcnMuZGVwdGhCaWFzOwogICAgZmxvYXQgZGVwdGggPSBzaGFkb3dQYXJhbWV0ZXJzLmRlcHRoOwogICAgZmxvYXQgbkRvdEwgPSBzaGFkb3dQYXJhbWV0ZXJzLm5Eb3RMOwogICAgZmxvYXQgbm9ybWFsU2hhZGluZ1Ntb290aCA9IHNoYWRvd1BhcmFtZXRlcnMubm9ybWFsU2hhZGluZ1Ntb290aDsKICAgIGZsb2F0IGRhcmtuZXNzID0gc2hhZG93UGFyYW1ldGVycy5kYXJrbmVzczsKICAgIHZlYzMgdXZ3ID0gc2hhZG93UGFyYW1ldGVycy50ZXhDb29yZHM7CiAgICBkZXB0aCAtPSBkZXB0aEJpYXM7CiAgICBmbG9hdCB2aXNpYmlsaXR5ID0gY3ptX3NoYWRvd0RlcHRoQ29tcGFyZShzaGFkb3dNYXAsIHV2dywgZGVwdGgpOwogICAgcmV0dXJuIGN6bV9wcml2YXRlX3NoYWRvd1Zpc2liaWxpdHkodmlzaWJpbGl0eSwgbkRvdEwsIG5vcm1hbFNoYWRpbmdTbW9vdGgsIGRhcmtuZXNzKTsKfQp2ZWM0IGdldFBvc2l0aW9uRUMoKXsKICAgIHJldHVybiBjem1fd2luZG93VG9FeWVDb29yZGluYXRlcyhnbF9GcmFnQ29vcmQpOwp9CnZlYzMgZ2V0Tm9ybWFsRUMoKXsKICAgIHJldHVybiB2ZWMzKDEuKTsKfQp2ZWM0IHRvRXllKGluIHZlYzIgdXYsaW4gZmxvYXQgZGVwdGgpewogICAgdmVjMiB4eT12ZWMyKCh1di54KjIuLTEuKSwodXYueSoyLi0xLikpOwogICAgdmVjNCBwb3NJbkNhbWVyYT1jem1faW52ZXJzZVByb2plY3Rpb24qdmVjNCh4eSxkZXB0aCwxLik7CiAgICBwb3NJbkNhbWVyYT1wb3NJbkNhbWVyYS9wb3NJbkNhbWVyYS53OwogICAgcmV0dXJuIHBvc0luQ2FtZXJhOwp9CnZlYzMgcG9pbnRQcm9qZWN0T25QbGFuZShpbiB2ZWMzIHBsYW5lTm9ybWFsLGluIHZlYzMgcGxhbmVPcmlnaW4saW4gdmVjMyBwb2ludCl7CiAgICB2ZWMzIHYwMT1wb2ludC1wbGFuZU9yaWdpbjsKICAgIGZsb2F0IGQ9ZG90KHBsYW5lTm9ybWFsLHYwMSk7CiAgICByZXR1cm4ocG9pbnQtcGxhbmVOb3JtYWwqZCk7Cn0KZmxvYXQgZ2V0RGVwdGgoaW4gdmVjNCBkZXB0aCl7CiAgICBmbG9hdCB6X3dpbmRvdz1jem1fdW5wYWNrRGVwdGgoZGVwdGgpOwogICAgel93aW5kb3c9Y3ptX3JldmVyc2VMb2dEZXB0aCh6X3dpbmRvdyk7CiAgICBmbG9hdCBuX3JhbmdlPWN6bV9kZXB0aFJhbmdlLm5lYXI7CiAgICBmbG9hdCBmX3JhbmdlPWN6bV9kZXB0aFJhbmdlLmZhcjsKICAgIHJldHVybigyLip6X3dpbmRvdy1uX3JhbmdlLWZfcmFuZ2UpLyhmX3JhbmdlLW5fcmFuZ2UpOwp9CmZsb2F0IHNoYWRvdyhpbiB2ZWM0IHBvc2l0aW9uRUMpewogICAgdmVjMyBub3JtYWxFQz1nZXROb3JtYWxFQygpOwogICAgenhfc2hhZG93UGFyYW1ldGVycyBzaGFkb3dQYXJhbWV0ZXJzOwogICAgc2hhZG93UGFyYW1ldGVycy50ZXhlbFN0ZXBTaXplPXNoYWRvd01hcF90ZXhlbFNpemVEZXB0aEJpYXNBbmROb3JtYWxTaGFkaW5nU21vb3RoLnh5OwogICAgc2hhZG93UGFyYW1ldGVycy5kZXB0aEJpYXM9c2hhZG93TWFwX3RleGVsU2l6ZURlcHRoQmlhc0FuZE5vcm1hbFNoYWRpbmdTbW9vdGguejsKICAgIHNoYWRvd1BhcmFtZXRlcnMubm9ybWFsU2hhZGluZ1Ntb290aD1zaGFkb3dNYXBfdGV4ZWxTaXplRGVwdGhCaWFzQW5kTm9ybWFsU2hhZGluZ1Ntb290aC53OwogICAgc2hhZG93UGFyYW1ldGVycy5kYXJrbmVzcz1zaGFkb3dNYXBfbm9ybWFsT2Zmc2V0U2NhbGVEaXN0YW5jZU1heERpc3RhbmNlQW5kRGFya25lc3MudzsKICAgIHZlYzMgZGlyZWN0aW9uRUM9cG9zaXRpb25FQy54eXotc2hhZG93TWFwX2xpZ2h0UG9zaXRpb25FQy54eXo7CiAgICBmbG9hdCBkaXN0YW5jZT1sZW5ndGgoZGlyZWN0aW9uRUMpOwogICAgZGlyZWN0aW9uRUM9bm9ybWFsaXplKGRpcmVjdGlvbkVDKTsKICAgIGZsb2F0IHJhZGl1cz1zaGFkb3dNYXBfbGlnaHRQb3NpdGlvbkVDLnc7CiAgICBpZihkaXN0YW5jZT5yYWRpdXMpCiAgICB7CiAgICAgICAgcmV0dXJuIDIuMDsKICAgIH0KICAgIHZlYzMgZGlyZWN0aW9uV0M9Y3ptX2ludmVyc2VWaWV3Um90YXRpb24qZGlyZWN0aW9uRUM7CiAgICBzaGFkb3dQYXJhbWV0ZXJzLmRlcHRoPWRpc3RhbmNlL3JhZGl1cy0wLjAwMDM7CiAgICBzaGFkb3dQYXJhbWV0ZXJzLm5Eb3RMPWNsYW1wKGRvdChub3JtYWxFQywtZGlyZWN0aW9uRUMpLDAuLDEuKTsKICAgIHNoYWRvd1BhcmFtZXRlcnMudGV4Q29vcmRzPWRpcmVjdGlvbldDOwogICAgZmxvYXQgdmlzaWJpbGl0eT1jem1fc2hhZG93VmlzaWJpbGl0eShzaGFkb3dNYXBfdGV4dHVyZUN1YmUsc2hhZG93UGFyYW1ldGVycyk7CiAgICByZXR1cm4gdmlzaWJpbGl0eTsKfQpib29sIHZpc2libGUoaW4gdmVjNCByZXN1bHQpCnsKICAgIHJlc3VsdC54Lz1yZXN1bHQudzsKICAgIHJlc3VsdC55Lz1yZXN1bHQudzsKICAgIHJlc3VsdC56Lz1yZXN1bHQudzsKICAgIHJldHVybiByZXN1bHQueD49LTEuJiZyZXN1bHQueDw9MS4KICAgICYmcmVzdWx0Lnk+PS0xLiYmcmVzdWx0Lnk8PTEuCiAgICAmJnJlc3VsdC56Pj0tMS4mJnJlc3VsdC56PD0xLjsKfQp2b2lkIG1haW4oKXsKICAgIC8vIOmHieiJsiA9IOe7k+aehOS6jOe7tCjpopzoibLnurnnkIYsIOe6ueeQhuWdkOaghykKICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRChjb2xvclRleHR1cmUsIHZfdGV4dHVyZUNvb3JkaW5hdGVzKTsKICAgIC8vIOa3seW6piA9IOiOt+WPlua3seW6pijnu5PmnoTkuoznu7Qo5rex5bqm57q555CGLCDnurnnkIblnZDmoIcpKQogICAgZmxvYXQgZGVwdGggPSBnZXREZXB0aCh0ZXh0dXJlMkQoZGVwdGhUZXh0dXJlLCB2X3RleHR1cmVDb29yZGluYXRlcykpOwogICAgLy8g6KeG6KeSID0gKOe6ueeQhuWdkOaghywg5rex5bqmKQogICAgdmVjNCB2aWV3UG9zID0gdG9FeWUodl90ZXh0dXJlQ29vcmRpbmF0ZXMsIGRlcHRoKTsKICAgIC8vIOS4lueVjOWdkOaghwogICAgdmVjNCB3b3JkUG9zID0gY3ptX2ludmVyc2VWaWV3ICogdmlld1BvczsKICAgIC8vIOiZmuaLn+ebuOacuuS4reWdkOaghwogICAgdmVjNCB2Y1BvcyA9IGNhbWVyYV92aWV3X21hdHJpeCAqIHdvcmRQb3M7CiAgICBmbG9hdCBuZWFyID0gLjAwMSAqIHhfdmlld0Rpc3RhbmNlOwogICAgZmxvYXQgZGlzID0gbGVuZ3RoKHZjUG9zLnh5eik7CiAgICBpZihkaXMgPiBuZWFyICYmIGRpcyA8IHhfdmlld0Rpc3RhbmNlKXsKICAgICAgICAvLyDpgI/op4bmipXlvbEKICAgICAgICB2ZWM0IHBvc0luRXllID0gY2FtZXJhX3Byb2plY3Rpb25fbWF0cml4ICogdmNQb3M7CiAgICAgICAgLy8g5Y+v6KeG5Yy66aKc6ImyCiAgICAgICAgLy8gIHZlYzQgeF92aXNpYmxlQXJlYUNvbG9yPXZlYzQoMC4sMS4sMC4sMS4wKTsKICAgICAgICAvLyAgdmVjNCB4X2ludmlzaWJsZUFyZWFDb2xvcj12ZWM0KDEuLDAuLDAuLDEuMCk7CiAgICAgICAgaWYodmlzaWJsZShwb3NJbkV5ZSkpewogICAgICAgICAgICBmbG9hdCB2aXMgPSBzaGFkb3codmlld1Bvcyk7CiAgICAgICAgICAgIGlmKHZpcyA+IDAuMyl7CiAgICAgICAgICAgICAgICBnbF9GcmFnQ29sb3IgPSBtaXgoZ2xfRnJhZ0NvbG9yLHhfdmlzaWJsZUFyZWFDb2xvciwuNyk7CiAgICAgICAgICAgIH0gZWxzZXsKICAgICAgICAgICAgICAgIGdsX0ZyYWdDb2xvciA9IG1peChnbF9GcmFnQ29sb3IseF9pbnZpc2libGVBcmVhQ29sb3IsLjcpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9YDs="},{"version":3,"names":[],"sources":["C:/Users/20606/Desktop/课程/三维GIS原理与应用/smartSchool/src/utils/glsl.js"],"sourcesContent":["export default `\r\n#define USE_CUBE_MAP_SHADOW true\r\nuniform sampler2D colorTexture;\r\nuniform sampler2D depthTexture;\r\nvarying vec2 v_textureCoordinates;\r\nuniform mat4 camera_projection_matrix;\r\nuniform mat4 camera_view_matrix;\r\nuniform samplerCube shadowMap_textureCube;\r\nuniform mat4 shadowMap_matrix;\r\nuniform vec4 shadowMap_lightPositionEC;\r\nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness;\r\nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth;\r\nuniform float x_viewDistance; \r\nuniform vec4 x_visibleAreaColor;\r\nuniform vec4 x_invisibleAreaColor;\r\nstruct zx_shadowParameters\r\n{\r\n    vec3 texCoords;\r\n    float depthBias;\r\n    float depth;\r\n    float nDotL;\r\n    vec2 texelStepSize;\r\n    float normalShadingSmooth;\r\n    float darkness;\r\n};\r\nfloat czm_shadowVisibility(samplerCube shadowMap, zx_shadowParameters shadowParameters)\r\n{\r\n    float depthBias = shadowParameters.depthBias;\r\n    float depth = shadowParameters.depth;\r\n    float nDotL = shadowParameters.nDotL;\r\n    float normalShadingSmooth = shadowParameters.normalShadingSmooth;\r\n    float darkness = shadowParameters.darkness;\r\n    vec3 uvw = shadowParameters.texCoords;\r\n    depth -= depthBias;\r\n    float visibility = czm_shadowDepthCompare(shadowMap, uvw, depth);\r\n    return czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\r\n}\r\nvec4 getPositionEC(){\r\n    return czm_windowToEyeCoordinates(gl_FragCoord);\r\n}\r\nvec3 getNormalEC(){\r\n    return vec3(1.);\r\n}\r\nvec4 toEye(in vec2 uv,in float depth){\r\n    vec2 xy=vec2((uv.x*2.-1.),(uv.y*2.-1.));\r\n    vec4 posInCamera=czm_inverseProjection*vec4(xy,depth,1.);\r\n    posInCamera=posInCamera/posInCamera.w;\r\n    return posInCamera;\r\n}\r\nvec3 pointProjectOnPlane(in vec3 planeNormal,in vec3 planeOrigin,in vec3 point){\r\n    vec3 v01=point-planeOrigin;\r\n    float d=dot(planeNormal,v01);\r\n    return(point-planeNormal*d);\r\n}\r\nfloat getDepth(in vec4 depth){\r\n    float z_window=czm_unpackDepth(depth);\r\n    z_window=czm_reverseLogDepth(z_window);\r\n    float n_range=czm_depthRange.near;\r\n    float f_range=czm_depthRange.far;\r\n    return(2.*z_window-n_range-f_range)/(f_range-n_range);\r\n}\r\nfloat shadow(in vec4 positionEC){\r\n    vec3 normalEC=getNormalEC();\r\n    zx_shadowParameters shadowParameters;\r\n    shadowParameters.texelStepSize=shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy;\r\n    shadowParameters.depthBias=shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z;\r\n    shadowParameters.normalShadingSmooth=shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w;\r\n    shadowParameters.darkness=shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w;\r\n    vec3 directionEC=positionEC.xyz-shadowMap_lightPositionEC.xyz;\r\n    float distance=length(directionEC);\r\n    directionEC=normalize(directionEC);\r\n    float radius=shadowMap_lightPositionEC.w;\r\n    if(distance>radius)\r\n    {\r\n        return 2.0;\r\n    }\r\n    vec3 directionWC=czm_inverseViewRotation*directionEC;\r\n    shadowParameters.depth=distance/radius-0.0003;\r\n    shadowParameters.nDotL=clamp(dot(normalEC,-directionEC),0.,1.);\r\n    shadowParameters.texCoords=directionWC;\r\n    float visibility=czm_shadowVisibility(shadowMap_textureCube,shadowParameters);\r\n    return visibility;\r\n}\r\nbool visible(in vec4 result)\r\n{\r\n    result.x/=result.w;\r\n    result.y/=result.w;\r\n    result.z/=result.w;\r\n    return result.x>=-1.&&result.x<=1.\r\n    &&result.y>=-1.&&result.y<=1.\r\n    &&result.z>=-1.&&result.z<=1.;\r\n}\r\nvoid main(){\r\n    // 釉色 = 结构二维(颜色纹理, 纹理坐标)\r\n    gl_FragColor = texture2D(colorTexture, v_textureCoordinates);\r\n    // 深度 = 获取深度(结构二维(深度纹理, 纹理坐标))\r\n    float depth = getDepth(texture2D(depthTexture, v_textureCoordinates));\r\n    // 视角 = (纹理坐标, 深度)\r\n    vec4 viewPos = toEye(v_textureCoordinates, depth);\r\n    // 世界坐标\r\n    vec4 wordPos = czm_inverseView * viewPos;\r\n    // 虚拟相机中坐标\r\n    vec4 vcPos = camera_view_matrix * wordPos;\r\n    float near = .001 * x_viewDistance;\r\n    float dis = length(vcPos.xyz);\r\n    if(dis > near && dis < x_viewDistance){\r\n        // 透视投影\r\n        vec4 posInEye = camera_projection_matrix * vcPos;\r\n        // 可视区颜色\r\n        //  vec4 x_visibleAreaColor=vec4(0.,1.,0.,1.0);\r\n        //  vec4 x_invisibleAreaColor=vec4(1.,0.,0.,1.0);\r\n        if(visible(posInEye)){\r\n            float vis = shadow(viewPos);\r\n            if(vis > 0.3){\r\n                gl_FragColor = mix(gl_FragColor,x_visibleAreaColor,.7);\r\n            } else{\r\n                gl_FragColor = mix(gl_FragColor,x_invisibleAreaColor,.7);\r\n            }\r\n        }\r\n    }\r\n}`;"],"mappings":"AAAA,eAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAxHA"}]}