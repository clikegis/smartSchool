{"remainingRequest":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\src\\utils\\spatialAnalysis.js","dependencies":[{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\src\\utils\\spatialAnalysis.js","mtime":1654057565650},{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\babel.config.js","mtime":1656398191838},{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\20606\\Desktop\\课程\\三维GIS原理与应用\\smartSchool\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICogYXMgQ2VzaXVtIGZyb20gJ2Nlc2l1bSc7CmltcG9ydCAqIGFzIHR1cmYgZnJvbSAndHVyZic7CmltcG9ydCBnbHNsIGZyb20gJy4vZ2xzbCc7CgpjbGFzcyBMaW1pdEhlaWdodEFuYWx5c2lzIHsKICBjb25zdHJ1Y3Rvcih2aWV3ZXIsIGRlZ3JlZXNBcnJheSwgaGVpZ2h0LCBzdHlsZSkgewogICAgdGhpcy52aWV3ZXIgPSB2aWV3ZXI7CiAgICB0aGlzLmRlZ3JlZXNBcnJheSA9IGRlZ3JlZXNBcnJheTsKICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgdGhpcy5zdHlsZSA9IHN0eWxlIHx8IHt9OwogICAgdGhpcy5pbml0KCk7CiAgfQoKICBpbml0KCkgewogICAgdGhpcy52aWV3ZXIuc2NlbmUuaW52ZXJ0Q2xhc3NpZmljYXRpb24gPSB0cnVlOwogICAgdGhpcy52aWV3ZXIuc2NlbmUuaW52ZXJ0Q2xhc3NpZmljYXRpb25Db2xvciA9IHRoaXMuc3R5bGUuY29sb3IgfHwgbmV3IENlc2l1bS5Db2xvcigxLCAxLCAxLCAxKTsKICAgIHRoaXMuYWRkQm90dG9tUG9seWdvbigpOwogICAgdGhpcy5hZGRQcmltaXRpdmUoKTsKICB9CgogIGFkZEJvdHRvbVBvbHlnb24oKSB7CiAgICB0aGlzLmJvdHRvbVBvbHlnb24gPSB0aGlzLnZpZXdlci5lbnRpdGllcy5hZGQoewogICAgICBwb2x5Z29uOiB7CiAgICAgICAgaGllcmFyY2h5OiBuZXcgQ2VzaXVtLlBvbHlnb25IaWVyYXJjaHkoQ2VzaXVtLkNhcnRlc2lhbjMuZnJvbURlZ3JlZXNBcnJheSh0aGlzLmRlZ3JlZXNBcnJheSkpLAogICAgICAgIGhlaWdodDogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0OwogICAgICAgIH0sIGZhbHNlKSwKICAgICAgICBtYXRlcmlhbDogQ2VzaXVtLkNvbG9yLllFTExPVy53aXRoQWxwaGEoMC4yKSwKICAgICAgICBvdXRsaW5lOiB0cnVlLAogICAgICAgIG91dGxpbmVDb2xvcjogQ2VzaXVtLkNvbG9yLlJFRAogICAgICB9CiAgICB9KTsKICB9CgogIGFkZFByaW1pdGl2ZSgpIHsKICAgIGxldCBnZW9tZXRyeSA9IHRoaXMuY3JlYXRlR2VvbWV0cnkoKTsKICAgIHRoaXMuYWRkQ2xhc3NpZmljYXRpb25QcmltaXRpdmUoZ2VvbWV0cnkpOwogIH0KCiAgc2V0SGVpZ2h0KGhlaWdodCkgewogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQgfHwgMTAwOwogICAgdGhpcy5yZW1vdmVQcmltaXRpdmUoKTsKICAgIHRoaXMuYWRkUHJpbWl0aXZlKCk7CiAgfQoKICBjcmVhdGVHZW9tZXRyeSgpIHsKICAgIHJldHVybiBuZXcgQ2VzaXVtLlBvbHlnb25HZW9tZXRyeSh7CiAgICAgIHBvbHlnb25IaWVyYXJjaHk6IG5ldyBDZXNpdW0uUG9seWdvbkhpZXJhcmNoeShDZXNpdW0uQ2FydGVzaWFuMy5mcm9tRGVncmVlc0FycmF5KHRoaXMuZGVncmVlc0FycmF5KSksCiAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQsCiAgICAgIGV4dHJ1ZGVkSGVpZ2h0OiAyMDAwMDAKICAgIH0pOwogIH0KCiAgYWRkQ2xhc3NpZmljYXRpb25QcmltaXRpdmUocG9seWdvbkdlb21ldHJ5KSB7CiAgICB0aGlzLlByaW1pdGl2ZSA9IHRoaXMudmlld2VyLnNjZW5lLnByaW1pdGl2ZXMuYWRkKG5ldyBDZXNpdW0uQ2xhc3NpZmljYXRpb25QcmltaXRpdmUoewogICAgICBnZW9tZXRyeUluc3RhbmNlczogbmV3IENlc2l1bS5HZW9tZXRyeUluc3RhbmNlKHsKICAgICAgICBnZW9tZXRyeTogQ2VzaXVtLlBvbHlnb25HZW9tZXRyeS5jcmVhdGVHZW9tZXRyeShwb2x5Z29uR2VvbWV0cnkpLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGNvbG9yOiBDZXNpdW0uQ29sb3JHZW9tZXRyeUluc3RhbmNlQXR0cmlidXRlLmZyb21Db2xvcihDZXNpdW0uQ29sb3IuUkVELndpdGhBbHBoYSgwLjYpIC8v6aKc6Imy5YC8CiAgICAgICAgICApLAogICAgICAgICAgc2hvdzogbmV3IENlc2l1bS5TaG93R2VvbWV0cnlJbnN0YW5jZUF0dHJpYnV0ZSh0cnVlKQogICAgICAgIH0KICAgICAgfSksCiAgICAgIGNsYXNzaWZpY2F0aW9uVHlwZTogQ2VzaXVtLkNsYXNzaWZpY2F0aW9uVHlwZS5DRVNJVU1fM0RfVElMRSwKICAgICAgYXN5bmNocm9ub3VzOiAhMQogICAgfSkpOwogIH0KCiAgcmVtb3ZlUHJpbWl0aXZlKCkgewogICAgdGhpcy52aWV3ZXIuc2NlbmUucHJpbWl0aXZlcy5yZW1vdmUodGhpcy5QcmltaXRpdmUpOwogIH0KCiAgcmVtb3ZlKCkgewogICAgdGhpcy5yZW1vdmVQcmltaXRpdmUoKTsKICAgIHRoaXMudmlld2VyLnNjZW5lLmludmVydENsYXNzaWZpY2F0aW9uID0gZmFsc2U7CiAgICB0aGlzLnZpZXdlci5lbnRpdGllcy5yZW1vdmUodGhpcy5ib3R0b21Qb2x5Z29uKTsKICB9Cgp9CgpmdW5jdGlvbiBnZXRIZWFkaW5nKGZyb21Qb3NpdGlvbiwgdG9Qb3NpdGlvbikgewogIGxldCBmaW5hbFBvc2l0aW9uID0gbmV3IENlc2l1bS5DYXJ0ZXNpYW4zKCk7CiAgbGV0IG1hdHJpeDQgPSBDZXNpdW0uVHJhbnNmb3Jtcy5lYXN0Tm9ydGhVcFRvRml4ZWRGcmFtZShmcm9tUG9zaXRpb24pOwogIENlc2l1bS5NYXRyaXg0LmludmVyc2UobWF0cml4NCwgbWF0cml4NCk7CiAgQ2VzaXVtLk1hdHJpeDQubXVsdGlwbHlCeVBvaW50KG1hdHJpeDQsIHRvUG9zaXRpb24sIGZpbmFsUG9zaXRpb24pOwogIENlc2l1bS5DYXJ0ZXNpYW4zLm5vcm1hbGl6ZShmaW5hbFBvc2l0aW9uLCBmaW5hbFBvc2l0aW9uKTsKICByZXR1cm4gQ2VzaXVtLk1hdGgudG9EZWdyZWVzKE1hdGguYXRhbjIoZmluYWxQb3NpdGlvbi54LCBmaW5hbFBvc2l0aW9uLnkpKTsKfQoKZnVuY3Rpb24gZ2V0UGl0Y2goZnJvbVBvc2l0aW9uLCB0b1Bvc2l0aW9uKSB7CiAgbGV0IGZpbmFsUG9zaXRpb24gPSBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoKTsKICBsZXQgbWF0cml4NCA9IENlc2l1bS5UcmFuc2Zvcm1zLmVhc3ROb3J0aFVwVG9GaXhlZEZyYW1lKGZyb21Qb3NpdGlvbik7CiAgQ2VzaXVtLk1hdHJpeDQuaW52ZXJzZShtYXRyaXg0LCBtYXRyaXg0KTsKICBDZXNpdW0uTWF0cml4NC5tdWx0aXBseUJ5UG9pbnQobWF0cml4NCwgdG9Qb3NpdGlvbiwgZmluYWxQb3NpdGlvbik7CiAgQ2VzaXVtLkNhcnRlc2lhbjMubm9ybWFsaXplKGZpbmFsUG9zaXRpb24sIGZpbmFsUG9zaXRpb24pOwogIHJldHVybiBDZXNpdW0uTWF0aC50b0RlZ3JlZXMoTWF0aC5hc2luKGZpbmFsUG9zaXRpb24ueikpOwp9CgpjbGFzcyBDYW1lcmFMaW5lIHsKICBjb25zdHJ1Y3Rvcih2aWV3ZXIsIG9wdGlvbnMpIHsKICAgIHRoaXMudmlld2VyID0gdmlld2VyOwogICAgdGhpcy52aWV3UG9zaXRpb24gPSBvcHRpb25zLnZpZXdQb3NpdGlvbjsgLy/op4Llr5/ngrkKCiAgICB0aGlzLnZpZXdQb3NpdGlvbkVuZCA9IG9wdGlvbnMudmlld1Bvc2l0aW9uRW5kOyAvL+e7k+adn+eCuQoKICAgIHRoaXMudmlld0Rpc3RhbmNlID0gdGhpcy5nZXREaXN0YW5jZSgpOwogICAgdGhpcy52aWV3SGVhZGluZyA9IHRoaXMuZ2V0Vmlld0hlYWRpbmcoKTsKICAgIHRoaXMudmlld1BpdGNoID0gdGhpcy5nZXRWaWV3UGl0Y2goKTsKICAgIHRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSA9IG9wdGlvbnMuaG9yaXpvbnRhbFZpZXdBbmdsZSB8fCA5MC4wOwogICAgdGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSA9IG9wdGlvbnMudmVydGljYWxWaWV3QW5nbGUgfHwgNjAuMDsKICAgIHRoaXMuZHJhd1NrZXRjaCgpOwogICAgdGhpcy5kcmF3RnJ1c3R1bU91dGxpbmUoKTsKICB9CgogIHVwZGF0ZUVuZFBvc2l0aW9uKGVuZFBvc2l0aW9uKSB7CiAgICB0aGlzLnZpZXdQb3NpdGlvbkVuZCA9IGVuZFBvc2l0aW9uOwogIH0KCiAgZ2V0Vmlld0hlYWRpbmcoKSB7CiAgICB0aGlzLnZpZXdIZWFkaW5nID0gZ2V0SGVhZGluZyh0aGlzLnZpZXdQb3NpdGlvbiwgdGhpcy52aWV3UG9zaXRpb25FbmQpOwogICAgcmV0dXJuIHRoaXMudmlld0hlYWRpbmc7CiAgfQoKICBnZXRWaWV3UGl0Y2goKSB7CiAgICB0aGlzLnZpZXdQaXRjaCA9IGdldFBpdGNoKHRoaXMudmlld1Bvc2l0aW9uLCB0aGlzLnZpZXdQb3NpdGlvbkVuZCk7CiAgICByZXR1cm4gdGhpcy52aWV3UGl0Y2g7CiAgfQoKICBnZXREaXN0YW5jZSgpIHsKICAgIHRoaXMudmlld0Rpc3RhbmNlID0gQ2VzaXVtLkNhcnRlc2lhbjMuZGlzdGFuY2UodGhpcy52aWV3UG9zaXRpb24sIHRoaXMudmlld1Bvc2l0aW9uRW5kKTsKICAgIHJldHVybiB0aGlzLnZpZXdEaXN0YW5jZTsKICB9CgogIGdldE9wdGlvbnMoKSB7CiAgICByZXR1cm4gewogICAgICB2aWV3UG9zaXRpb246IHRoaXMudmlld1Bvc2l0aW9uLAogICAgICB2aWV3UG9zaXRpb25FbmQ6IHRoaXMudmlld1Bvc2l0aW9uRW5kLAogICAgICB2aWV3RGlzdGFuY2U6IHRoaXMudmlld0Rpc3RhbmNlLAogICAgICB2aWV3SGVhZGluZzogdGhpcy52aWV3SGVhZGluZywKICAgICAgdmlld1BpdGNoOiB0aGlzLnZpZXdQaXRjaCwKICAgICAgaG9yaXpvbnRhbFZpZXdBbmdsZTogdGhpcy5ob3Jpem9udGFsVmlld0FuZ2xlLAogICAgICB2ZXJ0aWNhbFZpZXdBbmdsZTogdGhpcy52ZXJ0aWNhbFZpZXdBbmdsZQogICAgfTsKICB9CgogIGRyYXdGcnVzdHVtT3V0bGluZSgpIHsKICAgIHRoaXMuZnJ1c3R1bU91dGxpbmUgPSB0aGlzLnZpZXdlci5lbnRpdGllcy5hZGQoewogICAgICBuYW1lOiAnZnJ1c3R1bU91dGxpbmUnLAogICAgICBwb3NpdGlvbjogdGhpcy52aWV3UG9zaXRpb24sCiAgICAgIG9yaWVudGF0aW9uOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgcmV0dXJuIENlc2l1bS5UcmFuc2Zvcm1zLmhlYWRpbmdQaXRjaFJvbGxRdWF0ZXJuaW9uKHRoaXMudmlld1Bvc2l0aW9uLCBDZXNpdW0uSGVhZGluZ1BpdGNoUm9sbC5mcm9tRGVncmVlcyh0aGlzLmdldFZpZXdIZWFkaW5nKCkgLSB0aGlzLmhvcml6b250YWxWaWV3QW5nbGUsIHRoaXMuZ2V0Vmlld1BpdGNoKCksIDAuMCkpOwogICAgICB9LCBmYWxzZSksCiAgICAgIGVsbGlwc29pZDogewogICAgICAgIHJhZGlpOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IHRoaXMuZ2V0RGlzdGFuY2UoKTsKICAgICAgICAgIHJldHVybiBuZXcgQ2VzaXVtLkNhcnRlc2lhbjMoZGlzdGFuY2UsIGRpc3RhbmNlLCBkaXN0YW5jZSk7CiAgICAgICAgfSwgZmFsc2UpLAogICAgICAgIGlubmVyUmFkaWk6IG5ldyBDZXNpdW0uQ2FydGVzaWFuMygwLjAxLCAwLjAxLCAwLjAxKSwKICAgICAgICBtaW5pbXVtQ2xvY2s6IENlc2l1bS5NYXRoLnRvUmFkaWFucygtdGhpcy5ob3Jpem9udGFsVmlld0FuZ2xlIC8gMiksCiAgICAgICAgbWF4aW11bUNsb2NrOiBDZXNpdW0uTWF0aC50b1JhZGlhbnModGhpcy5ob3Jpem9udGFsVmlld0FuZ2xlIC8gMiksCiAgICAgICAgbWluaW11bUNvbmU6IENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLnZlcnRpY2FsVmlld0FuZ2xlICsgNy43NSksCiAgICAgICAgbWF4aW11bUNvbmU6IENlc2l1bS5NYXRoLnRvUmFkaWFucygxODAgLSB0aGlzLnZlcnRpY2FsVmlld0FuZ2xlIC0gNy43NSksCiAgICAgICAgZmlsbDogZmFsc2UsCiAgICAgICAgb3V0bGluZTogdHJ1ZSwKICAgICAgICBvdXRsaW5lQ29sb3I6IENlc2l1bS5Db2xvci5BUVVBCiAgICAgIH0KICAgIH0pOwogIH0KCiAgZHJhd1NrZXRjaCgpIHsKICAgIHRoaXMuc2tldGNoID0gdGhpcy52aWV3ZXIuZW50aXRpZXMuYWRkKHsKICAgICAgbmFtZTogJ3NrZXRjaCcsCiAgICAgIHBvc2l0aW9uOiB0aGlzLnZpZXdQb3NpdGlvbiwKICAgICAgb3JpZW50YXRpb246IG5ldyBDZXNpdW0uQ2FsbGJhY2tQcm9wZXJ0eShlID0+IHsKICAgICAgICByZXR1cm4gQ2VzaXVtLlRyYW5zZm9ybXMuaGVhZGluZ1BpdGNoUm9sbFF1YXRlcm5pb24odGhpcy52aWV3UG9zaXRpb24sIENlc2l1bS5IZWFkaW5nUGl0Y2hSb2xsLmZyb21EZWdyZWVzKHRoaXMuZ2V0Vmlld0hlYWRpbmcoKSAtIHRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSwgdGhpcy5nZXRWaWV3UGl0Y2goKSwgMC4wKSk7CiAgICAgIH0sIGZhbHNlKSwKICAgICAgZWxsaXBzb2lkOiB7CiAgICAgICAgcmFkaWk6IG5ldyBDZXNpdW0uQ2FsbGJhY2tQcm9wZXJ0eShlID0+IHsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gdGhpcy5nZXREaXN0YW5jZSgpOwogICAgICAgICAgcmV0dXJuIG5ldyBDZXNpdW0uQ2FydGVzaWFuMyhkaXN0YW5jZSwgZGlzdGFuY2UsIGRpc3RhbmNlKTsKICAgICAgICB9LCBmYWxzZSksCiAgICAgICAgbWluaW11bUNsb2NrOiBDZXNpdW0uTWF0aC50b1JhZGlhbnMoLXRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSAvIDIpLAogICAgICAgIG1heGltdW1DbG9jazogQ2VzaXVtLk1hdGgudG9SYWRpYW5zKHRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSAvIDIpLAogICAgICAgIG1pbmltdW1Db25lOiBDZXNpdW0uTWF0aC50b1JhZGlhbnModGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSArIDcuNzUpLAogICAgICAgIG1heGltdW1Db25lOiBDZXNpdW0uTWF0aC50b1JhZGlhbnMoMTgwIC0gdGhpcy52ZXJ0aWNhbFZpZXdBbmdsZSAtIDcuNzUpLAogICAgICAgIGZpbGw6IGZhbHNlLAogICAgICAgIG91dGxpbmU6IHRydWUsCiAgICAgICAgc3ViZGl2aXNpb25zOiAyNTYsCiAgICAgICAgc3RhY2tQYXJ0aXRpb25zOiA2NCwKICAgICAgICBzbGljZVBhcnRpdGlvbnM6IDY0LAogICAgICAgIG91dGxpbmVDb2xvcjogQ2VzaXVtLkNvbG9yLkFRVUEKICAgICAgfQogICAgfSk7CiAgfQoKICByZW1vdmUoKSB7CiAgICBpZiAodGhpcy5za2V0Y2gpIHsKICAgICAgdGhpcy52aWV3ZXIuZW50aXRpZXMucmVtb3ZlKHRoaXMuc2tldGNoKTsKICAgICAgdGhpcy5za2V0Y2ggPSBudWxsOwogICAgfQoKICAgIGlmICh0aGlzLmZydXN0dW1PdXRsaW5lKSB7CiAgICAgIHRoaXMudmlld2VyLmVudGl0aWVzLnJlbW92ZSh0aGlzLmZydXN0dW1PdXRsaW5lKTsKICAgICAgdGhpcy5mcnVzdHVtT3V0bGluZSA9IG51bGw7CiAgICB9CiAgfQoKfQoKY2xhc3MgVmlzaWJpbGl0eSB7CiAgY29uc3RydWN0b3Iodmlld2VyLCBvcHRpb25zKSB7CiAgICB0aGlzLnZpZXdlciA9IHZpZXdlcjsKICAgIHRoaXMudmlld1Bvc2l0aW9uID0gb3B0aW9ucy52aWV3UG9zaXRpb247CiAgICB0aGlzLnZpZXdQb3NpdGlvbkVuZCA9IG9wdGlvbnMudmlld1Bvc2l0aW9uRW5kOwogICAgdGhpcy52aWV3RGlzdGFuY2UgPSBvcHRpb25zLnZpZXdEaXN0YW5jZTsKICAgIHRoaXMudmlld0hlYWRpbmcgPSBvcHRpb25zLnZpZXdIZWFkaW5nOwoKICAgIGlmICh0aGlzLnZpZXdIZWFkaW5nIDwgMCkgewogICAgICB0aGlzLnZpZXdIZWFkaW5nICs9IDM2MDsKICAgIH0KCiAgICB0aGlzLnZpZXdQaXRjaCA9IG9wdGlvbnMudmlld1BpdGNoOwogICAgdGhpcy5ob3Jpem9udGFsVmlld0FuZ2xlID0gb3B0aW9ucy5ob3Jpem9udGFsVmlld0FuZ2xlIHx8IDkwLjA7CiAgICB0aGlzLnZlcnRpY2FsVmlld0FuZ2xlID0gb3B0aW9ucy52ZXJ0aWNhbFZpZXdBbmdsZSB8fCA5MC4wOwogICAgdGhpcy52aXNpYmxlQXJlYUNvbG9yID0gb3B0aW9ucy52aXNpYmxlQXJlYUNvbG9yIHx8IENlc2l1bS5Db2xvci5MSU1FOyAvLyBDZXNpdW0uQ29sb3IuR1JFRU47CgogICAgdGhpcy5pbnZpc2libGVBcmVhQ29sb3IgPSBvcHRpb25zLmludmlzaWJsZUFyZWFDb2xvciB8fCBDZXNpdW0uQ29sb3IuUkVEOwogICAgdGhpcy5lbmFibGVkID0gdHlwZW9mIG9wdGlvbnMuZW5hYmxlZCA9PT0gImJvb2xlYW4iID8gb3B0aW9ucy5lbmFibGVkIDogdHJ1ZTsKICAgIHRoaXMuc29mdFNoYWRvd3MgPSB0eXBlb2Ygb3B0aW9ucy5zb2Z0U2hhZG93cyA9PT0gImJvb2xlYW4iID8gb3B0aW9ucy5zb2Z0U2hhZG93cyA6IHRydWU7CiAgICB0aGlzLnNpemUgPSBvcHRpb25zLnNpemUgfHwgMjA0ODsKICAgIHRoaXMuYWRkKCk7CiAgfQoKICBhZGQoKSB7CiAgICB0aGlzLmNyZWF0ZUxpZ2h0Q2FtZXJhKCk7CiAgICB0aGlzLmNyZWF0ZVNoYWRvd01hcCgpOwogICAgdGhpcy5jcmVhdGVQb3N0U3RhZ2UoKTsKICAgIHRoaXMuZHJhd0ZydXN0dW1PdXRsaW5lKCk7CiAgICB0aGlzLmRyYXdTa2V0Y2goKTsKICB9CgogIGdldFN0eWxlKCkgewogICAgcmV0dXJuIHsKICAgICAgdmlld0hlYWRpbmc6IHRoaXMudmlld0hlYWRpbmcsCiAgICAgIHZpZXdEaXN0YW5jZTogdGhpcy52aWV3RGlzdGFuY2UsCiAgICAgIGhvcml6b250YWxWaWV3QW5nbGU6IHRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSwKICAgICAgdmVydGljYWxWaWV3QW5nbGU6IHRoaXMudmVydGljYWxWaWV3QW5nbGUKICAgIH07CiAgfQoKICB1cGRhdGVTdHlsZShvcHRpb25zKSB7CiAgICB0aGlzLnZpZXdIZWFkaW5nID0gb3B0aW9ucy52aWV3SGVhZGluZzsKICAgIHRoaXMudmlld0Rpc3RhbmNlID0gb3B0aW9ucy52aWV3RGlzdGFuY2U7CiAgICB0aGlzLmhvcml6b250YWxWaWV3QW5nbGUgPSBvcHRpb25zLmhvcml6b250YWxWaWV3QW5nbGU7CiAgICB0aGlzLnZlcnRpY2FsVmlld0FuZ2xlID0gb3B0aW9ucy52ZXJ0aWNhbFZpZXdBbmdsZTsKICAgIHRoaXMuY2xlYXIoKTsKICAgIHRoaXMuYWRkKCk7CiAgfQoKICByZW1vdmUoKSB7CiAgICB0aGlzLmNsZWFyKCk7CiAgfQoKICBjbGVhcigpIHsKICAgIGlmICh0aGlzLnNrZXRjaCkgewogICAgICB0aGlzLnZpZXdlci5lbnRpdGllcy5yZW1vdmVCeUlkKHRoaXMuc2tldGNoLmlkKTsKICAgICAgdGhpcy5za2V0Y2ggPSBudWxsOwogICAgfQoKICAgIGlmICh0aGlzLmZydXN0dW1PdXRsaW5lKSB7CiAgICAgIHRoaXMudmlld2VyLmVudGl0aWVzLnJlbW92ZSh0aGlzLmZydXN0dW1PdXRsaW5lKTsKICAgICAgdGhpcy5mcnVzdHVtT3V0bGluZSA9IG51bGw7CiAgICB9CgogICAgaWYgKHRoaXMucG9zdFN0YWdlKSB7CiAgICAgIHRoaXMudmlld2VyLnNjZW5lLnBvc3RQcm9jZXNzU3RhZ2VzLnJlbW92ZSh0aGlzLnBvc3RTdGFnZSk7CiAgICAgIHRoaXMucG9zdFN0YWdlID0gbnVsbDsKICAgIH0KICB9CgogIGNyZWF0ZUxpZ2h0Q2FtZXJhKCkgewogICAgdGhpcy5saWdodENhbWVyYSA9IG5ldyBDZXNpdW0uQ2FtZXJhKHRoaXMudmlld2VyLnNjZW5lKTsKICAgIHRoaXMubGlnaHRDYW1lcmEucG9zaXRpb24gPSB0aGlzLnZpZXdQb3NpdGlvbjsKICAgIHRoaXMubGlnaHRDYW1lcmEuZnJ1c3R1bS5uZWFyID0gdGhpcy52aWV3RGlzdGFuY2UgKiAwLjAwMTsKICAgIHRoaXMubGlnaHRDYW1lcmEuZnJ1c3R1bS5mYXIgPSB0aGlzLnZpZXdEaXN0YW5jZTsKICAgIGNvbnN0IGhyID0gQ2VzaXVtLk1hdGgudG9SYWRpYW5zKHRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSk7CiAgICBjb25zdCB2ciA9IENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLnZlcnRpY2FsVmlld0FuZ2xlKTsKICAgIGNvbnN0IGFzcGVjdFJhdGlvID0gdGhpcy52aWV3RGlzdGFuY2UgKiBNYXRoLnRhbihociAvIDIpICogMiAvICh0aGlzLnZpZXdEaXN0YW5jZSAqIE1hdGgudGFuKHZyIC8gMikgKiAyKTsKICAgIHRoaXMubGlnaHRDYW1lcmEuZnJ1c3R1bS5hc3BlY3RSYXRpbyA9IGFzcGVjdFJhdGlvOwoKICAgIGlmIChociA+IHZyKSB7CiAgICAgIHRoaXMubGlnaHRDYW1lcmEuZnJ1c3R1bS5mb3YgPSBocjsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubGlnaHRDYW1lcmEuZnJ1c3R1bS5mb3YgPSB2cjsKICAgIH0KCiAgICB0aGlzLmxpZ2h0Q2FtZXJhLnNldFZpZXcoewogICAgICBkZXN0aW5hdGlvbjogdGhpcy52aWV3UG9zaXRpb24sCiAgICAgIG9yaWVudGF0aW9uOiB7CiAgICAgICAgaGVhZGluZzogQ2VzaXVtLk1hdGgudG9SYWRpYW5zKHRoaXMudmlld0hlYWRpbmcgfHwgMCksCiAgICAgICAgcGl0Y2g6IENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLnZpZXdQaXRjaCB8fCAwKSwKICAgICAgICByb2xsOiAwCiAgICAgIH0KICAgIH0pOwogIH0KCiAgY3JlYXRlU2hhZG93TWFwKCkgewogICAgdGhpcy5zaGFkb3dNYXAgPSBuZXcgQ2VzaXVtLlNoYWRvd01hcCh7CiAgICAgIGNvbnRleHQ6IHRoaXMudmlld2VyLnNjZW5lLmNvbnRleHQsCiAgICAgIGxpZ2h0Q2FtZXJhOiB0aGlzLmxpZ2h0Q2FtZXJhLAogICAgICBlbmFibGVkOiB0aGlzLmVuYWJsZWQsCiAgICAgIGlzUG9pbnRMaWdodDogdHJ1ZSwKICAgICAgcG9pbnRMaWdodFJhZGl1czogdGhpcy52aWV3RGlzdGFuY2UsCiAgICAgIGNhc2NhZGVzRW5hYmxlZDogZmFsc2UsCiAgICAgIHNpemU6IHRoaXMuc2l6ZSwKICAgICAgc29mdFNoYWRvd3M6IHRoaXMuc29mdFNoYWRvd3MsCiAgICAgIG5vcm1hbE9mZnNldDogZmFsc2UsCiAgICAgIGZyb21MaWdodFNvdXJjZTogZmFsc2UKICAgIH0pOwogICAgdGhpcy52aWV3ZXIuc2NlbmUuc2hhZG93TWFwID0gdGhpcy5zaGFkb3dNYXA7CiAgfQoKICBjcmVhdGVQb3N0U3RhZ2UoKSB7CiAgICBjb25zdCBmcyA9IGdsc2w7CiAgICBjb25zdCBwb3N0U3RhZ2UgPSBuZXcgQ2VzaXVtLlBvc3RQcm9jZXNzU3RhZ2UoewogICAgICBmcmFnbWVudFNoYWRlcjogZnMsCiAgICAgIHVuaWZvcm1zOiB7CiAgICAgICAgc2hhZG93TWFwX3RleHR1cmVDdWJlOiAoKSA9PiB7CiAgICAgICAgICB0aGlzLnNoYWRvd01hcC51cGRhdGUoUmVmbGVjdC5nZXQodGhpcy52aWV3ZXIuc2NlbmUsICJfZnJhbWVTdGF0ZSIpKTsKICAgICAgICAgIHJldHVybiBSZWZsZWN0LmdldCh0aGlzLnNoYWRvd01hcCwgIl9zaGFkb3dNYXBUZXh0dXJlIik7CiAgICAgICAgfSwKICAgICAgICBzaGFkb3dNYXBfbWF0cml4OiAoKSA9PiB7CiAgICAgICAgICB0aGlzLnNoYWRvd01hcC51cGRhdGUoUmVmbGVjdC5nZXQodGhpcy52aWV3ZXIuc2NlbmUsICJfZnJhbWVTdGF0ZSIpKTsKICAgICAgICAgIHJldHVybiBSZWZsZWN0LmdldCh0aGlzLnNoYWRvd01hcCwgIl9zaGFkb3dNYXBNYXRyaXgiKTsKICAgICAgICB9LAogICAgICAgIHNoYWRvd01hcF9saWdodFBvc2l0aW9uRUM6ICgpID0+IHsKICAgICAgICAgIHRoaXMuc2hhZG93TWFwLnVwZGF0ZShSZWZsZWN0LmdldCh0aGlzLnZpZXdlci5zY2VuZSwgIl9mcmFtZVN0YXRlIikpOwogICAgICAgICAgcmV0dXJuIFJlZmxlY3QuZ2V0KHRoaXMuc2hhZG93TWFwLCAiX2xpZ2h0UG9zaXRpb25FQyIpOwogICAgICAgIH0sCiAgICAgICAgc2hhZG93TWFwX25vcm1hbE9mZnNldFNjYWxlRGlzdGFuY2VNYXhEaXN0YW5jZUFuZERhcmtuZXNzOiAoKSA9PiB7CiAgICAgICAgICB0aGlzLnNoYWRvd01hcC51cGRhdGUoUmVmbGVjdC5nZXQodGhpcy52aWV3ZXIuc2NlbmUsICJfZnJhbWVTdGF0ZSIpKTsKICAgICAgICAgIGNvbnN0IGJpYXMgPSB0aGlzLnNoYWRvd01hcC5fcG9pbnRCaWFzOwogICAgICAgICAgcmV0dXJuIENlc2l1bS5DYXJ0ZXNpYW40LmZyb21FbGVtZW50cyhiaWFzLm5vcm1hbE9mZnNldFNjYWxlLCB0aGlzLnNoYWRvd01hcC5fZGlzdGFuY2UsIHRoaXMuc2hhZG93TWFwLm1heGltdW1EaXN0YW5jZSwgMC4wLCBuZXcgQ2VzaXVtLkNhcnRlc2lhbjQoKSk7CiAgICAgICAgfSwKICAgICAgICBzaGFkb3dNYXBfdGV4ZWxTaXplRGVwdGhCaWFzQW5kTm9ybWFsU2hhZGluZ1Ntb290aDogKCkgPT4gewogICAgICAgICAgdGhpcy5zaGFkb3dNYXAudXBkYXRlKFJlZmxlY3QuZ2V0KHRoaXMudmlld2VyLnNjZW5lLCAiX2ZyYW1lU3RhdGUiKSk7CiAgICAgICAgICBjb25zdCBiaWFzID0gdGhpcy5zaGFkb3dNYXAuX3BvaW50QmlhczsKICAgICAgICAgIGNvbnN0IHNjcmF0Y2hUZXhlbFN0ZXBTaXplID0gbmV3IENlc2l1bS5DYXJ0ZXNpYW4yKCk7CiAgICAgICAgICBjb25zdCB0ZXhlbFN0ZXBTaXplID0gc2NyYXRjaFRleGVsU3RlcFNpemU7CiAgICAgICAgICB0ZXhlbFN0ZXBTaXplLnggPSAxLjAgLyB0aGlzLnNoYWRvd01hcC5fdGV4dHVyZVNpemUueDsKICAgICAgICAgIHRleGVsU3RlcFNpemUueSA9IDEuMCAvIHRoaXMuc2hhZG93TWFwLl90ZXh0dXJlU2l6ZS55OwogICAgICAgICAgcmV0dXJuIENlc2l1bS5DYXJ0ZXNpYW40LmZyb21FbGVtZW50cyh0ZXhlbFN0ZXBTaXplLngsIHRleGVsU3RlcFNpemUueSwgYmlhcy5kZXB0aEJpYXMsIGJpYXMubm9ybWFsU2hhZGluZ1Ntb290aCwgbmV3IENlc2l1bS5DYXJ0ZXNpYW40KCkpOwogICAgICAgIH0sCiAgICAgICAgY2FtZXJhX3Byb2plY3Rpb25fbWF0cml4OiAoKSA9PiB7CiAgICAgICAgICByZXR1cm4gdGhpcy5saWdodENhbWVyYS5mcnVzdHVtLnByb2plY3Rpb25NYXRyaXg7CiAgICAgICAgfSwKICAgICAgICBjYW1lcmFfdmlld19tYXRyaXg6ICgpID0+IHsKICAgICAgICAgIHJldHVybiB0aGlzLmxpZ2h0Q2FtZXJhLnZpZXdNYXRyaXg7CiAgICAgICAgfSwKICAgICAgICB4X3ZpZXdEaXN0YW5jZTogKCkgPT4gewogICAgICAgICAgcmV0dXJuIHRoaXMudmlld0Rpc3RhbmNlOwogICAgICAgIH0sCiAgICAgICAgeF92aXNpYmxlQXJlYUNvbG9yOiB0aGlzLnZpc2libGVBcmVhQ29sb3IsCiAgICAgICAgeF9pbnZpc2libGVBcmVhQ29sb3I6IHRoaXMuaW52aXNpYmxlQXJlYUNvbG9yCiAgICAgIH0KICAgIH0pOwogICAgdGhpcy5wb3N0U3RhZ2UgPSB0aGlzLnZpZXdlci5zY2VuZS5wb3N0UHJvY2Vzc1N0YWdlcy5hZGQocG9zdFN0YWdlKTsKICB9CgogIGRyYXdGcnVzdHVtT3V0bGluZSgpIHsKICAgIHRoaXMuZnJ1c3R1bU91dGxpbmUgPSB0aGlzLnZpZXdlci5lbnRpdGllcy5hZGQoewogICAgICBuYW1lOiAnZnJ1c3R1bU91dGxpbmUnLAogICAgICBwb3NpdGlvbjogdGhpcy52aWV3UG9zaXRpb24sCiAgICAgIG9yaWVudGF0aW9uOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgcmV0dXJuIENlc2l1bS5UcmFuc2Zvcm1zLmhlYWRpbmdQaXRjaFJvbGxRdWF0ZXJuaW9uKHRoaXMudmlld1Bvc2l0aW9uLCBDZXNpdW0uSGVhZGluZ1BpdGNoUm9sbC5mcm9tRGVncmVlcyh0aGlzLnZpZXdIZWFkaW5nIC0gOTAsIHRoaXMudmlld1BpdGNoLCAwLjApKTsKICAgICAgfSwgZmFsc2UpLAogICAgICBlbGxpcHNvaWQ6IHsKICAgICAgICByYWRpaTogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgcmV0dXJuIG5ldyBDZXNpdW0uQ2FydGVzaWFuMyh0aGlzLnZpZXdEaXN0YW5jZSwgdGhpcy52aWV3RGlzdGFuY2UsIHRoaXMudmlld0Rpc3RhbmNlKTsKICAgICAgICB9LCBmYWxzZSksCiAgICAgICAgaW5uZXJSYWRpaTogbmV3IENlc2l1bS5DYXJ0ZXNpYW4zKDAuMDEsIDAuMDEsIDAuMDEpLAogICAgICAgIG1pbmltdW1DbG9jazogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgcmV0dXJuIENlc2l1bS5NYXRoLnRvUmFkaWFucygtdGhpcy5ob3Jpem9udGFsVmlld0FuZ2xlIC8gMik7CiAgICAgICAgfSwgZmFsc2UpLAogICAgICAgIG1heGltdW1DbG9jazogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgcmV0dXJuIENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLmhvcml6b250YWxWaWV3QW5nbGUgLyAyKTsKICAgICAgICB9LCBmYWxzZSksCiAgICAgICAgbWluaW11bUNvbmU6IENlc2l1bS5NYXRoLnRvUmFkaWFucyh0aGlzLnZlcnRpY2FsVmlld0FuZ2xlICsgNy43NSksCiAgICAgICAgbWF4aW11bUNvbmU6IENlc2l1bS5NYXRoLnRvUmFkaWFucygxODAgLSB0aGlzLnZlcnRpY2FsVmlld0FuZ2xlIC0gNy43NSksCiAgICAgICAgZmlsbDogZmFsc2UsCiAgICAgICAgc2xpY2VQYXJ0aXRpb25zOiA2NCwKICAgICAgICBzdGFja1BhcnRpdGlvbnM6IDY0LAogICAgICAgIG91dGxpbmU6IHRydWUsCiAgICAgICAgb3V0bGluZUNvbG9yOiBDZXNpdW0uQ29sb3IuQVFVQQogICAgICB9CiAgICB9KTsKICB9CgogIGRyYXdTa2V0Y2goKSB7CiAgICB0aGlzLnNrZXRjaCA9IHRoaXMudmlld2VyLmVudGl0aWVzLmFkZCh7CiAgICAgIG5hbWU6ICdza2V0Y2gnLAogICAgICBwb3NpdGlvbjogdGhpcy52aWV3UG9zaXRpb24sCiAgICAgIG9yaWVudGF0aW9uOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgcmV0dXJuIENlc2l1bS5UcmFuc2Zvcm1zLmhlYWRpbmdQaXRjaFJvbGxRdWF0ZXJuaW9uKHRoaXMudmlld1Bvc2l0aW9uLCBDZXNpdW0uSGVhZGluZ1BpdGNoUm9sbC5mcm9tRGVncmVlcyh0aGlzLnZpZXdIZWFkaW5nIC0gOTAsIHRoaXMudmlld1BpdGNoLCAwLjApKTsKICAgICAgfSwgZmFsc2UpLAogICAgICBlbGxpcHNvaWQ6IHsKICAgICAgICByYWRpaTogbmV3IENlc2l1bS5DYWxsYmFja1Byb3BlcnR5KGUgPT4gewogICAgICAgICAgcmV0dXJuIG5ldyBDZXNpdW0uQ2FydGVzaWFuMyh0aGlzLnZpZXdEaXN0YW5jZSwgdGhpcy52aWV3RGlzdGFuY2UsIHRoaXMudmlld0Rpc3RhbmNlKTsKICAgICAgICB9LCBmYWxzZSksCiAgICAgICAgbWluaW11bUNsb2NrOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgICByZXR1cm4gQ2VzaXVtLk1hdGgudG9SYWRpYW5zKC10aGlzLmhvcml6b250YWxWaWV3QW5nbGUgLyAyKTsKICAgICAgICB9LCBmYWxzZSksCiAgICAgICAgbWF4aW11bUNsb2NrOiBuZXcgQ2VzaXVtLkNhbGxiYWNrUHJvcGVydHkoZSA9PiB7CiAgICAgICAgICByZXR1cm4gQ2VzaXVtLk1hdGgudG9SYWRpYW5zKHRoaXMuaG9yaXpvbnRhbFZpZXdBbmdsZSAvIDIpOwogICAgICAgIH0sIGZhbHNlKSwKICAgICAgICBtaW5pbXVtQ29uZTogQ2VzaXVtLk1hdGgudG9SYWRpYW5zKHRoaXMudmVydGljYWxWaWV3QW5nbGUgKyA3Ljc1KSwKICAgICAgICBtYXhpbXVtQ29uZTogQ2VzaXVtLk1hdGgudG9SYWRpYW5zKDE4MCAtIHRoaXMudmVydGljYWxWaWV3QW5nbGUgLSA3Ljc1KSwKICAgICAgICBmaWxsOiBmYWxzZSwKICAgICAgICBvdXRsaW5lOiB0cnVlLAogICAgICAgIHN1YmRpdmlzaW9uczogMjU2LAogICAgICAgIHN0YWNrUGFydGl0aW9uczogNjQsCiAgICAgICAgc2xpY2VQYXJ0aXRpb25zOiA2NCwKICAgICAgICBvdXRsaW5lQ29sb3I6IENlc2l1bS5Db2xvci5BUVVBCiAgICAgIH0KICAgIH0pOwogIH0KCn0KCmNsYXNzIFZpc2liaWxpdHlBbmFseXNpcyB7CiAgY29uc3RydWN0b3Iodmlld2VyKSB7CiAgICB0aGlzLnZpZXdlciA9IHZpZXdlcjsKICAgIHRoaXMudmlld2VyLmNlc2l1bVdpZGdldC5zY3JlZW5TcGFjZUV2ZW50SGFuZGxlci5yZW1vdmVJbnB1dEFjdGlvbihDZXNpdW0uU2NyZWVuU3BhY2VFdmVudFR5cGUuTEVGVF9ET1VCTEVfQ0xJQ0spOwogICAgdGhpcy5pbml0RXZlbnRzKCk7CiAgfQoKICBhY3RpdmF0ZSgpIHsKICAgIHRoaXMuZGVhY3RpdmF0ZSgpOwogICAgdGhpcy5jbGVhcigpOwogICAgdGhpcy5maXJzdFBvc2l0aW9uID0gdW5kZWZpbmVkOwogICAgdGhpcy5yZWdpc3RlckV2ZW50cygpOwogIH0KCiAgZGVhY3RpdmF0ZSgpIHsKICAgIHRoaXMudW5SZWdpc3RlckV2ZW50cygpOwogICAgdGhpcy52aWV3ZXIuX2VsZW1lbnQuc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInOwogICAgdGhpcy52aWV3ZXIuZW5hYmxlQ3Vyc29yU3R5bGUgPSB0cnVlOwogIH0KCiAgY2xlYXIoKSB7CiAgICBpZiAodGhpcy5jYW1lcmFMaW5lKSB7CiAgICAgIHRoaXMuY2FtZXJhTGluZS5yZW1vdmUoKTsKICAgICAgdGhpcy5jYW1lcmFMaW5lID0gdW5kZWZpbmVkOwogICAgfQogIH0KCiAgaW5pdEV2ZW50cygpIHsKICAgIHRoaXMuaGFuZGxlciA9IG5ldyBDZXNpdW0uU2NyZWVuU3BhY2VFdmVudEhhbmRsZXIodGhpcy52aWV3ZXIuc2NlbmUuY2FudmFzKTsKICAgIHRoaXMuRHJhd0VuZEV2ZW50ID0gbmV3IENlc2l1bS5FdmVudCgpOwogIH0KCiAgcmVnaXN0ZXJFdmVudHMoKSB7CiAgICB0aGlzLmxlZnRDbGlja0V2ZW50KCk7CiAgICB0aGlzLnJpZ2h0Q2xpY2tFdmVudCgpOwogICAgdGhpcy5tb3VzZU1vdmVFdmVudCgpOwogIH0KCiAgbGVmdENsaWNrRXZlbnQoKSB7CiAgICB0aGlzLmhhbmRsZXIuc2V0SW5wdXRBY3Rpb24oZSA9PiB7CiAgICAgIHRoaXMudmlld2VyLl9lbGVtZW50LnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JzsKICAgICAgbGV0IHBvc2l0aW9uID0gdGhpcy52aWV3ZXIuc2NlbmUucGlja1Bvc2l0aW9uKGUucG9zaXRpb24pOwoKICAgICAgaWYgKCFwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uID0gdGhpcy52aWV3ZXIuc2NlbmUuY2FtZXJhLnBpY2tFbGxpcHNvaWQoZS5wb3NpdGlvbiwgdGhpcy52aWV3ZXIuc2NlbmUuZ2xvYmUuZWxsaXBzb2lkKTsKICAgICAgfQoKICAgICAgaWYgKCFwb3NpdGlvbikgcmV0dXJuOwoKICAgICAgaWYgKCF0aGlzLmZpcnN0UG9zaXRpb24pIHsKICAgICAgICB0aGlzLmZpcnN0UG9zaXRpb24gPSB0aGlzLmdldEZpcnN0UG9zaXRpb24ocG9zaXRpb24pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZHJhd0VuZCgpOwogICAgICB9CiAgICB9LCBDZXNpdW0uU2NyZWVuU3BhY2VFdmVudFR5cGUuTEVGVF9DTElDSyk7CiAgfQoKICBnZXRGaXJzdFBvc2l0aW9uKHBvc2l0aW9uKSB7CiAgICBjb25zdCBjID0gQ2VzaXVtLkNhcnRvZ3JhcGhpYy5mcm9tQ2FydGVzaWFuKHBvc2l0aW9uKTsKICAgIGNvbnN0IGxvbiA9IENlc2l1bS5NYXRoLnRvRGVncmVlcyhjLmxvbmdpdHVkZSk7CiAgICBjb25zdCBsYXQgPSBDZXNpdW0uTWF0aC50b0RlZ3JlZXMoYy5sYXRpdHVkZSk7CiAgICBjb25zdCBoZWlnaHQgPSBjLmhlaWdodCArIDE7CiAgICByZXR1cm4gQ2VzaXVtLkNhcnRlc2lhbjMuZnJvbURlZ3JlZXMobG9uLCBsYXQsIGhlaWdodCk7CiAgfQoKICBjcmVhdGVDYW1lcmFMaW5lKHBvc2l0aW9uKSB7CiAgICB0aGlzLmNhbWVyYUxpbmUgPSBuZXcgQ2FtZXJhTGluZSh0aGlzLnZpZXdlciwgewogICAgICB2aWV3UG9zaXRpb246IHRoaXMuZmlyc3RQb3NpdGlvbiwKICAgICAgdmlld1Bvc2l0aW9uRW5kOiBwb3NpdGlvbgogICAgfSk7CiAgfQoKICBtb3VzZU1vdmVFdmVudCgpIHsKICAgIHRoaXMuaGFuZGxlci5zZXRJbnB1dEFjdGlvbihlID0+IHsKICAgICAgdGhpcy52aWV3ZXIuX2VsZW1lbnQuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnOwogICAgICBsZXQgcG9zaXRpb24gPSB0aGlzLnZpZXdlci5zY2VuZS5waWNrUG9zaXRpb24oZS5lbmRQb3NpdGlvbik7CgogICAgICBpZiAoIXBvc2l0aW9uKSB7CiAgICAgICAgcG9zaXRpb24gPSB0aGlzLnZpZXdlci5zY2VuZS5jYW1lcmEucGlja0VsbGlwc29pZChlLnN0YXJ0UG9zaXRpb24sIHRoaXMudmlld2VyLnNjZW5lLmdsb2JlLmVsbGlwc29pZCk7CiAgICAgIH0KCiAgICAgIGlmICghcG9zaXRpb24pIHJldHVybjsKICAgICAgaWYgKCF0aGlzLmZpcnN0UG9zaXRpb24pIHJldHVybjsKCiAgICAgIGlmICghdGhpcy5jYW1lcmFMaW5lKSB7CiAgICAgICAgdGhpcy5jcmVhdGVDYW1lcmFMaW5lKHBvc2l0aW9uKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNhbWVyYUxpbmUudXBkYXRlRW5kUG9zaXRpb24ocG9zaXRpb24pOwogICAgICB9CiAgICB9LCBDZXNpdW0uU2NyZWVuU3BhY2VFdmVudFR5cGUuTU9VU0VfTU9WRSk7CiAgfQoKICByaWdodENsaWNrRXZlbnQoKSB7CiAgICB0aGlzLmhhbmRsZXIuc2V0SW5wdXRBY3Rpb24oZSA9PiB7CiAgICAgIGlmICghdGhpcy5maXJzdFBvc2l0aW9uKSB7CiAgICAgICAgdGhpcy5kZWFjdGl2YXRlKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuY2xlYXIoKTsKICAgICAgICB0aGlzLmRlYWN0aXZhdGUoKTsKICAgICAgfQogICAgfSwgQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLlJJR0hUX0NMSUNLKTsKICB9CgogIHVuUmVnaXN0ZXJFdmVudHMoKSB7CiAgICB0aGlzLmhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLlJJR0hUX0NMSUNLKTsKICAgIHRoaXMuaGFuZGxlci5yZW1vdmVJbnB1dEFjdGlvbihDZXNpdW0uU2NyZWVuU3BhY2VFdmVudFR5cGUuTEVGVF9DTElDSyk7CiAgICB0aGlzLmhhbmRsZXIucmVtb3ZlSW5wdXRBY3Rpb24oQ2VzaXVtLlNjcmVlblNwYWNlRXZlbnRUeXBlLk1PVVNFX01PVkUpOwogICAgdGhpcy5oYW5kbGVyLnJlbW92ZUlucHV0QWN0aW9uKENlc2l1bS5TY3JlZW5TcGFjZUV2ZW50VHlwZS5MRUZUX0RPVUJMRV9DTElDSyk7CiAgfQoKICBkcmF3RW5kKCkgewogICAgdGhpcy5WaXNpYmlsaXR5ID0gbmV3IFZpc2liaWxpdHkodGhpcy52aWV3ZXIsIHRoaXMuY2FtZXJhTGluZS5nZXRPcHRpb25zKCkpOwogICAgdGhpcy5EcmF3RW5kRXZlbnQucmFpc2VFdmVudCh0aGlzLlZpc2liaWxpdHkpOwogICAgdGhpcy5jYW1lcmFMaW5lLnJlbW92ZSgpOwogICAgdGhpcy5kZWFjdGl2YXRlKCk7CiAgfQoKfQoKY2xhc3MgQnVmZmVyQW5hbHlzaXMgewogIHN0YXRpYyBwb2ludEJ1ZmZlcihwb2ludCwgcmFkaXVzLCBvcHRpb25zKSB7CiAgICBsZXQgcG9pbnRGID0gdHVyZi5wb2ludChwb2ludCk7CiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7CiAgICAgIHVuaXRzOiAnbWV0ZXJzJywKICAgICAgejogMAogICAgfTsKICAgIGxldCBidWZmZXIgPSB0dXJmLmJ1ZmZlcihwb2ludEYsIHJhZGl1cyB8fCAxMDAsIG9wdGlvbnMudW5pdHMpOwogICAgbGV0IGNvb3JkaW5hdGVzID0gYnVmZmVyLmdlb21ldHJ5LmNvb3JkaW5hdGVzOwogICAgbGV0IHBvaW50cyA9IGNvb3JkaW5hdGVzWzBdOwogICAgbGV0IGRlZ3JlZXNBcnJheUhlaWdodHMgPSB0aGlzLnBvaW50c1RvRGVncmVlc0FycmF5KHBvaW50cywgb3B0aW9ucy56IHx8IDApOwogICAgcmV0dXJuIENlc2l1bS5DYXJ0ZXNpYW4zLmZyb21EZWdyZWVzQXJyYXlIZWlnaHRzKGRlZ3JlZXNBcnJheUhlaWdodHMpOwogIH0KCiAgc3RhdGljIHBvbHlsaW5lQnVmZmVyKHBvaW50cywgcmFkaXVzLCBvcHRpb25zKSB7CiAgICBsZXQgcG9seWxpbmVGID0gdHVyZi5saW5lU3RyaW5nKHBvaW50cyk7CiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7CiAgICAgIHVuaXRzOiAnbWV0ZXJzJywKICAgICAgejogMAogICAgfTsKICAgIGxldCBidWZmZXJlZCA9IHR1cmYuYnVmZmVyKHBvbHlsaW5lRiwgcmFkaXVzIHx8IDEwMCwgb3B0aW9ucy51bml0cyk7CiAgICBsZXQgY29vcmRpbmF0ZXMgPSBidWZmZXJlZC5nZW9tZXRyeS5jb29yZGluYXRlczsKICAgIHBvaW50cyA9IGNvb3JkaW5hdGVzWzBdOwogICAgbGV0IGRlZ3JlZXNBcnJheUhlaWdodHMgPSB0aGlzLnBvaW50c1RvRGVncmVlc0FycmF5KHBvaW50cywgb3B0aW9ucy56IHx8IDApOwogICAgcmV0dXJuIENlc2l1bS5DYXJ0ZXNpYW4zLmZyb21EZWdyZWVzQXJyYXlIZWlnaHRzKGRlZ3JlZXNBcnJheUhlaWdodHMpOwogIH0KCiAgc3RhdGljIHBvbHlnb25CdWZmZXIocG9pbnRzLCByYWRpdXMsIG9wdGlvbnMpIHsKICAgIHJldHVybiB0aGlzLnBvbHlsaW5lQnVmZmVyKHBvaW50cywgcmFkaXVzLCBvcHRpb25zKTsKICB9CgogIHN0YXRpYyBwb2ludHNUb0RlZ3JlZXNBcnJheShwb2ludHMsIGhlaWdodCkgewogICAgbGV0IGRlZ3JlZXNBcnJheSA9IFtdOwogICAgcG9pbnRzLm1hcChpdGVtID0+IHsKICAgICAgZGVncmVlc0FycmF5LnB1c2goaXRlbVswXSk7CiAgICAgIGRlZ3JlZXNBcnJheS5wdXNoKGl0ZW1bMV0pOwogICAgICBkZWdyZWVzQXJyYXkucHVzaChoZWlnaHQpOwogICAgfSk7CiAgICByZXR1cm4gZGVncmVlc0FycmF5OwogIH0KCn0KCmV4cG9ydCBkZWZhdWx0IHsKICBMaW1pdEhlaWdodEFuYWx5c2lzLAogIFZpc2liaWxpdHlBbmFseXNpcywKICBCdWZmZXJBbmFseXNpcwp9Ow=="},{"version":3,"names":["Cesium","turf","glsl","LimitHeightAnalysis","constructor","viewer","degreesArray","height","style","init","scene","invertClassification","invertClassificationColor","color","Color","addBottomPolygon","addPrimitive","bottomPolygon","entities","add","polygon","hierarchy","PolygonHierarchy","Cartesian3","fromDegreesArray","CallbackProperty","e","material","YELLOW","withAlpha","outline","outlineColor","RED","geometry","createGeometry","addClassificationPrimitive","setHeight","removePrimitive","PolygonGeometry","polygonHierarchy","extrudedHeight","polygonGeometry","Primitive","primitives","ClassificationPrimitive","geometryInstances","GeometryInstance","attributes","ColorGeometryInstanceAttribute","fromColor","show","ShowGeometryInstanceAttribute","classificationType","ClassificationType","CESIUM_3D_TILE","asynchronous","remove","getHeading","fromPosition","toPosition","finalPosition","matrix4","Transforms","eastNorthUpToFixedFrame","Matrix4","inverse","multiplyByPoint","normalize","Math","toDegrees","atan2","x","y","getPitch","asin","z","CameraLine","options","viewPosition","viewPositionEnd","viewDistance","getDistance","viewHeading","getViewHeading","viewPitch","getViewPitch","horizontalViewAngle","verticalViewAngle","drawSketch","drawFrustumOutline","updateEndPosition","endPosition","distance","getOptions","frustumOutline","name","position","orientation","headingPitchRollQuaternion","HeadingPitchRoll","fromDegrees","ellipsoid","radii","innerRadii","minimumClock","toRadians","maximumClock","minimumCone","maximumCone","fill","AQUA","sketch","subdivisions","stackPartitions","slicePartitions","Visibility","visibleAreaColor","LIME","invisibleAreaColor","enabled","softShadows","size","createLightCamera","createShadowMap","createPostStage","getStyle","updateStyle","clear","removeById","id","postStage","postProcessStages","lightCamera","Camera","frustum","near","far","hr","vr","aspectRatio","tan","fov","setView","destination","heading","pitch","roll","shadowMap","ShadowMap","context","isPointLight","pointLightRadius","cascadesEnabled","normalOffset","fromLightSource","fs","PostProcessStage","fragmentShader","uniforms","shadowMap_textureCube","update","Reflect","get","shadowMap_matrix","shadowMap_lightPositionEC","shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness","bias","_pointBias","Cartesian4","fromElements","normalOffsetScale","_distance","maximumDistance","shadowMap_texelSizeDepthBiasAndNormalShadingSmooth","scratchTexelStepSize","Cartesian2","texelStepSize","_textureSize","depthBias","normalShadingSmooth","camera_projection_matrix","projectionMatrix","camera_view_matrix","viewMatrix","x_viewDistance","x_visibleAreaColor","x_invisibleAreaColor","VisibilityAnalysis","cesiumWidget","screenSpaceEventHandler","removeInputAction","ScreenSpaceEventType","LEFT_DOUBLE_CLICK","initEvents","activate","deactivate","firstPosition","undefined","registerEvents","unRegisterEvents","_element","cursor","enableCursorStyle","cameraLine","handler","ScreenSpaceEventHandler","canvas","DrawEndEvent","Event","leftClickEvent","rightClickEvent","mouseMoveEvent","setInputAction","pickPosition","camera","pickEllipsoid","globe","getFirstPosition","drawEnd","LEFT_CLICK","c","Cartographic","fromCartesian","lon","longitude","lat","latitude","createCameraLine","startPosition","MOUSE_MOVE","RIGHT_CLICK","raiseEvent","BufferAnalysis","pointBuffer","point","radius","pointF","units","buffer","coordinates","points","degreesArrayHeights","pointsToDegreesArray","fromDegreesArrayHeights","polylineBuffer","polylineF","lineString","buffered","polygonBuffer","map","item","push"],"sources":["C:/Users/20606/Desktop/课程/三维GIS原理与应用/smartSchool/src/utils/spatialAnalysis.js"],"sourcesContent":["import * as Cesium from 'cesium';\r\nimport * as turf from 'turf'\r\nimport glsl from './glsl'\r\n\r\nclass LimitHeightAnalysis{\r\n    constructor(viewer, degreesArray, height, style) {\r\n        this.viewer = viewer;\r\n        this.degreesArray = degreesArray;\r\n        this.height = height;\r\n        this.style = style || {};\r\n        this.init();\r\n    }\r\n\r\n    init() {\r\n        this.viewer.scene.invertClassification = true;\r\n        this.viewer.scene.invertClassificationColor = this.style.color || new Cesium.Color(1, 1, 1, 1);\r\n        this.addBottomPolygon();\r\n        this.addPrimitive();\r\n    }\r\n\r\n    addBottomPolygon() {\r\n        this.bottomPolygon = this.viewer.entities.add({\r\n            polygon: {\r\n                hierarchy: new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(this.degreesArray)),\r\n                height: new Cesium.CallbackProperty(e => {\r\n                    return this.height;\r\n                }, false),\r\n                material: Cesium.Color.YELLOW.withAlpha(0.2),\r\n                outline: true,\r\n                outlineColor: Cesium.Color.RED\r\n            }\r\n        })\r\n    }\r\n\r\n    addPrimitive() {\r\n        let geometry = this.createGeometry();\r\n        this.addClassificationPrimitive(geometry);\r\n    }\r\n\r\n    setHeight(height) {\r\n        this.height = height || 100;\r\n        this.removePrimitive();\r\n        this.addPrimitive();\r\n    }\r\n\r\n    createGeometry() {\r\n        return new Cesium.PolygonGeometry({\r\n            polygonHierarchy: new Cesium.PolygonHierarchy(\r\n                Cesium.Cartesian3.fromDegreesArray(this.degreesArray)\r\n            ),\r\n            height: this.height,\r\n            extrudedHeight: 200000,\r\n        });\r\n    }\r\n\r\n    addClassificationPrimitive(polygonGeometry) {\r\n        this.Primitive = this.viewer.scene.primitives.add(\r\n            new Cesium.ClassificationPrimitive({\r\n                geometryInstances: new Cesium.GeometryInstance({\r\n                    geometry: Cesium.PolygonGeometry.createGeometry(polygonGeometry),\r\n                    attributes: {\r\n                        color: Cesium.ColorGeometryInstanceAttribute.fromColor(\r\n                            Cesium.Color.RED.withAlpha(0.6) //颜色值\r\n                        ),\r\n                        show: new Cesium.ShowGeometryInstanceAttribute(true),\r\n                    },\r\n                }),\r\n                classificationType: Cesium.ClassificationType.CESIUM_3D_TILE,\r\n                asynchronous: !1,\r\n            })\r\n        );\r\n    }\r\n\r\n    removePrimitive() {\r\n        this.viewer.scene.primitives.remove(this.Primitive)\r\n    }\r\n\r\n    remove() {\r\n        this.removePrimitive();\r\n        this.viewer.scene.invertClassification = false;\r\n        this.viewer.entities.remove(this.bottomPolygon);\r\n    }\r\n}\r\n\r\nfunction getHeading(fromPosition, toPosition) {\r\n    let finalPosition = new Cesium.Cartesian3();\r\n    let matrix4 = Cesium.Transforms.eastNorthUpToFixedFrame(fromPosition);\r\n    Cesium.Matrix4.inverse(matrix4, matrix4);\r\n    Cesium.Matrix4.multiplyByPoint(matrix4, toPosition, finalPosition);\r\n    Cesium.Cartesian3.normalize(finalPosition, finalPosition);\r\n    return Cesium.Math.toDegrees(Math.atan2(finalPosition.x, finalPosition.y));\r\n}\r\n\r\nfunction getPitch(fromPosition, toPosition) {\r\n    let finalPosition = new Cesium.Cartesian3();\r\n    let matrix4 = Cesium.Transforms.eastNorthUpToFixedFrame(fromPosition);\r\n    Cesium.Matrix4.inverse(matrix4, matrix4);\r\n    Cesium.Matrix4.multiplyByPoint(matrix4, toPosition, finalPosition);\r\n    Cesium.Cartesian3.normalize(finalPosition, finalPosition);\r\n    return Cesium.Math.toDegrees(Math.asin(finalPosition.z));\r\n}\r\n\r\nclass CameraLine {\r\n    constructor(viewer, options) {\r\n        this.viewer = viewer;\r\n        this.viewPosition = options.viewPosition; //观察点\r\n        this.viewPositionEnd = options.viewPositionEnd; //结束点\r\n        this.viewDistance = this.getDistance();\r\n        this.viewHeading = this.getViewHeading();\r\n        this.viewPitch = this.getViewPitch();\r\n        this.horizontalViewAngle = options.horizontalViewAngle || 90.0;\r\n        this.verticalViewAngle = options.verticalViewAngle || 60.0;\r\n        this.drawSketch();\r\n        this.drawFrustumOutline();\r\n    }\r\n\r\n    updateEndPosition(endPosition) {\r\n        this.viewPositionEnd = endPosition;\r\n    }\r\n\r\n    getViewHeading() {\r\n        this.viewHeading = getHeading(this.viewPosition, this.viewPositionEnd);\r\n        return this.viewHeading;\r\n    }\r\n\r\n    getViewPitch() {\r\n        this.viewPitch = getPitch(this.viewPosition, this.viewPositionEnd);\r\n        return this.viewPitch;\r\n    }\r\n\r\n    getDistance() {\r\n        this.viewDistance = Cesium.Cartesian3.distance(this.viewPosition, this.viewPositionEnd);\r\n        return this.viewDistance;\r\n    }\r\n\r\n    getOptions() {\r\n        return {\r\n            viewPosition: this.viewPosition,\r\n            viewPositionEnd: this.viewPositionEnd,\r\n            viewDistance: this.viewDistance,\r\n            viewHeading: this.viewHeading,\r\n            viewPitch: this.viewPitch,\r\n            horizontalViewAngle: this.horizontalViewAngle,\r\n            verticalViewAngle: this.verticalViewAngle\r\n        }\r\n    }\r\n\r\n    drawFrustumOutline() {\r\n        this.frustumOutline = this.viewer.entities.add({\r\n            name: 'frustumOutline',\r\n            position: this.viewPosition,\r\n            orientation: new Cesium.CallbackProperty(e => {\r\n                return Cesium.Transforms.headingPitchRollQuaternion(\r\n                    this.viewPosition,\r\n                    Cesium.HeadingPitchRoll.fromDegrees(this.getViewHeading() - this.horizontalViewAngle, this.getViewPitch(), 0.0)\r\n                )\r\n            }, false),\r\n            ellipsoid: {\r\n                radii: new Cesium.CallbackProperty(e => {\r\n                    const distance = this.getDistance();\r\n                    return new Cesium.Cartesian3(distance, distance, distance);\r\n                }, false),\r\n                innerRadii: new Cesium.Cartesian3(0.01, 0.01, 0.01),\r\n                minimumClock: Cesium.Math.toRadians(-this.horizontalViewAngle / 2),\r\n                maximumClock: Cesium.Math.toRadians(this.horizontalViewAngle / 2),\r\n                minimumCone: Cesium.Math.toRadians(this.verticalViewAngle + 7.75),\r\n                maximumCone: Cesium.Math.toRadians(180 - this.verticalViewAngle - 7.75),\r\n                fill: false,\r\n                outline: true,\r\n                outlineColor: Cesium.Color.AQUA\r\n            }\r\n        });\r\n    }\r\n\r\n    drawSketch() {\r\n        this.sketch = this.viewer.entities.add({\r\n            name: 'sketch',\r\n            position: this.viewPosition,\r\n            orientation: new Cesium.CallbackProperty(e => {\r\n                return Cesium.Transforms.headingPitchRollQuaternion(\r\n                    this.viewPosition,\r\n                    Cesium.HeadingPitchRoll.fromDegrees(this.getViewHeading() - this.horizontalViewAngle, this.getViewPitch(), 0.0)\r\n                )\r\n            }, false),\r\n            ellipsoid: {\r\n                radii: new Cesium.CallbackProperty(e => {\r\n                    const distance = this.getDistance();\r\n                    return new Cesium.Cartesian3(distance, distance, distance);\r\n                }, false),\r\n                minimumClock: Cesium.Math.toRadians(-this.horizontalViewAngle / 2),\r\n                maximumClock: Cesium.Math.toRadians(this.horizontalViewAngle / 2),\r\n                minimumCone: Cesium.Math.toRadians(this.verticalViewAngle + 7.75),\r\n                maximumCone: Cesium.Math.toRadians(180 - this.verticalViewAngle - 7.75),\r\n                fill: false,\r\n                outline: true,\r\n                subdivisions: 256,\r\n                stackPartitions: 64,\r\n                slicePartitions: 64,\r\n                outlineColor: Cesium.Color.AQUA\r\n            }\r\n        });\r\n    }\r\n\r\n    remove() {\r\n        if (this.sketch) {\r\n            this.viewer.entities.remove(this.sketch);\r\n            this.sketch = null;\r\n        }\r\n\r\n        if (this.frustumOutline) {\r\n            this.viewer.entities.remove(this.frustumOutline);\r\n            this.frustumOutline = null;\r\n        }\r\n    }\r\n}\r\n\r\nclass Visibility {\r\n    constructor(viewer, options) {\r\n        this.viewer = viewer;\r\n        this.viewPosition = options.viewPosition;\r\n        this.viewPositionEnd = options.viewPositionEnd;\r\n        this.viewDistance = options.viewDistance;\r\n        this.viewHeading = options.viewHeading;\r\n        if (this.viewHeading < 0) {\r\n            this.viewHeading += 360;\r\n        }\r\n        this.viewPitch = options.viewPitch;\r\n        this.horizontalViewAngle = options.horizontalViewAngle || 90.0;\r\n        this.verticalViewAngle = options.verticalViewAngle || 90.0;\r\n        this.visibleAreaColor = options.visibleAreaColor || Cesium.Color.LIME; // Cesium.Color.GREEN;\r\n        this.invisibleAreaColor = options.invisibleAreaColor || Cesium.Color.RED;\r\n        this.enabled = (typeof options.enabled === \"boolean\") ? options.enabled : true;\r\n        this.softShadows = (typeof options.softShadows === \"boolean\") ? options.softShadows : true;\r\n        this.size = options.size || 2048;\r\n        this.add();\r\n    }\r\n\r\n    add() {\r\n        this.createLightCamera();\r\n        this.createShadowMap();\r\n        this.createPostStage();\r\n        this.drawFrustumOutline();\r\n        this.drawSketch();\r\n    }\r\n\r\n    getStyle() {\r\n        return {\r\n            viewHeading: this.viewHeading,\r\n            viewDistance: this.viewDistance,\r\n            horizontalViewAngle: this.horizontalViewAngle,\r\n            verticalViewAngle: this.verticalViewAngle\r\n        }\r\n    }\r\n\r\n    updateStyle(options) {\r\n        this.viewHeading = options.viewHeading;\r\n        this.viewDistance = options.viewDistance;\r\n        this.horizontalViewAngle = options.horizontalViewAngle;\r\n        this.verticalViewAngle = options.verticalViewAngle;\r\n        this.clear();\r\n        this.add();\r\n    }\r\n\r\n    remove() {\r\n        this.clear();\r\n    }\r\n\r\n    clear() {\r\n        if (this.sketch) {\r\n            this.viewer.entities.removeById(this.sketch.id);\r\n            this.sketch = null;\r\n        }\r\n\r\n        if (this.frustumOutline) {\r\n            this.viewer.entities.remove(this.frustumOutline);\r\n            this.frustumOutline = null;\r\n        }\r\n\r\n        if (this.postStage) {\r\n            this.viewer.scene.postProcessStages.remove(this.postStage);\r\n            this.postStage = null;\r\n        }\r\n    }\r\n\r\n    createLightCamera() {\r\n        this.lightCamera = new Cesium.Camera(this.viewer.scene);\r\n        this.lightCamera.position = this.viewPosition;\r\n        this.lightCamera.frustum.near = this.viewDistance * 0.001;\r\n        this.lightCamera.frustum.far = this.viewDistance;\r\n        const hr = Cesium.Math.toRadians(this.horizontalViewAngle);\r\n        const vr = Cesium.Math.toRadians(this.verticalViewAngle);\r\n        const aspectRatio =\r\n            (this.viewDistance * Math.tan(hr / 2) * 2) /\r\n            (this.viewDistance * Math.tan(vr / 2) * 2);\r\n        this.lightCamera.frustum.aspectRatio = aspectRatio;\r\n        if (hr > vr) {\r\n            this.lightCamera.frustum.fov = hr;\r\n        } else {\r\n            this.lightCamera.frustum.fov = vr;\r\n        }\r\n        this.lightCamera.setView({\r\n            destination: this.viewPosition,\r\n            orientation: {\r\n                heading: Cesium.Math.toRadians(this.viewHeading || 0),\r\n                pitch: Cesium.Math.toRadians(this.viewPitch || 0),\r\n                roll: 0\r\n            }\r\n        });\r\n    }\r\n\r\n    createShadowMap() {\r\n        this.shadowMap = new Cesium.ShadowMap({\r\n            context: (this.viewer.scene).context,\r\n            lightCamera: this.lightCamera,\r\n            enabled: this.enabled,\r\n            isPointLight: true,\r\n            pointLightRadius: this.viewDistance,\r\n            cascadesEnabled: false,\r\n            size: this.size,\r\n            softShadows: this.softShadows,\r\n            normalOffset: false,\r\n            fromLightSource: false\r\n        });\r\n        this.viewer.scene.shadowMap = this.shadowMap;\r\n    }\r\n\r\n    createPostStage() {\r\n        const fs = glsl\r\n        const postStage = new Cesium.PostProcessStage({\r\n            fragmentShader: fs,\r\n            uniforms: {\r\n                shadowMap_textureCube: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    return Reflect.get(this.shadowMap, \"_shadowMapTexture\");\r\n                },\r\n                shadowMap_matrix: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    return Reflect.get(this.shadowMap, \"_shadowMapMatrix\");\r\n                },\r\n                shadowMap_lightPositionEC: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    return Reflect.get(this.shadowMap, \"_lightPositionEC\");\r\n                },\r\n                shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    const bias = this.shadowMap._pointBias;\r\n                    return Cesium.Cartesian4.fromElements(\r\n                        bias.normalOffsetScale,\r\n                        this.shadowMap._distance,\r\n                        this.shadowMap.maximumDistance,\r\n                        0.0,\r\n                        new Cesium.Cartesian4()\r\n                    );\r\n                },\r\n                shadowMap_texelSizeDepthBiasAndNormalShadingSmooth: () => {\r\n                    this.shadowMap.update(Reflect.get(this.viewer.scene, \"_frameState\"));\r\n                    const bias = this.shadowMap._pointBias;\r\n                    const scratchTexelStepSize = new Cesium.Cartesian2();\r\n                    const texelStepSize = scratchTexelStepSize;\r\n                    texelStepSize.x = 1.0 / this.shadowMap._textureSize.x;\r\n                    texelStepSize.y = 1.0 / this.shadowMap._textureSize.y;\r\n                    return Cesium.Cartesian4.fromElements(\r\n                        texelStepSize.x,\r\n                        texelStepSize.y,\r\n                        bias.depthBias,\r\n                        bias.normalShadingSmooth,\r\n                        new Cesium.Cartesian4()\r\n                    );\r\n                },\r\n                camera_projection_matrix: () => {\r\n                    return this.lightCamera.frustum.projectionMatrix;\r\n                },\r\n                camera_view_matrix: () => {\r\n                    return this.lightCamera.viewMatrix;\r\n                },\r\n                x_viewDistance: () => {\r\n                    return this.viewDistance;\r\n                },\r\n                x_visibleAreaColor: this.visibleAreaColor,\r\n                x_invisibleAreaColor: this.invisibleAreaColor,\r\n            }\r\n        });\r\n        this.postStage = this.viewer.scene.postProcessStages.add(postStage);\r\n    }\r\n\r\n    drawFrustumOutline() {\r\n        this.frustumOutline = this.viewer.entities.add({\r\n            name: 'frustumOutline',\r\n            position: this.viewPosition,\r\n            orientation: new Cesium.CallbackProperty(e => {\r\n                return Cesium.Transforms.headingPitchRollQuaternion(\r\n                    this.viewPosition,\r\n                    Cesium.HeadingPitchRoll.fromDegrees(this.viewHeading - 90, this.viewPitch, 0.0)\r\n                )\r\n            }, false),\r\n            ellipsoid: {\r\n                radii: new Cesium.CallbackProperty(e => {\r\n                    return new Cesium.Cartesian3(this.viewDistance, this.viewDistance, this.viewDistance);\r\n                }, false),\r\n\r\n                innerRadii: new Cesium.Cartesian3(0.01, 0.01, 0.01),\r\n                minimumClock: new Cesium.CallbackProperty(e => {\r\n                    return Cesium.Math.toRadians(-this.horizontalViewAngle / 2);\r\n                }, false),\r\n                maximumClock: new Cesium.CallbackProperty(e => {\r\n                    return Cesium.Math.toRadians(this.horizontalViewAngle / 2);\r\n                }, false),\r\n                minimumCone: Cesium.Math.toRadians(this.verticalViewAngle + 7.75),\r\n                maximumCone: Cesium.Math.toRadians(180 - this.verticalViewAngle - 7.75),\r\n                fill: false,\r\n                slicePartitions: 64,\r\n                stackPartitions: 64,\r\n                outline: true,\r\n                outlineColor: Cesium.Color.AQUA\r\n            }\r\n        });\r\n    }\r\n\r\n    drawSketch() {\r\n        this.sketch = this.viewer.entities.add({\r\n            name: 'sketch',\r\n            position: this.viewPosition,\r\n            orientation: new Cesium.CallbackProperty(e => {\r\n                return Cesium.Transforms.headingPitchRollQuaternion(\r\n                    this.viewPosition,\r\n                    Cesium.HeadingPitchRoll.fromDegrees(this.viewHeading - 90, this.viewPitch, 0.0)\r\n                )\r\n            }, false),\r\n            ellipsoid: {\r\n                radii: new Cesium.CallbackProperty(e => {\r\n                    return new Cesium.Cartesian3(this.viewDistance, this.viewDistance, this.viewDistance);\r\n                }, false),\r\n                minimumClock: new Cesium.CallbackProperty(e => {\r\n                    return Cesium.Math.toRadians(-this.horizontalViewAngle / 2);\r\n                }, false),\r\n                maximumClock: new Cesium.CallbackProperty(e => {\r\n                    return Cesium.Math.toRadians(this.horizontalViewAngle / 2);\r\n                }, false),\r\n                minimumCone: Cesium.Math.toRadians(this.verticalViewAngle + 7.75),\r\n                maximumCone: Cesium.Math.toRadians(180 - this.verticalViewAngle - 7.75),\r\n                fill: false,\r\n                outline: true,\r\n                subdivisions: 256,\r\n                stackPartitions: 64,\r\n                slicePartitions: 64,\r\n                outlineColor: Cesium.Color.AQUA\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nclass VisibilityAnalysis {\r\n    constructor(viewer) {\r\n        this.viewer = viewer;\r\n        this.viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n        this.initEvents();\r\n    }\r\n\r\n    activate() {\r\n        this.deactivate();\r\n        this.clear();\r\n        this.firstPosition = undefined;\r\n        this.registerEvents();\r\n    }\r\n\r\n    deactivate() {\r\n        this.unRegisterEvents();\r\n        this.viewer._element.style.cursor = 'pointer';\r\n        this.viewer.enableCursorStyle = true;\r\n    }\r\n\r\n    clear() {\r\n        if (this.cameraLine) {\r\n            this.cameraLine.remove();\r\n            this.cameraLine = undefined;\r\n        }\r\n    }\r\n\r\n    initEvents() {\r\n        this.handler = new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas);\r\n        this.DrawEndEvent = new Cesium.Event();\r\n    }\r\n\r\n    registerEvents() {\r\n        this.leftClickEvent();\r\n        this.rightClickEvent();\r\n        this.mouseMoveEvent();\r\n    }\r\n\r\n    leftClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.position);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.position, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            if (!this.firstPosition) {\r\n                this.firstPosition = this.getFirstPosition(position);\r\n            } else {\r\n                this.drawEnd();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n    }\r\n\r\n    getFirstPosition(position) {\r\n        const c = Cesium.Cartographic.fromCartesian(position);\r\n        const lon = Cesium.Math.toDegrees(c.longitude);\r\n        const lat = Cesium.Math.toDegrees(c.latitude);\r\n        const height = c.height + 1;\r\n        return Cesium.Cartesian3.fromDegrees(lon, lat, height);\r\n    }\r\n\r\n    createCameraLine(position) {\r\n        this.cameraLine = new CameraLine(this.viewer, {\r\n            viewPosition: this.firstPosition,\r\n            viewPositionEnd: position\r\n        })\r\n    }\r\n\r\n    mouseMoveEvent() {\r\n        this.handler.setInputAction(e => {\r\n            this.viewer._element.style.cursor = 'default';\r\n            let position = this.viewer.scene.pickPosition(e.endPosition);\r\n            if (!position) {\r\n                position = this.viewer.scene.camera.pickEllipsoid(e.startPosition, this.viewer.scene.globe.ellipsoid);\r\n            }\r\n            if (!position) return;\r\n            if (!this.firstPosition) return;\r\n\r\n            if (!this.cameraLine) {\r\n                this.createCameraLine(position);\r\n            } else {\r\n                this.cameraLine.updateEndPosition(position);\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n    }\r\n\r\n    rightClickEvent() {\r\n        this.handler.setInputAction(e => {\r\n            if (!this.firstPosition) {\r\n                this.deactivate()\r\n                return;\r\n            } else {\r\n                this.clear();\r\n                this.deactivate();\r\n            }\r\n        }, Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n    }\r\n\r\n    unRegisterEvents() {\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE);\r\n        this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);\r\n    }\r\n\r\n    drawEnd() {\r\n        this.Visibility = new Visibility(this.viewer, this.cameraLine.getOptions());\r\n        this.DrawEndEvent.raiseEvent(this.Visibility);\r\n        this.cameraLine.remove();\r\n        this.deactivate();\r\n    }\r\n}\r\n\r\nclass BufferAnalysis {\r\n    static pointBuffer(point, radius, options) {\r\n        let pointF = turf.point(point);\r\n        options = options || {\r\n            units: 'meters',\r\n            z: 0\r\n        };\r\n        let buffer = turf.buffer(pointF, radius || 100, options.units);\r\n        let coordinates = buffer.geometry.coordinates;\r\n        let points = coordinates[0];\r\n        let degreesArrayHeights = this.pointsToDegreesArray(points, options.z || 0);\r\n        return Cesium.Cartesian3.fromDegreesArrayHeights(degreesArrayHeights);\r\n    }\r\n\r\n    static polylineBuffer(points, radius, options) {\r\n        let polylineF = turf.lineString(points);\r\n        options = options || {\r\n            units: 'meters',\r\n            z: 0\r\n        };\r\n        let buffered = turf.buffer(polylineF, radius || 100, options.units);\r\n        let coordinates = buffered.geometry.coordinates;\r\n        points = coordinates[0];\r\n        let degreesArrayHeights = this.pointsToDegreesArray(points, options.z || 0);\r\n        return Cesium.Cartesian3.fromDegreesArrayHeights(degreesArrayHeights);\r\n    }\r\n\r\n    static polygonBuffer(points, radius, options) {\r\n        return this.polylineBuffer(points, radius, options);\r\n    }\r\n\r\n    static pointsToDegreesArray(points, height) {\r\n        let degreesArray = [];\r\n        points.map(item => {\r\n            degreesArray.push(item[0]);\r\n            degreesArray.push(item[1]);\r\n            degreesArray.push(height);\r\n        });\r\n        return degreesArray;\r\n    }\r\n}\r\n\r\nexport default { LimitHeightAnalysis, VisibilityAnalysis, BufferAnalysis }"],"mappings":"AAAA,OAAO,KAAKA,MAAZ,MAAwB,QAAxB;AACA,OAAO,KAAKC,IAAZ,MAAsB,MAAtB;AACA,OAAOC,IAAP,MAAiB,QAAjB;;AAEA,MAAMC,mBAAN,CAAyB;EACrBC,WAAW,CAACC,MAAD,EAASC,YAAT,EAAuBC,MAAvB,EAA+BC,KAA/B,EAAsC;IAC7C,KAAKH,MAAL,GAAcA,MAAd;IACA,KAAKC,YAAL,GAAoBA,YAApB;IACA,KAAKC,MAAL,GAAcA,MAAd;IACA,KAAKC,KAAL,GAAaA,KAAK,IAAI,EAAtB;IACA,KAAKC,IAAL;EACH;;EAEDA,IAAI,GAAG;IACH,KAAKJ,MAAL,CAAYK,KAAZ,CAAkBC,oBAAlB,GAAyC,IAAzC;IACA,KAAKN,MAAL,CAAYK,KAAZ,CAAkBE,yBAAlB,GAA8C,KAAKJ,KAAL,CAAWK,KAAX,IAAoB,IAAIb,MAAM,CAACc,KAAX,CAAiB,CAAjB,EAAoB,CAApB,EAAuB,CAAvB,EAA0B,CAA1B,CAAlE;IACA,KAAKC,gBAAL;IACA,KAAKC,YAAL;EACH;;EAEDD,gBAAgB,GAAG;IACf,KAAKE,aAAL,GAAqB,KAAKZ,MAAL,CAAYa,QAAZ,CAAqBC,GAArB,CAAyB;MAC1CC,OAAO,EAAE;QACLC,SAAS,EAAE,IAAIrB,MAAM,CAACsB,gBAAX,CAA4BtB,MAAM,CAACuB,UAAP,CAAkBC,gBAAlB,CAAmC,KAAKlB,YAAxC,CAA5B,CADN;QAELC,MAAM,EAAE,IAAIP,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;UACrC,OAAO,KAAKnB,MAAZ;QACH,CAFO,EAEL,KAFK,CAFH;QAKLoB,QAAQ,EAAE3B,MAAM,CAACc,KAAP,CAAac,MAAb,CAAoBC,SAApB,CAA8B,GAA9B,CALL;QAMLC,OAAO,EAAE,IANJ;QAOLC,YAAY,EAAE/B,MAAM,CAACc,KAAP,CAAakB;MAPtB;IADiC,CAAzB,CAArB;EAWH;;EAEDhB,YAAY,GAAG;IACX,IAAIiB,QAAQ,GAAG,KAAKC,cAAL,EAAf;IACA,KAAKC,0BAAL,CAAgCF,QAAhC;EACH;;EAEDG,SAAS,CAAC7B,MAAD,EAAS;IACd,KAAKA,MAAL,GAAcA,MAAM,IAAI,GAAxB;IACA,KAAK8B,eAAL;IACA,KAAKrB,YAAL;EACH;;EAEDkB,cAAc,GAAG;IACb,OAAO,IAAIlC,MAAM,CAACsC,eAAX,CAA2B;MAC9BC,gBAAgB,EAAE,IAAIvC,MAAM,CAACsB,gBAAX,CACdtB,MAAM,CAACuB,UAAP,CAAkBC,gBAAlB,CAAmC,KAAKlB,YAAxC,CADc,CADY;MAI9BC,MAAM,EAAE,KAAKA,MAJiB;MAK9BiC,cAAc,EAAE;IALc,CAA3B,CAAP;EAOH;;EAEDL,0BAA0B,CAACM,eAAD,EAAkB;IACxC,KAAKC,SAAL,GAAiB,KAAKrC,MAAL,CAAYK,KAAZ,CAAkBiC,UAAlB,CAA6BxB,GAA7B,CACb,IAAInB,MAAM,CAAC4C,uBAAX,CAAmC;MAC/BC,iBAAiB,EAAE,IAAI7C,MAAM,CAAC8C,gBAAX,CAA4B;QAC3Cb,QAAQ,EAAEjC,MAAM,CAACsC,eAAP,CAAuBJ,cAAvB,CAAsCO,eAAtC,CADiC;QAE3CM,UAAU,EAAE;UACRlC,KAAK,EAAEb,MAAM,CAACgD,8BAAP,CAAsCC,SAAtC,CACHjD,MAAM,CAACc,KAAP,CAAakB,GAAb,CAAiBH,SAAjB,CAA2B,GAA3B,CADG,CAC6B;UAD7B,CADC;UAIRqB,IAAI,EAAE,IAAIlD,MAAM,CAACmD,6BAAX,CAAyC,IAAzC;QAJE;MAF+B,CAA5B,CADY;MAU/BC,kBAAkB,EAAEpD,MAAM,CAACqD,kBAAP,CAA0BC,cAVf;MAW/BC,YAAY,EAAE,CAAC;IAXgB,CAAnC,CADa,CAAjB;EAeH;;EAEDlB,eAAe,GAAG;IACd,KAAKhC,MAAL,CAAYK,KAAZ,CAAkBiC,UAAlB,CAA6Ba,MAA7B,CAAoC,KAAKd,SAAzC;EACH;;EAEDc,MAAM,GAAG;IACL,KAAKnB,eAAL;IACA,KAAKhC,MAAL,CAAYK,KAAZ,CAAkBC,oBAAlB,GAAyC,KAAzC;IACA,KAAKN,MAAL,CAAYa,QAAZ,CAAqBsC,MAArB,CAA4B,KAAKvC,aAAjC;EACH;;AA7EoB;;AAgFzB,SAASwC,UAAT,CAAoBC,YAApB,EAAkCC,UAAlC,EAA8C;EAC1C,IAAIC,aAAa,GAAG,IAAI5D,MAAM,CAACuB,UAAX,EAApB;EACA,IAAIsC,OAAO,GAAG7D,MAAM,CAAC8D,UAAP,CAAkBC,uBAAlB,CAA0CL,YAA1C,CAAd;EACA1D,MAAM,CAACgE,OAAP,CAAeC,OAAf,CAAuBJ,OAAvB,EAAgCA,OAAhC;EACA7D,MAAM,CAACgE,OAAP,CAAeE,eAAf,CAA+BL,OAA/B,EAAwCF,UAAxC,EAAoDC,aAApD;EACA5D,MAAM,CAACuB,UAAP,CAAkB4C,SAAlB,CAA4BP,aAA5B,EAA2CA,aAA3C;EACA,OAAO5D,MAAM,CAACoE,IAAP,CAAYC,SAAZ,CAAsBD,IAAI,CAACE,KAAL,CAAWV,aAAa,CAACW,CAAzB,EAA4BX,aAAa,CAACY,CAA1C,CAAtB,CAAP;AACH;;AAED,SAASC,QAAT,CAAkBf,YAAlB,EAAgCC,UAAhC,EAA4C;EACxC,IAAIC,aAAa,GAAG,IAAI5D,MAAM,CAACuB,UAAX,EAApB;EACA,IAAIsC,OAAO,GAAG7D,MAAM,CAAC8D,UAAP,CAAkBC,uBAAlB,CAA0CL,YAA1C,CAAd;EACA1D,MAAM,CAACgE,OAAP,CAAeC,OAAf,CAAuBJ,OAAvB,EAAgCA,OAAhC;EACA7D,MAAM,CAACgE,OAAP,CAAeE,eAAf,CAA+BL,OAA/B,EAAwCF,UAAxC,EAAoDC,aAApD;EACA5D,MAAM,CAACuB,UAAP,CAAkB4C,SAAlB,CAA4BP,aAA5B,EAA2CA,aAA3C;EACA,OAAO5D,MAAM,CAACoE,IAAP,CAAYC,SAAZ,CAAsBD,IAAI,CAACM,IAAL,CAAUd,aAAa,CAACe,CAAxB,CAAtB,CAAP;AACH;;AAED,MAAMC,UAAN,CAAiB;EACbxE,WAAW,CAACC,MAAD,EAASwE,OAAT,EAAkB;IACzB,KAAKxE,MAAL,GAAcA,MAAd;IACA,KAAKyE,YAAL,GAAoBD,OAAO,CAACC,YAA5B,CAFyB,CAEiB;;IAC1C,KAAKC,eAAL,GAAuBF,OAAO,CAACE,eAA/B,CAHyB,CAGuB;;IAChD,KAAKC,YAAL,GAAoB,KAAKC,WAAL,EAApB;IACA,KAAKC,WAAL,GAAmB,KAAKC,cAAL,EAAnB;IACA,KAAKC,SAAL,GAAiB,KAAKC,YAAL,EAAjB;IACA,KAAKC,mBAAL,GAA2BT,OAAO,CAACS,mBAAR,IAA+B,IAA1D;IACA,KAAKC,iBAAL,GAAyBV,OAAO,CAACU,iBAAR,IAA6B,IAAtD;IACA,KAAKC,UAAL;IACA,KAAKC,kBAAL;EACH;;EAEDC,iBAAiB,CAACC,WAAD,EAAc;IAC3B,KAAKZ,eAAL,GAAuBY,WAAvB;EACH;;EAEDR,cAAc,GAAG;IACb,KAAKD,WAAL,GAAmBzB,UAAU,CAAC,KAAKqB,YAAN,EAAoB,KAAKC,eAAzB,CAA7B;IACA,OAAO,KAAKG,WAAZ;EACH;;EAEDG,YAAY,GAAG;IACX,KAAKD,SAAL,GAAiBX,QAAQ,CAAC,KAAKK,YAAN,EAAoB,KAAKC,eAAzB,CAAzB;IACA,OAAO,KAAKK,SAAZ;EACH;;EAEDH,WAAW,GAAG;IACV,KAAKD,YAAL,GAAoBhF,MAAM,CAACuB,UAAP,CAAkBqE,QAAlB,CAA2B,KAAKd,YAAhC,EAA8C,KAAKC,eAAnD,CAApB;IACA,OAAO,KAAKC,YAAZ;EACH;;EAEDa,UAAU,GAAG;IACT,OAAO;MACHf,YAAY,EAAE,KAAKA,YADhB;MAEHC,eAAe,EAAE,KAAKA,eAFnB;MAGHC,YAAY,EAAE,KAAKA,YAHhB;MAIHE,WAAW,EAAE,KAAKA,WAJf;MAKHE,SAAS,EAAE,KAAKA,SALb;MAMHE,mBAAmB,EAAE,KAAKA,mBANvB;MAOHC,iBAAiB,EAAE,KAAKA;IAPrB,CAAP;EASH;;EAEDE,kBAAkB,GAAG;IACjB,KAAKK,cAAL,GAAsB,KAAKzF,MAAL,CAAYa,QAAZ,CAAqBC,GAArB,CAAyB;MAC3C4E,IAAI,EAAE,gBADqC;MAE3CC,QAAQ,EAAE,KAAKlB,YAF4B;MAG3CmB,WAAW,EAAE,IAAIjG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;QAC1C,OAAO1B,MAAM,CAAC8D,UAAP,CAAkBoC,0BAAlB,CACH,KAAKpB,YADF,EAEH9E,MAAM,CAACmG,gBAAP,CAAwBC,WAAxB,CAAoC,KAAKjB,cAAL,KAAwB,KAAKG,mBAAjE,EAAsF,KAAKD,YAAL,EAAtF,EAA2G,GAA3G,CAFG,CAAP;MAIH,CALY,EAKV,KALU,CAH8B;MAS3CgB,SAAS,EAAE;QACPC,KAAK,EAAE,IAAItG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;UACpC,MAAMkE,QAAQ,GAAG,KAAKX,WAAL,EAAjB;UACA,OAAO,IAAIjF,MAAM,CAACuB,UAAX,CAAsBqE,QAAtB,EAAgCA,QAAhC,EAA0CA,QAA1C,CAAP;QACH,CAHM,EAGJ,KAHI,CADA;QAKPW,UAAU,EAAE,IAAIvG,MAAM,CAACuB,UAAX,CAAsB,IAAtB,EAA4B,IAA5B,EAAkC,IAAlC,CALL;QAMPiF,YAAY,EAAExG,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,CAAC,KAAKnB,mBAAN,GAA4B,CAAlD,CANP;QAOPoB,YAAY,EAAE1G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKnB,mBAAL,GAA2B,CAAjD,CAPP;QAQPqB,WAAW,EAAE3G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKlB,iBAAL,GAAyB,IAA/C,CARN;QASPqB,WAAW,EAAE5G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,MAAM,KAAKlB,iBAAX,GAA+B,IAArD,CATN;QAUPsB,IAAI,EAAE,KAVC;QAWP/E,OAAO,EAAE,IAXF;QAYPC,YAAY,EAAE/B,MAAM,CAACc,KAAP,CAAagG;MAZpB;IATgC,CAAzB,CAAtB;EAwBH;;EAEDtB,UAAU,GAAG;IACT,KAAKuB,MAAL,GAAc,KAAK1G,MAAL,CAAYa,QAAZ,CAAqBC,GAArB,CAAyB;MACnC4E,IAAI,EAAE,QAD6B;MAEnCC,QAAQ,EAAE,KAAKlB,YAFoB;MAGnCmB,WAAW,EAAE,IAAIjG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;QAC1C,OAAO1B,MAAM,CAAC8D,UAAP,CAAkBoC,0BAAlB,CACH,KAAKpB,YADF,EAEH9E,MAAM,CAACmG,gBAAP,CAAwBC,WAAxB,CAAoC,KAAKjB,cAAL,KAAwB,KAAKG,mBAAjE,EAAsF,KAAKD,YAAL,EAAtF,EAA2G,GAA3G,CAFG,CAAP;MAIH,CALY,EAKV,KALU,CAHsB;MASnCgB,SAAS,EAAE;QACPC,KAAK,EAAE,IAAItG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;UACpC,MAAMkE,QAAQ,GAAG,KAAKX,WAAL,EAAjB;UACA,OAAO,IAAIjF,MAAM,CAACuB,UAAX,CAAsBqE,QAAtB,EAAgCA,QAAhC,EAA0CA,QAA1C,CAAP;QACH,CAHM,EAGJ,KAHI,CADA;QAKPY,YAAY,EAAExG,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,CAAC,KAAKnB,mBAAN,GAA4B,CAAlD,CALP;QAMPoB,YAAY,EAAE1G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKnB,mBAAL,GAA2B,CAAjD,CANP;QAOPqB,WAAW,EAAE3G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKlB,iBAAL,GAAyB,IAA/C,CAPN;QAQPqB,WAAW,EAAE5G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,MAAM,KAAKlB,iBAAX,GAA+B,IAArD,CARN;QASPsB,IAAI,EAAE,KATC;QAUP/E,OAAO,EAAE,IAVF;QAWPkF,YAAY,EAAE,GAXP;QAYPC,eAAe,EAAE,EAZV;QAaPC,eAAe,EAAE,EAbV;QAcPnF,YAAY,EAAE/B,MAAM,CAACc,KAAP,CAAagG;MAdpB;IATwB,CAAzB,CAAd;EA0BH;;EAEDtD,MAAM,GAAG;IACL,IAAI,KAAKuD,MAAT,EAAiB;MACb,KAAK1G,MAAL,CAAYa,QAAZ,CAAqBsC,MAArB,CAA4B,KAAKuD,MAAjC;MACA,KAAKA,MAAL,GAAc,IAAd;IACH;;IAED,IAAI,KAAKjB,cAAT,EAAyB;MACrB,KAAKzF,MAAL,CAAYa,QAAZ,CAAqBsC,MAArB,CAA4B,KAAKsC,cAAjC;MACA,KAAKA,cAAL,GAAsB,IAAtB;IACH;EACJ;;AA/GY;;AAkHjB,MAAMqB,UAAN,CAAiB;EACb/G,WAAW,CAACC,MAAD,EAASwE,OAAT,EAAkB;IACzB,KAAKxE,MAAL,GAAcA,MAAd;IACA,KAAKyE,YAAL,GAAoBD,OAAO,CAACC,YAA5B;IACA,KAAKC,eAAL,GAAuBF,OAAO,CAACE,eAA/B;IACA,KAAKC,YAAL,GAAoBH,OAAO,CAACG,YAA5B;IACA,KAAKE,WAAL,GAAmBL,OAAO,CAACK,WAA3B;;IACA,IAAI,KAAKA,WAAL,GAAmB,CAAvB,EAA0B;MACtB,KAAKA,WAAL,IAAoB,GAApB;IACH;;IACD,KAAKE,SAAL,GAAiBP,OAAO,CAACO,SAAzB;IACA,KAAKE,mBAAL,GAA2BT,OAAO,CAACS,mBAAR,IAA+B,IAA1D;IACA,KAAKC,iBAAL,GAAyBV,OAAO,CAACU,iBAAR,IAA6B,IAAtD;IACA,KAAK6B,gBAAL,GAAwBvC,OAAO,CAACuC,gBAAR,IAA4BpH,MAAM,CAACc,KAAP,CAAauG,IAAjE,CAZyB,CAY8C;;IACvE,KAAKC,kBAAL,GAA0BzC,OAAO,CAACyC,kBAAR,IAA8BtH,MAAM,CAACc,KAAP,CAAakB,GAArE;IACA,KAAKuF,OAAL,GAAgB,OAAO1C,OAAO,CAAC0C,OAAf,KAA2B,SAA5B,GAAyC1C,OAAO,CAAC0C,OAAjD,GAA2D,IAA1E;IACA,KAAKC,WAAL,GAAoB,OAAO3C,OAAO,CAAC2C,WAAf,KAA+B,SAAhC,GAA6C3C,OAAO,CAAC2C,WAArD,GAAmE,IAAtF;IACA,KAAKC,IAAL,GAAY5C,OAAO,CAAC4C,IAAR,IAAgB,IAA5B;IACA,KAAKtG,GAAL;EACH;;EAEDA,GAAG,GAAG;IACF,KAAKuG,iBAAL;IACA,KAAKC,eAAL;IACA,KAAKC,eAAL;IACA,KAAKnC,kBAAL;IACA,KAAKD,UAAL;EACH;;EAEDqC,QAAQ,GAAG;IACP,OAAO;MACH3C,WAAW,EAAE,KAAKA,WADf;MAEHF,YAAY,EAAE,KAAKA,YAFhB;MAGHM,mBAAmB,EAAE,KAAKA,mBAHvB;MAIHC,iBAAiB,EAAE,KAAKA;IAJrB,CAAP;EAMH;;EAEDuC,WAAW,CAACjD,OAAD,EAAU;IACjB,KAAKK,WAAL,GAAmBL,OAAO,CAACK,WAA3B;IACA,KAAKF,YAAL,GAAoBH,OAAO,CAACG,YAA5B;IACA,KAAKM,mBAAL,GAA2BT,OAAO,CAACS,mBAAnC;IACA,KAAKC,iBAAL,GAAyBV,OAAO,CAACU,iBAAjC;IACA,KAAKwC,KAAL;IACA,KAAK5G,GAAL;EACH;;EAEDqC,MAAM,GAAG;IACL,KAAKuE,KAAL;EACH;;EAEDA,KAAK,GAAG;IACJ,IAAI,KAAKhB,MAAT,EAAiB;MACb,KAAK1G,MAAL,CAAYa,QAAZ,CAAqB8G,UAArB,CAAgC,KAAKjB,MAAL,CAAYkB,EAA5C;MACA,KAAKlB,MAAL,GAAc,IAAd;IACH;;IAED,IAAI,KAAKjB,cAAT,EAAyB;MACrB,KAAKzF,MAAL,CAAYa,QAAZ,CAAqBsC,MAArB,CAA4B,KAAKsC,cAAjC;MACA,KAAKA,cAAL,GAAsB,IAAtB;IACH;;IAED,IAAI,KAAKoC,SAAT,EAAoB;MAChB,KAAK7H,MAAL,CAAYK,KAAZ,CAAkByH,iBAAlB,CAAoC3E,MAApC,CAA2C,KAAK0E,SAAhD;MACA,KAAKA,SAAL,GAAiB,IAAjB;IACH;EACJ;;EAEDR,iBAAiB,GAAG;IAChB,KAAKU,WAAL,GAAmB,IAAIpI,MAAM,CAACqI,MAAX,CAAkB,KAAKhI,MAAL,CAAYK,KAA9B,CAAnB;IACA,KAAK0H,WAAL,CAAiBpC,QAAjB,GAA4B,KAAKlB,YAAjC;IACA,KAAKsD,WAAL,CAAiBE,OAAjB,CAAyBC,IAAzB,GAAgC,KAAKvD,YAAL,GAAoB,KAApD;IACA,KAAKoD,WAAL,CAAiBE,OAAjB,CAAyBE,GAAzB,GAA+B,KAAKxD,YAApC;IACA,MAAMyD,EAAE,GAAGzI,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKnB,mBAA3B,CAAX;IACA,MAAMoD,EAAE,GAAG1I,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKlB,iBAA3B,CAAX;IACA,MAAMoD,WAAW,GACZ,KAAK3D,YAAL,GAAoBZ,IAAI,CAACwE,GAAL,CAASH,EAAE,GAAG,CAAd,CAApB,GAAuC,CAAxC,IACC,KAAKzD,YAAL,GAAoBZ,IAAI,CAACwE,GAAL,CAASF,EAAE,GAAG,CAAd,CAApB,GAAuC,CADxC,CADJ;IAGA,KAAKN,WAAL,CAAiBE,OAAjB,CAAyBK,WAAzB,GAAuCA,WAAvC;;IACA,IAAIF,EAAE,GAAGC,EAAT,EAAa;MACT,KAAKN,WAAL,CAAiBE,OAAjB,CAAyBO,GAAzB,GAA+BJ,EAA/B;IACH,CAFD,MAEO;MACH,KAAKL,WAAL,CAAiBE,OAAjB,CAAyBO,GAAzB,GAA+BH,EAA/B;IACH;;IACD,KAAKN,WAAL,CAAiBU,OAAjB,CAAyB;MACrBC,WAAW,EAAE,KAAKjE,YADG;MAErBmB,WAAW,EAAE;QACT+C,OAAO,EAAEhJ,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKvB,WAAL,IAAoB,CAA1C,CADA;QAET+D,KAAK,EAAEjJ,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKrB,SAAL,IAAkB,CAAxC,CAFE;QAGT8D,IAAI,EAAE;MAHG;IAFQ,CAAzB;EAQH;;EAEDvB,eAAe,GAAG;IACd,KAAKwB,SAAL,GAAiB,IAAInJ,MAAM,CAACoJ,SAAX,CAAqB;MAClCC,OAAO,EAAG,KAAKhJ,MAAL,CAAYK,KAAb,CAAoB2I,OADK;MAElCjB,WAAW,EAAE,KAAKA,WAFgB;MAGlCb,OAAO,EAAE,KAAKA,OAHoB;MAIlC+B,YAAY,EAAE,IAJoB;MAKlCC,gBAAgB,EAAE,KAAKvE,YALW;MAMlCwE,eAAe,EAAE,KANiB;MAOlC/B,IAAI,EAAE,KAAKA,IAPuB;MAQlCD,WAAW,EAAE,KAAKA,WARgB;MASlCiC,YAAY,EAAE,KAToB;MAUlCC,eAAe,EAAE;IAViB,CAArB,CAAjB;IAYA,KAAKrJ,MAAL,CAAYK,KAAZ,CAAkByI,SAAlB,GAA8B,KAAKA,SAAnC;EACH;;EAEDvB,eAAe,GAAG;IACd,MAAM+B,EAAE,GAAGzJ,IAAX;IACA,MAAMgI,SAAS,GAAG,IAAIlI,MAAM,CAAC4J,gBAAX,CAA4B;MAC1CC,cAAc,EAAEF,EAD0B;MAE1CG,QAAQ,EAAE;QACNC,qBAAqB,EAAE,MAAM;UACzB,KAAKZ,SAAL,CAAea,MAAf,CAAsBC,OAAO,CAACC,GAAR,CAAY,KAAK7J,MAAL,CAAYK,KAAxB,EAA+B,aAA/B,CAAtB;UACA,OAAOuJ,OAAO,CAACC,GAAR,CAAY,KAAKf,SAAjB,EAA4B,mBAA5B,CAAP;QACH,CAJK;QAKNgB,gBAAgB,EAAE,MAAM;UACpB,KAAKhB,SAAL,CAAea,MAAf,CAAsBC,OAAO,CAACC,GAAR,CAAY,KAAK7J,MAAL,CAAYK,KAAxB,EAA+B,aAA/B,CAAtB;UACA,OAAOuJ,OAAO,CAACC,GAAR,CAAY,KAAKf,SAAjB,EAA4B,kBAA5B,CAAP;QACH,CARK;QASNiB,yBAAyB,EAAE,MAAM;UAC7B,KAAKjB,SAAL,CAAea,MAAf,CAAsBC,OAAO,CAACC,GAAR,CAAY,KAAK7J,MAAL,CAAYK,KAAxB,EAA+B,aAA/B,CAAtB;UACA,OAAOuJ,OAAO,CAACC,GAAR,CAAY,KAAKf,SAAjB,EAA4B,kBAA5B,CAAP;QACH,CAZK;QAaNkB,yDAAyD,EAAE,MAAM;UAC7D,KAAKlB,SAAL,CAAea,MAAf,CAAsBC,OAAO,CAACC,GAAR,CAAY,KAAK7J,MAAL,CAAYK,KAAxB,EAA+B,aAA/B,CAAtB;UACA,MAAM4J,IAAI,GAAG,KAAKnB,SAAL,CAAeoB,UAA5B;UACA,OAAOvK,MAAM,CAACwK,UAAP,CAAkBC,YAAlB,CACHH,IAAI,CAACI,iBADF,EAEH,KAAKvB,SAAL,CAAewB,SAFZ,EAGH,KAAKxB,SAAL,CAAeyB,eAHZ,EAIH,GAJG,EAKH,IAAI5K,MAAM,CAACwK,UAAX,EALG,CAAP;QAOH,CAvBK;QAwBNK,kDAAkD,EAAE,MAAM;UACtD,KAAK1B,SAAL,CAAea,MAAf,CAAsBC,OAAO,CAACC,GAAR,CAAY,KAAK7J,MAAL,CAAYK,KAAxB,EAA+B,aAA/B,CAAtB;UACA,MAAM4J,IAAI,GAAG,KAAKnB,SAAL,CAAeoB,UAA5B;UACA,MAAMO,oBAAoB,GAAG,IAAI9K,MAAM,CAAC+K,UAAX,EAA7B;UACA,MAAMC,aAAa,GAAGF,oBAAtB;UACAE,aAAa,CAACzG,CAAd,GAAkB,MAAM,KAAK4E,SAAL,CAAe8B,YAAf,CAA4B1G,CAApD;UACAyG,aAAa,CAACxG,CAAd,GAAkB,MAAM,KAAK2E,SAAL,CAAe8B,YAAf,CAA4BzG,CAApD;UACA,OAAOxE,MAAM,CAACwK,UAAP,CAAkBC,YAAlB,CACHO,aAAa,CAACzG,CADX,EAEHyG,aAAa,CAACxG,CAFX,EAGH8F,IAAI,CAACY,SAHF,EAIHZ,IAAI,CAACa,mBAJF,EAKH,IAAInL,MAAM,CAACwK,UAAX,EALG,CAAP;QAOH,CAtCK;QAuCNY,wBAAwB,EAAE,MAAM;UAC5B,OAAO,KAAKhD,WAAL,CAAiBE,OAAjB,CAAyB+C,gBAAhC;QACH,CAzCK;QA0CNC,kBAAkB,EAAE,MAAM;UACtB,OAAO,KAAKlD,WAAL,CAAiBmD,UAAxB;QACH,CA5CK;QA6CNC,cAAc,EAAE,MAAM;UAClB,OAAO,KAAKxG,YAAZ;QACH,CA/CK;QAgDNyG,kBAAkB,EAAE,KAAKrE,gBAhDnB;QAiDNsE,oBAAoB,EAAE,KAAKpE;MAjDrB;IAFgC,CAA5B,CAAlB;IAsDA,KAAKY,SAAL,GAAiB,KAAK7H,MAAL,CAAYK,KAAZ,CAAkByH,iBAAlB,CAAoChH,GAApC,CAAwC+G,SAAxC,CAAjB;EACH;;EAEDzC,kBAAkB,GAAG;IACjB,KAAKK,cAAL,GAAsB,KAAKzF,MAAL,CAAYa,QAAZ,CAAqBC,GAArB,CAAyB;MAC3C4E,IAAI,EAAE,gBADqC;MAE3CC,QAAQ,EAAE,KAAKlB,YAF4B;MAG3CmB,WAAW,EAAE,IAAIjG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;QAC1C,OAAO1B,MAAM,CAAC8D,UAAP,CAAkBoC,0BAAlB,CACH,KAAKpB,YADF,EAEH9E,MAAM,CAACmG,gBAAP,CAAwBC,WAAxB,CAAoC,KAAKlB,WAAL,GAAmB,EAAvD,EAA2D,KAAKE,SAAhE,EAA2E,GAA3E,CAFG,CAAP;MAIH,CALY,EAKV,KALU,CAH8B;MAS3CiB,SAAS,EAAE;QACPC,KAAK,EAAE,IAAItG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;UACpC,OAAO,IAAI1B,MAAM,CAACuB,UAAX,CAAsB,KAAKyD,YAA3B,EAAyC,KAAKA,YAA9C,EAA4D,KAAKA,YAAjE,CAAP;QACH,CAFM,EAEJ,KAFI,CADA;QAKPuB,UAAU,EAAE,IAAIvG,MAAM,CAACuB,UAAX,CAAsB,IAAtB,EAA4B,IAA5B,EAAkC,IAAlC,CALL;QAMPiF,YAAY,EAAE,IAAIxG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;UAC3C,OAAO1B,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,CAAC,KAAKnB,mBAAN,GAA4B,CAAlD,CAAP;QACH,CAFa,EAEX,KAFW,CANP;QASPoB,YAAY,EAAE,IAAI1G,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;UAC3C,OAAO1B,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKnB,mBAAL,GAA2B,CAAjD,CAAP;QACH,CAFa,EAEX,KAFW,CATP;QAYPqB,WAAW,EAAE3G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKlB,iBAAL,GAAyB,IAA/C,CAZN;QAaPqB,WAAW,EAAE5G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,MAAM,KAAKlB,iBAAX,GAA+B,IAArD,CAbN;QAcPsB,IAAI,EAAE,KAdC;QAePK,eAAe,EAAE,EAfV;QAgBPD,eAAe,EAAE,EAhBV;QAiBPnF,OAAO,EAAE,IAjBF;QAkBPC,YAAY,EAAE/B,MAAM,CAACc,KAAP,CAAagG;MAlBpB;IATgC,CAAzB,CAAtB;EA8BH;;EAEDtB,UAAU,GAAG;IACT,KAAKuB,MAAL,GAAc,KAAK1G,MAAL,CAAYa,QAAZ,CAAqBC,GAArB,CAAyB;MACnC4E,IAAI,EAAE,QAD6B;MAEnCC,QAAQ,EAAE,KAAKlB,YAFoB;MAGnCmB,WAAW,EAAE,IAAIjG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;QAC1C,OAAO1B,MAAM,CAAC8D,UAAP,CAAkBoC,0BAAlB,CACH,KAAKpB,YADF,EAEH9E,MAAM,CAACmG,gBAAP,CAAwBC,WAAxB,CAAoC,KAAKlB,WAAL,GAAmB,EAAvD,EAA2D,KAAKE,SAAhE,EAA2E,GAA3E,CAFG,CAAP;MAIH,CALY,EAKV,KALU,CAHsB;MASnCiB,SAAS,EAAE;QACPC,KAAK,EAAE,IAAItG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;UACpC,OAAO,IAAI1B,MAAM,CAACuB,UAAX,CAAsB,KAAKyD,YAA3B,EAAyC,KAAKA,YAA9C,EAA4D,KAAKA,YAAjE,CAAP;QACH,CAFM,EAEJ,KAFI,CADA;QAIPwB,YAAY,EAAE,IAAIxG,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;UAC3C,OAAO1B,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,CAAC,KAAKnB,mBAAN,GAA4B,CAAlD,CAAP;QACH,CAFa,EAEX,KAFW,CAJP;QAOPoB,YAAY,EAAE,IAAI1G,MAAM,CAACyB,gBAAX,CAA4BC,CAAC,IAAI;UAC3C,OAAO1B,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKnB,mBAAL,GAA2B,CAAjD,CAAP;QACH,CAFa,EAEX,KAFW,CAPP;QAUPqB,WAAW,EAAE3G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,KAAKlB,iBAAL,GAAyB,IAA/C,CAVN;QAWPqB,WAAW,EAAE5G,MAAM,CAACoE,IAAP,CAAYqC,SAAZ,CAAsB,MAAM,KAAKlB,iBAAX,GAA+B,IAArD,CAXN;QAYPsB,IAAI,EAAE,KAZC;QAaP/E,OAAO,EAAE,IAbF;QAcPkF,YAAY,EAAE,GAdP;QAePC,eAAe,EAAE,EAfV;QAgBPC,eAAe,EAAE,EAhBV;QAiBPnF,YAAY,EAAE/B,MAAM,CAACc,KAAP,CAAagG;MAjBpB;IATwB,CAAzB,CAAd;EA6BH;;AAxOY;;AA2OjB,MAAM6E,kBAAN,CAAyB;EACrBvL,WAAW,CAACC,MAAD,EAAS;IAChB,KAAKA,MAAL,GAAcA,MAAd;IACA,KAAKA,MAAL,CAAYuL,YAAZ,CAAyBC,uBAAzB,CAAiDC,iBAAjD,CAAmE9L,MAAM,CAAC+L,oBAAP,CAA4BC,iBAA/F;IACA,KAAKC,UAAL;EACH;;EAEDC,QAAQ,GAAG;IACP,KAAKC,UAAL;IACA,KAAKpE,KAAL;IACA,KAAKqE,aAAL,GAAqBC,SAArB;IACA,KAAKC,cAAL;EACH;;EAEDH,UAAU,GAAG;IACT,KAAKI,gBAAL;IACA,KAAKlM,MAAL,CAAYmM,QAAZ,CAAqBhM,KAArB,CAA2BiM,MAA3B,GAAoC,SAApC;IACA,KAAKpM,MAAL,CAAYqM,iBAAZ,GAAgC,IAAhC;EACH;;EAED3E,KAAK,GAAG;IACJ,IAAI,KAAK4E,UAAT,EAAqB;MACjB,KAAKA,UAAL,CAAgBnJ,MAAhB;MACA,KAAKmJ,UAAL,GAAkBN,SAAlB;IACH;EACJ;;EAEDJ,UAAU,GAAG;IACT,KAAKW,OAAL,GAAe,IAAI5M,MAAM,CAAC6M,uBAAX,CAAmC,KAAKxM,MAAL,CAAYK,KAAZ,CAAkBoM,MAArD,CAAf;IACA,KAAKC,YAAL,GAAoB,IAAI/M,MAAM,CAACgN,KAAX,EAApB;EACH;;EAEDV,cAAc,GAAG;IACb,KAAKW,cAAL;IACA,KAAKC,eAAL;IACA,KAAKC,cAAL;EACH;;EAEDF,cAAc,GAAG;IACb,KAAKL,OAAL,CAAaQ,cAAb,CAA4B1L,CAAC,IAAI;MAC7B,KAAKrB,MAAL,CAAYmM,QAAZ,CAAqBhM,KAArB,CAA2BiM,MAA3B,GAAoC,SAApC;MACA,IAAIzG,QAAQ,GAAG,KAAK3F,MAAL,CAAYK,KAAZ,CAAkB2M,YAAlB,CAA+B3L,CAAC,CAACsE,QAAjC,CAAf;;MACA,IAAI,CAACA,QAAL,EAAe;QACXA,QAAQ,GAAG,KAAK3F,MAAL,CAAYK,KAAZ,CAAkB4M,MAAlB,CAAyBC,aAAzB,CAAuC7L,CAAC,CAACsE,QAAzC,EAAmD,KAAK3F,MAAL,CAAYK,KAAZ,CAAkB8M,KAAlB,CAAwBnH,SAA3E,CAAX;MACH;;MACD,IAAI,CAACL,QAAL,EAAe;;MACf,IAAI,CAAC,KAAKoG,aAAV,EAAyB;QACrB,KAAKA,aAAL,GAAqB,KAAKqB,gBAAL,CAAsBzH,QAAtB,CAArB;MACH,CAFD,MAEO;QACH,KAAK0H,OAAL;MACH;IACJ,CAZD,EAYG1N,MAAM,CAAC+L,oBAAP,CAA4B4B,UAZ/B;EAaH;;EAEDF,gBAAgB,CAACzH,QAAD,EAAW;IACvB,MAAM4H,CAAC,GAAG5N,MAAM,CAAC6N,YAAP,CAAoBC,aAApB,CAAkC9H,QAAlC,CAAV;IACA,MAAM+H,GAAG,GAAG/N,MAAM,CAACoE,IAAP,CAAYC,SAAZ,CAAsBuJ,CAAC,CAACI,SAAxB,CAAZ;IACA,MAAMC,GAAG,GAAGjO,MAAM,CAACoE,IAAP,CAAYC,SAAZ,CAAsBuJ,CAAC,CAACM,QAAxB,CAAZ;IACA,MAAM3N,MAAM,GAAGqN,CAAC,CAACrN,MAAF,GAAW,CAA1B;IACA,OAAOP,MAAM,CAACuB,UAAP,CAAkB6E,WAAlB,CAA8B2H,GAA9B,EAAmCE,GAAnC,EAAwC1N,MAAxC,CAAP;EACH;;EAED4N,gBAAgB,CAACnI,QAAD,EAAW;IACvB,KAAK2G,UAAL,GAAkB,IAAI/H,UAAJ,CAAe,KAAKvE,MAApB,EAA4B;MAC1CyE,YAAY,EAAE,KAAKsH,aADuB;MAE1CrH,eAAe,EAAEiB;IAFyB,CAA5B,CAAlB;EAIH;;EAEDmH,cAAc,GAAG;IACb,KAAKP,OAAL,CAAaQ,cAAb,CAA4B1L,CAAC,IAAI;MAC7B,KAAKrB,MAAL,CAAYmM,QAAZ,CAAqBhM,KAArB,CAA2BiM,MAA3B,GAAoC,SAApC;MACA,IAAIzG,QAAQ,GAAG,KAAK3F,MAAL,CAAYK,KAAZ,CAAkB2M,YAAlB,CAA+B3L,CAAC,CAACiE,WAAjC,CAAf;;MACA,IAAI,CAACK,QAAL,EAAe;QACXA,QAAQ,GAAG,KAAK3F,MAAL,CAAYK,KAAZ,CAAkB4M,MAAlB,CAAyBC,aAAzB,CAAuC7L,CAAC,CAAC0M,aAAzC,EAAwD,KAAK/N,MAAL,CAAYK,KAAZ,CAAkB8M,KAAlB,CAAwBnH,SAAhF,CAAX;MACH;;MACD,IAAI,CAACL,QAAL,EAAe;MACf,IAAI,CAAC,KAAKoG,aAAV,EAAyB;;MAEzB,IAAI,CAAC,KAAKO,UAAV,EAAsB;QAClB,KAAKwB,gBAAL,CAAsBnI,QAAtB;MACH,CAFD,MAEO;QACH,KAAK2G,UAAL,CAAgBjH,iBAAhB,CAAkCM,QAAlC;MACH;IACJ,CAdD,EAcGhG,MAAM,CAAC+L,oBAAP,CAA4BsC,UAd/B;EAeH;;EAEDnB,eAAe,GAAG;IACd,KAAKN,OAAL,CAAaQ,cAAb,CAA4B1L,CAAC,IAAI;MAC7B,IAAI,CAAC,KAAK0K,aAAV,EAAyB;QACrB,KAAKD,UAAL;QACA;MACH,CAHD,MAGO;QACH,KAAKpE,KAAL;QACA,KAAKoE,UAAL;MACH;IACJ,CARD,EAQGnM,MAAM,CAAC+L,oBAAP,CAA4BuC,WAR/B;EASH;;EAED/B,gBAAgB,GAAG;IACf,KAAKK,OAAL,CAAad,iBAAb,CAA+B9L,MAAM,CAAC+L,oBAAP,CAA4BuC,WAA3D;IACA,KAAK1B,OAAL,CAAad,iBAAb,CAA+B9L,MAAM,CAAC+L,oBAAP,CAA4B4B,UAA3D;IACA,KAAKf,OAAL,CAAad,iBAAb,CAA+B9L,MAAM,CAAC+L,oBAAP,CAA4BsC,UAA3D;IACA,KAAKzB,OAAL,CAAad,iBAAb,CAA+B9L,MAAM,CAAC+L,oBAAP,CAA4BC,iBAA3D;EACH;;EAED0B,OAAO,GAAG;IACN,KAAKvG,UAAL,GAAkB,IAAIA,UAAJ,CAAe,KAAK9G,MAApB,EAA4B,KAAKsM,UAAL,CAAgB9G,UAAhB,EAA5B,CAAlB;IACA,KAAKkH,YAAL,CAAkBwB,UAAlB,CAA6B,KAAKpH,UAAlC;IACA,KAAKwF,UAAL,CAAgBnJ,MAAhB;IACA,KAAK2I,UAAL;EACH;;AA/GoB;;AAkHzB,MAAMqC,cAAN,CAAqB;EACC,OAAXC,WAAW,CAACC,KAAD,EAAQC,MAAR,EAAgB9J,OAAhB,EAAyB;IACvC,IAAI+J,MAAM,GAAG3O,IAAI,CAACyO,KAAL,CAAWA,KAAX,CAAb;IACA7J,OAAO,GAAGA,OAAO,IAAI;MACjBgK,KAAK,EAAE,QADU;MAEjBlK,CAAC,EAAE;IAFc,CAArB;IAIA,IAAImK,MAAM,GAAG7O,IAAI,CAAC6O,MAAL,CAAYF,MAAZ,EAAoBD,MAAM,IAAI,GAA9B,EAAmC9J,OAAO,CAACgK,KAA3C,CAAb;IACA,IAAIE,WAAW,GAAGD,MAAM,CAAC7M,QAAP,CAAgB8M,WAAlC;IACA,IAAIC,MAAM,GAAGD,WAAW,CAAC,CAAD,CAAxB;IACA,IAAIE,mBAAmB,GAAG,KAAKC,oBAAL,CAA0BF,MAA1B,EAAkCnK,OAAO,CAACF,CAAR,IAAa,CAA/C,CAA1B;IACA,OAAO3E,MAAM,CAACuB,UAAP,CAAkB4N,uBAAlB,CAA0CF,mBAA1C,CAAP;EACH;;EAEoB,OAAdG,cAAc,CAACJ,MAAD,EAASL,MAAT,EAAiB9J,OAAjB,EAA0B;IAC3C,IAAIwK,SAAS,GAAGpP,IAAI,CAACqP,UAAL,CAAgBN,MAAhB,CAAhB;IACAnK,OAAO,GAAGA,OAAO,IAAI;MACjBgK,KAAK,EAAE,QADU;MAEjBlK,CAAC,EAAE;IAFc,CAArB;IAIA,IAAI4K,QAAQ,GAAGtP,IAAI,CAAC6O,MAAL,CAAYO,SAAZ,EAAuBV,MAAM,IAAI,GAAjC,EAAsC9J,OAAO,CAACgK,KAA9C,CAAf;IACA,IAAIE,WAAW,GAAGQ,QAAQ,CAACtN,QAAT,CAAkB8M,WAApC;IACAC,MAAM,GAAGD,WAAW,CAAC,CAAD,CAApB;IACA,IAAIE,mBAAmB,GAAG,KAAKC,oBAAL,CAA0BF,MAA1B,EAAkCnK,OAAO,CAACF,CAAR,IAAa,CAA/C,CAA1B;IACA,OAAO3E,MAAM,CAACuB,UAAP,CAAkB4N,uBAAlB,CAA0CF,mBAA1C,CAAP;EACH;;EAEmB,OAAbO,aAAa,CAACR,MAAD,EAASL,MAAT,EAAiB9J,OAAjB,EAA0B;IAC1C,OAAO,KAAKuK,cAAL,CAAoBJ,MAApB,EAA4BL,MAA5B,EAAoC9J,OAApC,CAAP;EACH;;EAE0B,OAApBqK,oBAAoB,CAACF,MAAD,EAASzO,MAAT,EAAiB;IACxC,IAAID,YAAY,GAAG,EAAnB;IACA0O,MAAM,CAACS,GAAP,CAAWC,IAAI,IAAI;MACfpP,YAAY,CAACqP,IAAb,CAAkBD,IAAI,CAAC,CAAD,CAAtB;MACApP,YAAY,CAACqP,IAAb,CAAkBD,IAAI,CAAC,CAAD,CAAtB;MACApP,YAAY,CAACqP,IAAb,CAAkBpP,MAAlB;IACH,CAJD;IAKA,OAAOD,YAAP;EACH;;AAvCgB;;AA0CrB,eAAe;EAAEH,mBAAF;EAAuBwL,kBAAvB;EAA2C6C;AAA3C,CAAf"}]}